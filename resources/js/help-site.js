/*
 * 
 */
new Backbone.Application({name:"app",nameSpace:"visualHUD",scaleFactor:1,ver:"2.0",MAX_BACKGROUND_SIZE:1024*300,allocationMap:{model:"Models",collection:"Collections",controller:"Controllers",view:"Views",lib:"Libs",utility:"Utils",widgets:"Widgets",routers:"Routers"},collections:["DictionaryAbstract"],controllers:[],messages:{},navigation:[{page:"videos",text:"Video Tutorials"},{page:"faq",text:"F.A.Q."},{page:"credits",text:"Credits"}],DEFAULT_PAGE:"home",launch:function(){this.growl=new visualHUD.Widgets.Growl({offset:7});this.setupViewport();this.setupRouter()},setupRouter:function(){this.router=new visualHUD.Routers.HelpRouter();this.router.on("update",this.viewport.setPage,this.viewport);this.router.on("navigate.section",this.viewport.setSection,this.viewport);this.router.on("update.error",function(b){this.growl.alert({status:"error",title:b.statusText,message:"Something goes wrong ;("})},this);Backbone.history.start();var a=Backbone.history.getHash();if(!a){this.router.page(this.DEFAULT_PAGE)}},setupViewport:function(){this.viewport=new visualHUD.Views.HelpPageViewport({el:$("body")})}});visualHUD.Routers.HelpRouter=Backbone.Router.extend({routes:{":page":"page",":page/:section":"page"},xhr:null,location:null,activeLocation:null,cache:{},initialize:function(a){_.extend(this,a||{})},page:function(b,d){var d=d||null;if(this.xhr!==null){this.xhr.abort();this.xhr=null}var a=this.cache[b];if(a!=undefined){this.updateContent(a,b,d)}else{this.xhr=$.ajax({url:b+".html",complete:visualHUD.Function.bind(this.onRequestComplete,this,[b,d],true)})}var c=Array.prototype.slice.call(arguments).join("/");this.navigate(c)},onRequestComplete:function(f,a,d,e){var c=f.status,b=f.responseText;if(c==200){this.cache[d]=true;this.updateContent(b,d,e)}else{this.trigger("update.error",f)}},updateContent:function(b,c,d){var a=c+d;if(this.activeLocation!=a){this.activeLocation=a;this.trigger("update",c,d,b)}}});visualHUD.Widgets.Growl=Backbone.View.extend({tagName:"div",className:"growl-message-container",msgTpl:['<div class="growl-message-wrapper clearfloat">','<div class="growl-message">','<a class="close-message">&times;</a>','<div class="message">',"<% if(title) { %>","<h4><%= title %></h4>","<% } %>","<div><%= message %></div>","</div>","</div>","</div>"],active:0,stack:[],messageLog:[],messagesCounter:0,defaults:{speed:300,delay:50000,offset:10,status:"working",fixed:false,single:false,maxMessages:8,className:"growl-message-container",position:"bottom-right"},defaultMessageOptions:{title:null,message:"This is growl message",status:null},currentPosition:null,events:{"click a.close-message":"hideMessage","contextmenu div.growl-message-wrapper":"hideMessage"},disabled:false,visible:false,rendered:false,initialize:function(a){this.options=_.extend({},this.defaults,a||{});this.$el.css({margin:this.options.offset}).addClass(this.options.position);this.bindEvents()},render:function(){this.$el.appendTo(document.body);this.rendered=true;this.trigger("render",this)},bindEvents:function(){if(this.options.render){this.on("render",this.options.render,this.options.scope||this)}if(this.options.show){this.on("show",this.options.show,this.options.scope||this)}if(this.options.hide){this.on("hide",this.options.hide,this.options.scope||this)}},getDOMRefs:function(){},alert:function(a){if(this.rendered==false){this.render()}if(this.options.single){this.$el.children().remove()}this.$el.show();var a=_.extend({},this.defaultMessageOptions,a);var b=_.template(this.msgTpl.join(""),a);var c=$(b).addClass(a.status||this.options.status).css("display","none");var f=this.options.position.split("-").shift();var e=f=="bottom"?"prependTo":"appendTo";var d=visualHUD.Function.createDelayed(this.hide,a.delay||this.options.delay,this,[c]);this.$messages=this.$el.children();if(this.$messages.length>this.options.maxMessages){this.hide(this.$messages.eq(0))}c[e](this.$el).fadeTo(this.options.speed,1);d();this.trigger("show",[this]);return c},hide:function(a){var b=this;if(a){a.find(".growl-message").hide(this.options.speed/2,function(){a.remove();if(b.$el.children().length==0){b.$el.hide()}})}else{$messages.remove();this.$el.hide()}this.trigger("hide",[this]);return this},hideMessage:function(b){var c=$(b.currentTarget);var a=c.closest(".growl-message-wrapper",this.$el);if(a.length){this.hide(a)}return false}});visualHUD.Libs.utility={getGuid:function(){var a=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a())},fontToBoxSize:function(a){return{width:Math.round(104*a),height:Math.round(36*a)}},hexToQLColor:function(g){var f=$.color(g);var e=[];for(var d=0,c=f.rgb.length;d<c;d++){e[d]=f.rgb[d]/255;e[d]=Math.floor(e[d]*100);e[d]=e[d]/100}return e.join(" ")},convertQLColor:function(g){g=g.split(" ");var f=[];for(var d=0,c=g.length;d<c;d++){f[d]=Math.floor(g[d]*255)}var e=$.color(f);return e},getBoxGradients:function(d,f,k){var d=parseInt(d,10);if(d==0){return["none !important"]}var g="rgba(<%= color %>,<%= opacity %>)",n=f.rgb.join(",");var i=[_.template(g,{color:n,opacity:k}),_.template(g,{color:n,opacity:0})],h=["-moz-linear-gradient","-webkit-linear-gradient","linear-gradient","-ms-linear-gradient"],m=[],q=[],j="<%= prefix %>(<%= direction %>,  <%= colorStart %> 0%, <%= colorEnd %> 100%)";switch(d){case 1:m=("top,top,to bottom,top").split(",");break;case 2:m=("bottom,bottom,to top,bottom").split(",");break;case 3:m=("left,left,to right,left").split(",");break;case 4:m=("right,right,to left,right").split(",");break}for(var p=0,o=h.length;p<o;p++){q.push(_.template(j,{prefix:h[p],direction:m[p],colorStart:i[0],colorEnd:i[1]}))}if($.browser.msie){var e=Math.floor(k*255).toString(16);var l=f.hex.replace("#","#"+e);var c=f.hex.replace("#","#00");switch(d){case"0":direction=0;i=[l,l];break;case"1":direction=0;i=[l,c];break;case"2":direction=0;i=[c,l];break;case"3":direction=1;i=[l,c];break;case"4":direction=1;i=[c,l];break}d="progid:DXImageTransform.Microsoft.Gradient(GradientType="+direction+', StartColorStr="'+i[0]+'", EndColorStr="'+i[1]+'")'}return q},getRCornersMarkup:function(g){var j={"3":[[0,50,95],[50,100,100],[95,100,100]],"5":[[0,0,25,70,90],[0,48,100,100,100],[25,100,100,100,100],[70,100,100,100,100],[90,100,100,100,100]],"8":[[0,0,0,0,15,55,80,95],[0,0,0,45,95,100,100,100],[0,0,70,100,100,100,100,100],[0,55,100,100,100,100,100,100],[15,95,100,100,100,100,100,100],[55,100,100,100,100,100,100,100],[80,100,100,100,100,100,100,100],[95,100,100,100,100,100,100,100]]};var c=parseInt(g.borderRadius,10);var p=parseInt(g.opacity,10);var d={topLeft:[0,0],topRight:[0,g.coordinates.width-c],bottomLeft:[g.coordinates.height-c,0],bottomRight:[g.coordinates.height-c,g.coordinates.width-c]};var o=j[c];var f={topLeft:{vertical:1,horizontal:1},topRight:{vertical:1,horizontal:0},bottomLeft:{vertical:0,horizontal:1},bottomRight:{vertical:0,horizontal:0}};var l=function(r){var B=r.direction;var q=r.offset;var E=[];var z,k,t;var C=r.matrix;var u,s;var b=C.length;for(var A in C){A=parseInt(A);u=B.vertical?A:b-1-A;var F=C[u];if(!F){continue}z=q[0]+A;var v=F.length;for(var w in F){w=parseInt(w);s=B.horizontal?w:v-1-w;var D=F[s];if(!D){continue}k=q[1]+w;var a=F[B.horizontal?s-1:s+1];if(a&&a==100){E[E.length-1].width++}else{E.push({top:z,left:k,width:1,height:1,opacity:(p/100)*D})}}}return E};var h=[];for(var e in d){$.merge(h,l({matrix:j[c],offset:d[e],direction:f[e]}))}var i=[c,0,g.coordinates.width-c];for(var n=0,m=3;n<m;n++){h.push({top:n==0?0:c,left:i[n],width:n==0?g.coordinates.width-2*c:c,height:g.coordinates.height-(n==0?0:2*c),opacity:p})}return h}};visualHUD.Function={bind:function(d,c,b,a){if(arguments.length===2){return function(){return d.apply(c,arguments)}}var f=d,e=Array.prototype.slice;return function(){var g=b||arguments;if(a===true){g=e.call(arguments,0);g=g.concat(b)}return f.apply(c||window,g)}},createDelayed:function(e,c,d,b,a){if(d||b){e=visualHUD.Function.bind(e,d,b,a)}return function(){var f=this;return setTimeout(function(){e.apply(f,arguments)},c)}},createBuffered:function(d,a,c,b){return function(){var e;return function(){var h=this,f=b||arguments,g=c||this;if(e){clearTimeout(e);e=null}e=setTimeout(function(){d.apply(g,f)},a)}}()},createThrottled:function(e,b,d){var f,a,c,h,g=function(){e.apply(d||this,c);f=new Date().getTime()};return function(){a=new Date().getTime()-f;c=arguments;clearTimeout(h);if(!f||(a>=b)){g()}else{h=setTimeout(g,b-a)}}}};visualHUD.Views.HelpPageViewport=Backbone.View.extend({events:{"click #navigation a":"resetScroll"},initialize:function(a){$(window).on("scroll",visualHUD.Function.bind(this.scrollSpy,this))},getDOMRefs:function(){var a=this.refs;if(!a){a=this.refs={header:$("div.site-header")}}return a},render:function(a){},scrollSpy:function(){var b=$(window).scrollTop(),a=b>=10;if(a==true&&!this.fixed){this.fixed=true;this.getDOMRefs().header.addClass("site-header-fixed")}if(a==false&&this.fixed){this.fixed=false;this.getDOMRefs().header.removeClass("site-header-fixed")}},setPage:function(f,g,c){var e=$("#content"),a="div.content-"+f,b=e.children().not(a),d=e.find(a);b.hide();if(d.length){d.show()}else{d=$("<div/>").addClass("content-"+f).appendTo(e);d.html(c)}if(g!=null){$.scrollTo("[name="+g+"]",{offset:{top:-1*(this.getDOMRefs().header.height()+parseInt(this.getDOMRefs().header.css("top")))}})}$("#navigation").find("li.active").removeClass("active");$("#navigation").find("li.page-"+f).addClass("active")},resetScroll:function(){$.scrollTo("0px")}});visualHUD.Collections.DictionaryAbstract=Backbone.Collection.extend({autoLoad:true,getData:function(){return[]},load:function(){this.reset(this.getData(),{silent:true});return this}});