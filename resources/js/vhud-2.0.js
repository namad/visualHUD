/*
 * 
 */
new Backbone.Application({name:"app",nameSpace:"visualHUD",scaleFactor:1,ver:"2.0",MAX_BACKGROUND_SIZE:1024*300,allocationMap:{model:"Models",collection:"Collections",controller:"Controllers",view:"Views",viewportViews:"Views.viewport",modalViews:"Views.windows",lib:"Libs",utility:"Utils",widgets:"Widgets"},controllers:["Viewport","HUDManager","KeyboardManager","FocusManager","HistoryManager"],ACTION_CONTACT:"contact.php",ACTION_DOWNLOAD_PRESETS:"download_presets.php",ACTION_DOWNLOAD_HUD:"download.php",messages:{scriptError:"There was an error on this page.",errorReportSuccess:"Thanks, mate. Your report has been sent",noHUDItems:"There are no HUD items yet. C'mon, add some elements first and try again",invalidHUDPreset:"Invalid HUD preset. Aborting...",reportErrorTitle:"Report an application error/bug",editRangesTitle:"Edit {0} color ranges",invalidPresetData:"Application was unable to parse custom HUD data",slowPerformanceProperty:"Depending on your hardware configuration, using {0} may impact your in-game performance and significally lower your FPS.",EMPTY_HUD_WARNING:"Nothing to download, mate. Try to add new items or import custom HUD first.",HUD_ELEMENTS_PARSE_ERROR:"visualHUD was unable to parse <%= count %> HUD element<%= count==1 ? '' : 's' %> because the data is incorrect or currupted",HUD_PARSE_ERROR:"visualHUD was unable to parse custom HUD because the data is incorrect or corrupted",LARGE_IMAGE_WARNING:"Image you are trying to import, are too large (<%= imageSize %>). Please, try another image that is less than <%= maxSize %>",UNSUPPORTED_IMAGE_FORMAT:"Image type you are trying to import is not supported (<%= imageType %>). Try to import images in PNG, JPG or GIF format",CONFIRM_APPLICATION_RESET:"Are you sure to reset visualHUD?\nAll settings and stored data will be cleared!",CONFIRM_HUD_OVERWRITE:"Are you sure to overwrite current HUD? All changes will be lost!",AJAX_ERROR:"<%= url %> request returned error:<br /><strong><%= error %></strong>"},initialize:function(){},launch:function(){var c=window.location.hostname,d=window.location.search;if(d.match("(\\?|&)large")!==null){this.scaleFactor=2}$("body").addClass("scale-factor-"+this.scaleFactor);this.toolTips=new visualHUD.Widgets.ToolTip({delay:500});this.growl=new visualHUD.Widgets.Growl({offset:7});$("#preloader").fadeOut(400,function(){$(this).remove()});window.onerror=visualHUD.Function.createBuffered(this.applicationErrorHandler,50,this);$(document).ajaxError(visualHUD.Function.bind(function(g,f,h,e){this.ajaxErrorAlert=this.growl.alert({status:"error",title:"Oops.. Something goes wrong ;(",message:_.template(this.messages.AJAX_ERROR,{url:h.url,error:f.status+" "+e})})},this))},applicationErrorHandler:function(h,g,c){var f=$.browser.version;var e=["\n-----------------------\n"];for(var d in $.browser){if(d!="version"){e.push(d)}}e=e.join("/")+" ver."+f+"\n";$.ajax({type:"post",url:visualHUD.ACTION_CONTACT,data:[{name:"name",value:"VisualHUD Automated Reported"},{name:"email",value:"vhud@pk69.com"},{name:"message",value:_.template("Error: <%= errorMsg %>\nURL: <%= url %>\nLine: <%= lineNumber %><%= browserInfo %>",{errorMsg:h,url:g,lineNumber:c,browserInfo:e})}],success:visualHUD.Function.bind(function(){if(this.growl==undefined){return true}var i=(["<p><%= errorMsg %><br />","<%= url %> (line: <%= lineNumber %>)</p>","But no worries, mate, this problem has been already reported."]).join("");$alert=this.growl.alert({status:"error",title:"Oops.. Something goes wrong ;(",message:_.template(i,{errorMsg:h,url:g,lineNumber:c})})},visualHUD)})},confirm:function(c){return new visualHUD.Views.windows.Confirm(c).show()}});visualHUD.Libs.utility={getGuid:function(){var c=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c())},fontToBoxSize:function(c){return{width:Math.round(104*c),height:Math.round(36*c)}},hexToQLColor:function(g){var f=$.color(g);var e=[];for(var d=0,c=f.rgb.length;d<c;d++){e[d]=f.rgb[d]/255;e[d]=Math.floor(e[d]*100);e[d]=e[d]/100}return e.join(" ")},convertQLColor:function(g){g=g.split(" ");var f=[];for(var d=0,c=g.length;d<c;d++){f[d]=Math.floor(g[d]*255)}var e=$.color(f);return e},getBoxGradients:function(d,f,k){var d=parseInt(d,10);if(d==0){return["none !important"]}var g="rgba(<%= color %>,<%= opacity %>)",n=f.rgb.join(",");var i=[_.template(g,{color:n,opacity:k}),_.template(g,{color:n,opacity:0})],h=["-moz-linear-gradient","-webkit-linear-gradient","linear-gradient","-ms-linear-gradient"],m=[],q=[],j="<%= prefix %>(<%= direction %>,  <%= colorStart %> 0%, <%= colorEnd %> 100%)";switch(d){case 1:m=("top,top,to bottom,top").split(",");break;case 2:m=("bottom,bottom,to top,bottom").split(",");break;case 3:m=("left,left,to right,left").split(",");break;case 4:m=("right,right,to left,right").split(",");break}for(var p=0,o=h.length;p<o;p++){q.push(_.template(j,{prefix:h[p],direction:m[p],colorStart:i[0],colorEnd:i[1]}))}if($.browser.msie){var e=Math.floor(k*255).toString(16);var l=f.hex.replace("#","#"+e);var c=f.hex.replace("#","#00");switch(d){case"0":direction=0;i=[l,l];break;case"1":direction=0;i=[l,c];break;case"2":direction=0;i=[c,l];break;case"3":direction=1;i=[l,c];break;case"4":direction=1;i=[c,l];break}d="progid:DXImageTransform.Microsoft.Gradient(GradientType="+direction+', StartColorStr="'+i[0]+'", EndColorStr="'+i[1]+'")'}return q},getRCornersMarkup:function(g){var j={"3":[[0,50,95],[50,100,100],[95,100,100]],"5":[[0,0,25,70,90],[0,48,100,100,100],[25,100,100,100,100],[70,100,100,100,100],[90,100,100,100,100]],"8":[[0,0,0,0,15,55,80,95],[0,0,0,45,95,100,100,100],[0,0,70,100,100,100,100,100],[0,55,100,100,100,100,100,100],[15,95,100,100,100,100,100,100],[55,100,100,100,100,100,100,100],[80,100,100,100,100,100,100,100],[95,100,100,100,100,100,100,100]]};var c=parseInt(g.borderRadius,10);var p=parseInt(g.opacity,10);var d={topLeft:[0,0],topRight:[0,g.coordinates.width-c],bottomLeft:[g.coordinates.height-c,0],bottomRight:[g.coordinates.height-c,g.coordinates.width-c]};var o=j[c];var f={topLeft:{vertical:1,horizontal:1},topRight:{vertical:1,horizontal:0},bottomLeft:{vertical:0,horizontal:1},bottomRight:{vertical:0,horizontal:0}};var l=function(t){var D=t.direction;var s=t.offset;var G=[];var B,r,v;var E=t.matrix;var w,u;var q=E.length;for(var C in E){C=parseInt(C);w=D.vertical?C:q-1-C;var H=E[w];if(!H){continue}B=s[0]+C;var z=H.length;for(var A in H){A=parseInt(A);u=D.horizontal?A:z-1-A;var F=H[u];if(!F){continue}r=s[1]+A;var k=H[D.horizontal?u-1:u+1];if(k&&k==100){G[G.length-1].width++}else{G.push({top:B,left:r,width:1,height:1,opacity:(p/100)*F})}}}return G};var h=[];for(var e in d){$.merge(h,l({matrix:j[c],offset:d[e],direction:f[e]}))}var i=[c,0,g.coordinates.width-c];for(var n=0,m=3;n<m;n++){h.push({top:n==0?0:c,left:i[n],width:n==0?g.coordinates.width-2*c:c,height:g.coordinates.height-(n==0?0:2*c),opacity:p})}return h}};visualHUD.Function={bind:function(f,e,d,c){if(arguments.length===2){return function(){return f.apply(e,arguments)}}var h=f,g=Array.prototype.slice;return function(){var i=d||arguments;if(c===true){i=g.call(arguments,0);i=i.concat(d)}return h.apply(e||window,i)}},createDelayed:function(g,e,f,d,c){if(f||d){g=visualHUD.Function.bind(g,f,d,c)}return function(){var h=this;return setTimeout(function(){g.apply(h,arguments)},e)}},createBuffered:function(f,c,e,d){return function(){var g;return function(){var j=this,h=d||arguments,i=e||this;if(g){clearTimeout(g);g=null}g=setTimeout(function(){f.apply(i,h)},c)}}()},createThrottled:function(g,d,f){var h,c,e,j,i=function(){g.apply(f||this,e);h=new Date().getTime()};return function(){c=new Date().getTime()-h;e=arguments;clearTimeout(j);if(!h||(c>=d)){i()}else{j=setTimeout(i,d-c)}}}};visualHUD.Libs.itemBuilderMixin={getByType:function(c){return this[c]},getByName:function(c){return this[c]},general:{getRgba:_.template("rgba(<%= color %>,<%= opacity%>)"),updateTextSize:function(d){var c=parseInt(d,10)*visualHUD.scaleFactor,e=visualHUD.Libs.utility.fontToBoxSize(c/100);this.getDOMRefs().textBlock.width(e.width).height(e.height).css("line-height",e.height+"px");this.getDOMRefs().counter.css({"font-size":c+"%"})},updateTextStyle:function(d){var e=this.getDOMRefs().counter.attr("class"),c=/textstyle-[0-9]/;if(c.test(e)){e=e.replace(c,"");e=$.trim(e)}e+=(" textstyle-"+d);this.getDOMRefs().counter.attr("class",e)},updateTextOpacity:function(d){var c=parseInt(d,10);this.getDOMRefs().textBlock.css("opacity",c/100)},updateIconSpacing:function(d){var e=parseInt(d,10)*visualHUD.scaleFactor,c=this.model.get("iconPosition");this.updateIconPositionAndSpacing(c,e)},updateIconPosition:function(d){var e=parseInt(this.model.get("iconSpacing"),10)*visualHUD.scaleFactor,c=d;this.updateIconPositionAndSpacing(c,e)},updateIconPositionAndSpacing:function(d,i){var h={left:"margin-right",top:"margin-bottom",right:"margin-left",bottom:"margin-top"},g=[this.getDOMRefs().textBlock,this.getDOMRefs().iconBlock];this.getDOMRefs().iconBlock.css("margin","auto").css(h[d],i+"px");if(d.match(/left|top/gi)){g=[this.getDOMRefs().iconBlock,this.getDOMRefs().textBlock]}var f=d=="left"||d=="right"?"removeClass":"addClass";this.$el[f]("icon-top");for(var e=0,c=g.length;e<c;e++){g[e].appendTo(this.$el)}},updateIconOpacity:function(d){var c=parseInt(d,10);this.getDOMRefs().iconBlock.css("opacity",c/100)},updateIconSize:function(d){var c=parseInt(d,10)*visualHUD.scaleFactor;this.getDOMRefs().icon.css({});this.getDOMRefs().iconBlock.css({width:c+"px",height:c+"px",display:c==0?"none":""})},updateIconStyle:function(e){var c=parseInt(e,10),d=this.getIconOptions();iconData=d[c];this.getDOMRefs().icon.attr("src",iconData.url)},updateTextColorByStatus:function(f,d){var c=parseInt(f,10),e=this.model.get("textColor");_.each(d,function(g){if(c>=g.range[0]&&c<=g.range[1]){e=g.color;return{}}},this);this.getDOMRefs().counter.css({color:"#"+e})},updateTextColor:function(c){this.getDOMRefs().counter.css({color:"#"+c})},updateText:function(d){this.getDOMRefs().counter.text(d);var c=this.model.get("colorRanges");if(c!=null){this.updateTextColorByStatus(d,c)}},updateColorRanges:function(c){var d=this.model.get("text");this.updateTextColorByStatus(d,c)}},timer:{updateTextSize:function(c){visualHUD.Libs.itemBuilderMixin.getByType("general").updateTextSize.call(this,c);this.getDOMRefs().textBlock.width("auto")}},medal:{updateIconStyle:function(c){visualHUD.Libs.itemBuilderMixin.getByType("general").updateIconStyle.apply(this,arguments);var e=parseInt(this.model.get("iconStyle"),10);var d=this.model.get("text");this.updateText(d)},updateText:function(c){var d=parseInt(this.model.get("iconStyle"),10);if(d==0&&c.match(/\%$/)==null){c+="%"}if(d>0){c=c.replace("%","")}this.getDOMRefs().counter.text(c)},updateTextSize:function(c){visualHUD.Libs.itemBuilderMixin.getByType("timer").updateTextSize.apply(this,arguments)}},powerupIndicator:{updateTextSize:function(c){visualHUD.Libs.itemBuilderMixin.getByType("timer").updateTextSize.apply(this,arguments)},updateIconSpacing:function(e){var d=parseInt(e,10);var c=this.$el.find("div.powerup-item:last").eq(0);c.css("margin","auto");if(!this.model.get("singlePowerup")){c.css("margin-"+this.model.get("iconPosition"),d*visualHUD.scaleFactor)}},updateIconPosition:function(f){var g=this.$el.attr("class").toLowerCase(),e=/stack-[a-z]/,d=parseInt(this.model.get("iconSize"),10),c=parseInt(this.model.get("iconSpacing"),10),h=visualHUD.Libs.utility.fontToBoxSize(d/100);if(e.test(g)){g=g.replace(e,"");g=$.trim(g)}g+=(" stack-"+f);this.$el.attr("class",g);this.updateIconSpacing(c)},updateSinglePowerup:function(d){var c=d?"addClass":"removeClass";this.$el[c]("single-powerup")}},accuracyIndicator:{updateTextSize:function(e){visualHUD.Libs.itemBuilderMixin.getByType("general").updateTextSize.call(this,e);var c=parseInt(e,10)/100;var d=Math.round(128*c)*visualHUD.scaleFactor;this.getDOMRefs().textBlock.width(d)},updateText:function(c){this.getDOMRefs().counter.text(c+"%")}},skillIndicator:{updateTextSize:function(e){var c=parseInt(e,10)*visualHUD.scaleFactor;var f=visualHUD.Libs.utility.fontToBoxSize(c/100);this.getDOMRefs().textBlock.height(f.height).css("line-height",f.height+"px");this.$el.height(f.height).css("line-height",f.height+"px");var d={"line-height":f.height+"px","font-size":c+"%"};this.getDOMRefs().counter.css(d);this.getDOMRefs().templateText.css(d)},updateTextStyle:function(d){var e=this.getDOMRefs().counter.attr("class");var c=/textstyle-[0-9]/;if(c.test(e)){e=e.replace(c,"");e=$.trim(e)}e+=(" textstyle-"+d);this.getDOMRefs().counter.attr("class",e)},updateTemplate:function(c){this.getDOMRefs().templateText.html(c+(c.length?":&nbsp;":""))},updateTextColor:function(c){this.getDOMRefs().templateText.css({color:"#"+c})}},chatArea:{updatePadding:function(c){var d=parseInt(c,10)*visualHUD.scaleFactor;this.getDOMRefs().chatList.css({padding:d})},updateShowChat:function(d){var c=(d?"add":"remove")+"Class";this.$el[c]("chat-visible");c=(d?"remove":"add")+"Class";this.$el[c]("chat-invisible")},updateWidth:function(e){var d=parseInt(e,10),c=this.model.get("height"),f=this.model.get("padding");this.updateDimensions(d,c,f)},updateHeight:function(e){var c=parseInt(e,10),d=this.model.get("width"),f=this.model.get("padding");this.updateDimensions(d,c,f)},updatePadding:function(e){var f=parseInt(e,10),d=this.model.get("width"),c=this.model.get("height");this.updateDimensions(d,c,f)},updateDimensions:function(g,c,j){g*=visualHUD.scaleFactor;c*=visualHUD.scaleFactor;j*=visualHUD.scaleFactor;var i=2*j+this.model.get("minHeight")*visualHUD.scaleFactor;var f=2*j+this.model.get("minWidth")*visualHUD.scaleFactor;var d=Math.max(f,g);var e=Math.max(i,c);d=this.model.get("maxWidth")?Math.min(this.model.get("maxWidth")*visualHUD.scaleFactor,d):d;this.$el.width(d);e=this.model.get("maxHeight")?Math.min(this.model.get("maxHeight")*visualHUD.scaleFactor,e):e;this.$el.height(e);this.getDOMRefs().chatList.css("margin",j)}},scoreBox:{updateIconStyle:function(e){var f=this.$el.attr("class");var c=f;var d=/style-[0-9]/;if(d.test(f)){c=f.replace(d,"");c=$.trim(c)}c+=(" style-"+e);this.$el.attr("class",c)},updateIconSpacing:function(d){var e=parseInt(d,10)*visualHUD.scaleFactor,c=this.model.get("scoreboxLayout");this.updateLayoutAndSpacing(c,e)},updateScoreboxLayout:function(d){var e=parseInt(this.model.get("iconSpacing"),10)*visualHUD.scaleFactor,c=d;this.updateLayoutAndSpacing(c,e)},updateLayoutAndSpacing:function(g,i){var d={vertical:"margin-top",horizontal:"margin-left"};var h={vertical:"scorebox-vertical",horizontal:"scorebox-horizontal"};for(var c in h){var f=c==g?"addClass":"removeClass";this.$el[f](h[c])}var e=this.getDOMRefs().iconBlock.eq(1);e.css("margin",0).css(d[g],i+"px")},updateScoreboxMode:function(f){var e={ffa:"ffa-score",tdm:"team-score"};for(var c in e){var d=c==f?"addClass":"removeClass";this.$el[d](e[c])}}},bar:{updateBarDirection:function(d){var e=parseInt(d,10);var c=["ltr-bar","rtl-bar"];_.each(c,function(h,f){var g=f==e?"addClass":"removeClass";this.$el[g](c[f])},this)},updateWidth:function(e){var d=parseInt(e,10),c=this.model.get("height"),f=this.model.get("padding");this.updateBarDimensions(d,c,f)},updateHeight:function(e){var c=parseInt(e,10),d=this.model.get("width"),f=this.model.get("padding");this.updateBarDimensions(d,c,f)},updatePadding:function(e){var f=parseInt(e,10),d=this.model.get("width"),c=this.model.get("height");this.updateBarDimensions(d,c,f)},updateBarDimensions:function(g,c,j){g*=visualHUD.scaleFactor;c*=visualHUD.scaleFactor;j*=visualHUD.scaleFactor;var i=2*j+this.model.get("minHeight")*visualHUD.scaleFactor;var f=2*j+this.model.get("minWidth")*visualHUD.scaleFactor;var d=Math.max(f,g);var e=Math.max(i,c);d=this.model.get("maxWidth")?Math.min(this.model.get("maxWidth")*visualHUD.scaleFactor,d):d;this.$el.width(d);e=this.model.get("maxHeight")?Math.min(this.model.get("maxHeight")*visualHUD.scaleFactor,e):e;this.$el.height(e);this.getDOMRefs().box.css("padding",j)},updateText:function(g){var f=parseInt(g,10);var e={h100:f>100?100:f,h200:f>100?f-100:0};for(var d in e){this.getDOMRefs()[d].css("width",e[d]+"%")}var c=this.model.get("colorRanges");if(c!=null){this.updateTextColorByStatus(f,c)}},updateColorRanges:function(c){var d=parseInt(this.model.get("text"),10);this.updateTextColorByStatus(d,c)},updateTextColorByStatus:function(f,c){var e=parseInt(this.model.get("barsOpacity"),10),d=null;_.each(c,function(g){if(f<=100&&f>=g.range[0]&&f<=g.range[1]){d=$.color("#"+g.color);this.paintBarElement(this.getDOMRefs().h100,d,e)}else{if(f>=g.range[0]&&f<=g.range[1]){d=$.color("#"+g.color);(f>100)&&this.paintBarElement(this.getDOMRefs().h200,d,e)}if(100>=g.range[0]&&100<=g.range[1]){d=$.color("#"+g.color);this.paintBarElement(this.getDOMRefs().h100,d,e)}}},this)},updateBarsOpacity:function(e){var c=this.model.get("colorRanges");var d=parseInt(this.model.get("text"),10);if(c!=null){this.updateTextColorByStatus(d,c)}},paintBarElement:function(e,c,d){e.css("background",this.getRgba({color:c.rgb.join(","),opacity:d/100}))},updateColor:function(e){var c=$.color("#"+e);var d=parseInt(this.model.get("opacity"),10);this.paintBarElement(this.getDOMRefs().box,c,d)},updateOpacity:function(e){var d=parseInt(e,10);var c=$.color("#"+this.model.get("color"));this.paintBarElement(this.getDOMRefs().box,c,d)}},rect:{updateWidth:function(e){var d=parseInt(e,10),c=this.model.get("height");this.updateDimensions(d,c)},updateHeight:function(e){var c=parseInt(e,10),d=this.model.get("width");this.updateDimensions(d,c)},updateDimensions:function(g,c){g*=visualHUD.scaleFactor;c*=visualHUD.scaleFactor;var i=this.model.get("minHeight")*visualHUD.scaleFactor;var f=this.model.get("minWidth")*visualHUD.scaleFactor;var d=Math.max(f,g);var e=Math.max(i,c);d=this.model.get("maxWidth")?Math.min(this.model.get("maxWidth")*visualHUD.scaleFactor,d):d;this.$el.width(d);e=this.model.get("maxHeight")?Math.min(this.model.get("maxHeight")*visualHUD.scaleFactor,e):e;this.$el.height(e)},updateColor:function(c){this.updateBoxStyle()},updateOpacity:function(c){this.updateBoxStyle()},updateBorderRadius:function(e){var c=parseInt(e,10);var f=this.getDOMRefs().box.attr("class"),d=/rbox-[0-9]/;if(d.test(f)){f=f.replace(d,"");f=$.trim(f)}f+=(" rbox-"+c);this.getDOMRefs().box.attr("class",f);if(c>0){this.model.set("boxStyle",0,{silent:true});this.getForm().setValues({boxStyle:0},{silent:true});this.updateBoxStyle(0)}},updateBoxStyle:function(){var e=parseInt(this.model.get("boxStyle"),10);var c=$.color("#"+this.model.get("color"));var d=this.model.get("opacity")/100;var f=e>0&&parseInt(this.model.get("borderRadius"),10)==0;if(f){this.getDOMRefs().box.css("background",c.hex);_.each(visualHUD.Libs.utility.getBoxGradients(e,c,d),function(g){this.getDOMRefs().box.css("background",g)},this)}else{this.getDOMRefs().box.css("background",this.getRgba({color:c.rgb.join(","),opacity:d}))}if(e>0){this.model.set("borderRadius",0,{silent:true});this.getForm().setValues({borderRadius:0},{silent:true});this.updateBorderRadius(0)}}},obits:{updateTextSize:function(c){},updateTextStyle:function(c){},updateTextOpacity:function(c){},updateIconPosition:function(c,d){},updateIconOpacity:function(c){},updateIconSize:function(c){},updateIconStyle:function(c){},updateIconSpacing:function(c){},updateTextColor:function(c){},updateTeamColors:function(c){},updateColorRanges:function(c){},updateText:function(c){},updateBorderRadius:function(c){},updateBoxStyle:function(c){},updateTemplate:function(c){},updatePowerupView:function(c){},updatePadding:function(c){},updateToggleChat:function(c){},updateScoreboxLayout:function(c){}}};visualHUD.Libs.layersManager={alignItem:function(g,f,e){var d=g.$el,c={};switch(e){case"top":c={top:f[0].top};break;case"bottom":c={top:Math.round(f[0].top+f[0].height-f[1].height)};break;case"vertical":c={top:Math.round(f[0].top+(f[0].height-f[1].height)/2)};break;case"left":c={left:f[0].left};break;case"right":c={left:Math.round(f[0].left+f[0].width-f[1].width)};break;case"horizontal":c={left:Math.round(f[0].left+(f[0].width-f[1].width)/2)};break}d.css(c);return c},alignEdges:function(h,f){var g=h.getSelection(),i=g.length>1&&g[0].getGroup()!=null;boxes=[];if(g.length==1||i){var e=g[0];boxes.push({top:0,left:0,width:h.$el.width(),height:h.$el.height()},e.$el.coordinates(true,false));if(i==false){this.alignItem(g[0],boxes,f)}else{console.info("Could not align grouped items yet :(")}}else{for(var d=0,c=g.length;d<c;d++){boxes.push(g[d].$el.coordinates(true,false));if(d>0){this.alignItem(g[d],[boxes[0],boxes[d]],f)}}}},arrangeLayers:function(i,f){var e=i.getSelection();if(e.length==0){return}var d=e[0].$el;var h=i.$canvas;var j={"bring-front":{element:h,fn:"appendTo"},"send-back":{element:h,fn:"prependTo"},"bring-forward":{element:d.next(),fn:"insertAfter"},"send-backward":{element:d.prev(),fn:"insertBefore"}};var g;var c=j[f];if(c.element.length&&c.element[0]!=d[0]){d[c.fn](c.element)}}};visualHUD.Libs.canvasDragInterface={offsets:[],getView:function(){return this.options.view},setMode:function(c){switch(c){case"move":this.setOptions({bodyDragClass:"drag",onbeforestart:this.beforeStart,onstart:this.startMoveElement,ondrag:null,ondrop:null});break;case"select":this.setOptions({bodyDragClass:"drag-select",onbeforestart:null,onstart:this.startDragSelect,ondrag:null,ondrop:null});break;case"resize":this.setOptions({bodyDragClass:"resize",onbeforestart:null,onstart:this.startResizeBox,ondrag:null,ondrop:null});break;case"draw":this.setOptions({bodyDragClass:"draw",onbeforestart:this.beforeStart,onstart:this.startDrawRect,ondrag:this.drawRect,ondrop:this.drawRectDrop});break;default:this.setOptions({bodyDragClass:"",onbeforestart:null,onstart:null,ondrag:null,ondrop:null})}return this},beforeStart:function(c,d,e){var f=this.currentElement.offsetParent();this.offsets=[];this.limits={top:0,left:0,right:f.width(),bottom:f.height()}},setDragHandle:function(c){this.resizeHandle=c;return this},startDrawRect:function(d,c){this.currentElement=this.drawBox.clone().css({top:Math.round(this.mouse.y),left:Math.round(this.mouse.x)}).appendTo(visualHUD.application.hudElementsWrap);this.mode="drawRect"},drawRect:function(f,c,i,j){if(this.options.grid){this.mouse.x-=this.mouse.x%this.options.grid;this.mouse.y-=this.mouse.y%this.options.grid;j.x-=j.x%this.options.grid;j.y-=j.y%this.options.grid}var k=Math.abs(this.mouse.x-j.x);var g=Math.abs(this.mouse.y-j.y);var m=Math.min(this.mouse.y,j.y)-this.limits.top;var e=Math.min(this.mouse.x,j.x)-this.limits.left;if(m<0){m=0;g=this.mouse.y-this.limits.top}else{g=j.y>this.limits.bottom?this.limits.bottom-this.mouse.y:g}if(e<0){e=0;k=this.mouse.x-this.limits.left}else{k=j.x>this.limits.right?this.limits.right-this.mouse.x:k}if(this.options.grid){e-=e%this.options.grid;m-=m%this.options.grid}var d={width:k,height:g,top:Math.round(m),left:Math.round(e)};this.currentElement.css(d);return d},drawRectDrop:function(){var c={name:"rectangleBox",itemType:"rect",label:"Rectangle box",cssClass:"lib-element-rect"};visualHUD.constructor.fn.createRect(c,this.currentElement);this.currentElement.trigger("click");_data=this.currentElement.data("HUDItem")},startDragSelect:function(d,e,c){var h=this;this.rubberBox=this.rubberBox||$("<div />").addClass("rubber-box");this.currentElement=this.rubberBox.css({width:1,height:1,top:Math.round(this.mouse.y),left:Math.round(this.mouse.x)}).appendTo(this.getView().$canvas);var f=this.getView().$canvas.find("div.hud-item");var g=[];f.each(function(){var i=$(this);g.push({element:i,coordinates:i.coordinates(true,false)})});this.limits=this.getView().getCanvasOffset();this.getView().deselect();this.elementCoordinatesCache=g;this.setOptions({ondrag:this.dragSelect,ondrop:this.dragSelectDrop})},dragSelect:function(h,c,i,j){var e=this.drawRect.apply(this,arguments);e.right=e.left+e.width;e.bottom=e.top+e.height;var g,d;for(var l=0,k=this.elementCoordinatesCache.length;l<k;l++){g=this.elementCoordinatesCache[l];var f=g.element;var m=g.coordinates;var d=e.right>m.left&&e.left<m.right&&e.bottom>m.top&&e.top<m.bottom?"addClass":"removeClass";f[d]("selected")}},dragSelectDrop:function(e,f){var c=this.getView();this.rubberBox&&this.rubberBox.remove();this.currentElement=null;this.elementCoordinatesCache=null;var d=c.$canvas.find("div.selected");window.setTimeout(function(){d.each(function(){c.select(this,true)})},20);this.setMode(null);return false},startResizeBox:function(d,e,c){this.resizeDirection=this.currentElement.data("resizedirection");this.currentElement=this.currentElement.closest("div.hud-item");this.limits=this.getView().getCanvasOffset();this.positionCache=null;this.setOptions({ondrag:this.resizeBox,ondrop:this.resizeBoxDrop})},resizeBox:function(f,d,i,j){if(this.options.grid){j.x-=j.x%this.options.grid;j.y-=j.y%this.options.grid}var i=this.positionCache=this.positionCache||this.currentElement.position();var n=i.top;var e=i.left;var m=this.positionCache.width||this.currentElement.width();var g=this.positionCache.height||this.currentElement.height();var k=i.top+g;var c=i.left+m;if(this.resizeDirection=="n"||this.resizeDirection=="ne"||this.resizeDirection=="nw"){n=Math.max(j.y-this.limits.top,0);g=Math.max(k-n,1);if(g==1){n=k-g}}if(this.resizeDirection=="w"||this.resizeDirection=="nw"||this.resizeDirection=="sw"){e=Math.max(j.x-this.limits.left,0);m=Math.max(c-e,1);if(m==1){e=c-m}}if(this.resizeDirection=="e"||this.resizeDirection=="ne"||this.resizeDirection=="se"){m=j.x-i.left-this.limits.left;m=j.x>this.limits.right?this.limits.right-this.limits.left-i.left:m}if(this.resizeDirection=="s"||this.resizeDirection=="se"||this.resizeDirection=="sw"){g=j.y-i.top-this.limits.top;g=j.y>this.limits.bottom?this.limits.bottom-this.limits.top-i.top:g}if(this.options.grid){m-=m%this.options.grid;g-=g%this.options.grid}i=this.positionCache={width:Math.max(1,m),height:Math.max(1,g),top:n,left:e};this.currentElement.css(i)},resizeBoxDrop:function(){var c=this.currentElement.data("HUDItem");this.positionCache.height=Math.max(c.model.get("minHeight")*visualHUD.scaleFactor+c.model.get("padding")*2*visualHUD.scaleFactor,this.positionCache.height);this.positionCache.width=Math.max(c.model.get("minWidth")*visualHUD.scaleFactor+c.model.get("padding")*2*visualHUD.scaleFactor,this.positionCache.width);c.update({coordinates:{top:Math.round(this.positionCache.top/visualHUD.scaleFactor),left:Math.round(this.positionCache.left/visualHUD.scaleFactor),width:Math.round(this.positionCache.width/visualHUD.scaleFactor),height:Math.round(this.positionCache.height/visualHUD.scaleFactor)},width:this.positionCache.width,height:this.positionCache.height});this.setMode(null);this.positionCache=null},startMoveElement:function(g,d,f){this.setOptions({ondrag:this.moveElement,ondrop:this.moveElementDrop});this.currentElement=this.currentElement.data("HUDItem");this.currentElement.$el.addClass("drag-start");this.slaveElements=[];this.offsets=[];this.drawLine=false;this.getView().select(this.currentElement,true);var l=null,k=this.getView().getSelection(),e=false;if(k.length>1){for(var j=0,i=k.length;j<i;j++){e=k[j].$el.get(0)==this.currentElement.$el.get(0);if(e==false){this.slaveElements.push(k[j])}}var c=this.currentElement.$el.position();for(j=0,i=this.slaveElements.length;j<i;j++){var h=this.slaveElements[j].$el.position();this.offsets.push({top:c.top-h.top,left:c.left-h.left})}}},moveElement:function(f,g,c,d){var e=this.currentElement.checkPosition(c);this.currentElement.$el.css(e);var h;for(a=0,b=this.slaveElements.length;a<b;a++){h=this.slaveElements[a].checkPosition({top:e.top-this.offsets[a].top,left:e.left-this.offsets[a].left});this.slaveElements[a].$el.css(h)}},moveElementDrop:function(c,d,e){this.currentElement.$el.removeClass("drag-start");this.getView().fireEvent("drop.move",[this.currentElement])}};visualHUD.Libs.selectionManagerInterface={selection:[],_deselectBinded:false,_selectionDisabled:false,select:function(f,c){var d;if(f instanceof visualHUD.Views.HUDItem){d=f}else{d=$(f).data("HUDItem")}var e=d.getGroup();var g=this.isSelected(d);if(this._selectionDisabled==false){if(c==false){this.deselect()}if(this.isSelected(d)==false){this.selection.push(d);d.$el.addClass("selected")}(e==null)&&this.fireEvent("selectionchange",[this,this.getSelection()]);if(this._deselectBinded==false){$("body").bind("click.deselect",visualHUD.Function.bind(this.clickDeselect,this));this._deselectBinded=true}}if(e){this.selectByGroup(e)}},isSelected:function(c){return _.include(this.selection,c)},deselect:function(){_.each(this.selection,function(c){c.$el.removeClass("selected")});this.selection.length=0;this.fireEvent("selectionchange",[this,this.getSelection()]);if(this._deselectBinded==true){$("body").unbind("click.deselect");this._deselectBinded=false}},selectAll:function(){var c=this;this.$el.find("div."+visualHUD.Views.HUDItem.prototype.className).each(function(){c.select(this,true)})},selectByGroup:function(d){var c=this;this.$el.find("div."+visualHUD.Views.HUDItem.prototype.className).each(function(){var e=$(this).data("HUDItem"),f=e.getGroup(),g=_.include(c.selection,e);if(f==d&&g==false){c.selection.push(e);e.$el.addClass("selected")}});this.fireEvent("selectionchange",[this,this.getSelection()])},getSelection:function(){return this.selection},disableSelection:function(){this._selectionDisabled=true},enableSelection:function(){this._selectionDisabled=false},clickDeselect:function(d){var f=$(d.target);var c=f.closest("div."+visualHUD.Views.HUDItem.prototype.className,this.$el);var e=f.closest(".vh-viewport-sidebar",document.body);if(c.length==0&&e.length==0){this.deselect()}}};visualHUD.Libs.formControlsBuilder={cache:{},getDefaultsByType:function(c){return this.controlDefaults[c]},getTemplateByType:function(c){return this.controlTemplates[c].join("")},buildForm:function(d){var c=document.createDocumentFragment();if(_.isArray(d)==false){d=[d]}_.each(d,function(e){var g=this.createElementByType(e);c.appendChild(g.get(0));if(e.items!=undefined){var h=this.buildForm(e.items);g.get(0).appendChild(h)}},this);return c},createElementByType:function(c){var e="create"+c.type.charAt(0).toUpperCase()+c.type.substring(1);var d=this[e];if(_.isFunction(d)){return d.apply(this,arguments)}else{return this.createFormControl(c)}},controlDefaults:{container:{cssClass:"",id:"",wrap:false,hint:null},form:{cssClass:"",id:"",action:"",method:"get",wrap:false,hint:null},fieldset:{label:"Fieldset",wrap:false,hint:null},toolbar:{cssClass:"",wrap:false},textbox:{size:"",label:"Textbox",name:"textbox",inputType:"text",value:"",maxlength:"",placeholder:"",hint:null,wrap:true,required:false},fileInput:{size:"",label:"Fileinput",noFileMessage:"No file selected",text:"Browse...",name:"file",value:"",multiple:false,maxlength:"",hint:null,wrap:true},textarea:{rows:2,cols:20,value:"",wrap:true,hint:null,required:false,name:"textarea"},rangeInput:{value:0,name:"rangeinput",hint:null,wrap:true},checkbox:{type:"checkbox",hint:null,label:null,tooltip:null,checked:false,name:"checkbox",value:"on",boxLabel:"Checkbox",wrap:true},checkboxGroup:{wrap:true,hint:null},radiobutton:{type:"radiobutton",hint:null,label:null,tooltip:null,checked:false,name:"radiobutton",value:"on",boxLabel:"Radiobutton",wrap:true},radiobuttonGroup:{wrap:true,hint:null},select:{width:null,value:0,name:"select",hint:null,wrap:true,displayField:"name",valueField:"id",options:{}},button:{name:"",role:"",action:"button",value:"",cssClass:"",tooltip:"",icon:"",text:"Button",wrap:false,hint:null},alignControl:{label:"Align",hint:null,wrap:true},arrangeControl:{label:"Arrange",hint:null,wrap:true},groupActionsControl:{label:"Actions",hint:null,wrap:true},colorPicker:{value:"FFFFFF",name:"color",hint:null,wrap:true}},controlTemplates:{container:["<div></div>"],form:['<form class="<%= cssClass %>" id="<%= id %>" action="<%= action %>" method="<%= method %>">'],toolbar:['<div class="form-toolbar <%= cssClass %> clearfloat"></div>'],textbox:['<input type="<%= inputType %>" size="<%= size %>" name="<%= name %>" value="<%= value %>" placeholder="<%= placeholder %>" maxlength="<%= maxlength %>" <%= required ? \'required="required"\' : \'\' %>  />'],textarea:['<textarea name="<%= name %>" rows="<%= rows %>" cols="<%= cols %>" <%= required ? \'required="required"\' : \'\' %>><%= value %></textarea>'],fieldset:["<fieldset>","<legend><%= label %></legend>","</fieldset>"],fileInput:['<span class="file-input">','<span class="btn <%= cssClass %>"><span><%= text %></span><input type="file" name="<%= name %>" <%= multiple ? \'multiple\' : \'\' %> /></span>','<span class="file-name"><%= noFileMessage %></span>',"</span>"],rangeInput:['<div class="slider"><div class="progress"></div><input type="button" class="handle" /></div>','<input type="text" size="8" maxlength="3" value="<%= value %>" class="range range-input" name="<%= name %>"  />'],checkbox:['<label class="check-label"><input type="checkbox" name="<%= name %>" value="<%= value %>" <%= checked ? \'checked="checked"\' : \'\' %>"><span class="box-label" data-tooltip="<%= tooltip %>"><%= boxLabel %></span></label>'],radiobutton:['<label class="check-label"><input type="radio" name="<%= name %>" value="<%= value %>"  <%= checked ? \'checked="checked"\' : \'\' %>"><span class="box-label" data-tooltip="<%= tooltip %>"><%= boxLabel %></span></label>'],select:['<span class="styled-select w-carret" <% if(width) { %>style="width:<%= width %>"<% }; %>><span class="select-value"></span><select type="text" name="<%= name %>" value="<%= value %>"><%= options %></select></span>'],button:['<button name="<%= name %>" type="<%= action %>" value="<%= value %>" class="<%= cssClass %>" data-tooltip="<%= tooltip %>"><span class="<%= icon %>"><%= text %></span></button>'],alignControl:['<ul class="library-items align-controls icons-24px clearfloat">','<li class="align-top" data-action="top" data-tooltip="Align top edges"><span class="icon"></span><span class="item-name">Top edges</span></li>','<li class="align-vertical" data-action="vertical" data-tooltip="Align vertical centers"><span class="icon"></span><span class="item-name">Vertical centers</span></li>','<li class="align-bottom" data-action="bottom" data-tooltip="Align bottom edges"><span class="icon"></span><span class="item-name">Bottom edges</span></li>','<li class="align-left" data-action="left" data-tooltip="Align left edges"><span class="icon"></span><span class="item-name">Left edges</span></li>','<li class="align-horizontal" data-action="horizontal" data-tooltip="Align horizontal centers"><span class="icon"></span><span class="item-name">Horizontal centers</span></li>','<li class="align-right" data-action="right" data-tooltip="Align right edges"><span class="icon"></span><span class="item-name">Right edges</span></li>',"</ul>"],arrangeControl:['<ul class="library-items arrange-controls icons-24px clearfloat">','<li class="bring-front" data-action="bring-front" data-tooltip="Bring to front <small>(CTRL + SHIFT + UP)</small>"><span class="icon"></span><span class="item-name">Bring to front <small>(CTRL + SHIFT + UP)</small></span></li>','<li class="send-back" data-action="send-back" data-tooltip="Send to back <small>(CTRL + SHIFT + DOWN)</small>"><span class="icon"></span><span class="item-name">Send to back <small>(CTRL + SHIFT + DOWN)</small></span></li>','<li class="bring-forward" data-action="bring-forward" data-tooltip="Bring forward <small>(CTRL + UP)</small>"><span class="icon"></span><span class="item-name">Bring forward <small>(CTRL + UP)</small></span></li>','<li class="send-backward" data-action="send-backward" data-tooltip="Send backward <small>(CTRL + DOWN)</small>"><span class="icon"></span><span class="item-name">Send backward <small>(CTRL + DOWN)</small></span></li>',"</ul>"],groupActionsControl:['<ul class="library-items group-action-controls icons-24px clearfloat">','<li class="delete" data-action="delete-selected" data-tooltip="Delete selected items"></li>','<li class="group" data-action="group-selected" data-tooltip="Group/ungroup selected items"></li>',"</ul>"],colorPicker:['<input type="text" size="6" name="<%= name %>" value="<%= value %>" maxlength="6" class="color-input"  />','<div class="color-picker-box" style="background-color: #<%= value %>; "></div>']},baseTemplate:["<span class=\"f-label <%= label ? '' : 'hidden' %>\"><%= label %></span>",'<span class="f-inputs">',"{markup}","</span>",'<% if(hint) { %><div class="f-hint"><%= hint %></div><% }; %>'],getBaseElement:function(c){var d=$('<div class="f-row" />');d.addClass(c.cssClass||"").attr("id",c.id||"").addClass(c.required?"reqired-field":"");return d},getBaseMarkup:function(c){var d=this.baseTemplate.join("").replace(/{markup}/gi,c);return d},createFormControl:function(d,c){var c=c||this.getTemplateByType(d.type);var h=this.getDefaultsByType(d.type);var d=_.extend({},h,d);var g=d.wrap?this.getBaseMarkup(c):c;var f=_.template(g,d);var e=d.wrap?this.getBaseElement(d).html(f):$(f);return e},createContainer:function(c){var e=$("<div />");var d=["type","items"];var f={cssClass:"class"};var g=_.extend({},c);_.each(d,function(h){delete g[h]});_.each(f,function(i,h){g[i]=g[h];delete g[h]});e.attr(g);if(c.html){e.html(c.html)}return e},createComponent:function(d){var f=Backbone.resolveNamespace(d.constructorName),c=new f(d),e=c.$el;e.data("component",c);return e},createRangeInput:function(d){var f={precision:false,keyboard:false,progress:true,sliderSize:160,handleSize:12};var e=this.createFormControl(d);var c=e.find("input.range-input").rangeinput(_.extend(f,d));return e},createCheckboxGroup:function(c){return this.createChecksGroup("checkbox",c)},createRadiobuttonGroup:function(c){return this.createChecksGroup("radiobutton",c)},createChecksGroup:function(g,e){var f=this.getTemplateByType(g),d=this.getDefaultsByType(g),c=[];e.cssClass=g+"-group layout-"+(e.layout||"");_.each(e.options,function(i){var h=_.extend({},d,i);c.push(_.template(f,h))},this);return this.createFormControl(e,c.join(""))},createSelectOptionsMapFromCollection:function(e,c){var d={};e.each(function(f){d[f.get(c.valueField)]=f.get(c.displayField)});return d},generateSelectOptionsFromMap:function(d,f){var e='<option value="<%= value %>"><%= label %></option>';var c=['<optgroup label="<%= label %>">',"</optgroup>"];_.each(d,function(h,g){if($.isPlainObject(h)){f.push(_.template(c[0],{label:g}));this.generateSelectOptionsFromMap(h,f);f.push(c[1])}else{f.push(_.template(e,{value:g,label:h}))}},this);return f.join("")},createSelect:function(e){if(e.collection){e.options=this.createSelectOptionsMapFromCollection(e.collection,e)}e.options=this.generateSelectOptionsFromMap(e.options,[]);var f=this.createFormControl(e),c=f.find("select"),g=c.parent().find(".select-value");if(e.value){c.val(e.value)}else{c.attr("selectedIndex",0)}var d=c.get(0);g.text($(d[d.selectedIndex]).text());c.on("change",function(){var h=$(this[this.selectedIndex]).text();g.text(h)});c.on("focus",function(){c.parent().addClass("focused")});c.on("blur",function(){c.parent().removeClass("focused")});if(e.collection){e.collection.on("all",function(){var h=this.createSelectOptionsMapFromCollection(e.collection,e);h=this.generateSelectOptionsFromMap(h,[]);c.html(h)},this)}return f},createButton:function(c){c.cssClass=c.cssClass||"";c.cssClass+=c.role?" button-"+c.role:"";c.icon=c.icon?"w-icon icon-"+c.icon:"";return this.createFormControl(c)},createFileInput:function(e){e.cssClass+=e.role?" button-"+e.role:"";var f=this.createFormControl(e);var c=f.find("input[type=file]");var d=f.find("span.file-name");var g=this.getDefaultsByType(e.type);e=_.extend({},g,e);c.bind("change",function(){var h=$(this).val(),i=h.split(/\\/).pop();d.text(i||e.noFileMessage)});return f},createColorRange:function(d){var f=(["<% _.each(ranges, function(range, idx) { %>",'<div class="f-row">','<span class="f-label"><%= range.name %></span>','<span class="f-inputs">','<span class="color-range-inputs mr-10">','<input type="text" size="3" name="colorRange_<%= idx %>_range_0" value="<%= range.range[0] %>" maxlength="3" class="color-range-input mr-5">','<input type="text" size="3" name="colorRange_<%= idx %>_range_1" value="<%= range.range[1] %>" maxlength="3" class="color-range-input mr-5">',"</span>",'<input type="text" size="6" name="colorRange_<%= idx %>_color" value="<%= range.color %>" maxlength="6" class="color-input" />','<div class="color-picker-box" style="background-color: #<%= range.color %>; "></div>',"</span>","</div>","<% }); %>"]).join("");var e=$("<div />").html(_.template(f,d));var g=e.find("input.color-range-input");var c=false;e.delegate("input[type=text]","change",function(j){if(c){$(this).closest("form").trigger(j);c=false;return false}var n=$(this),i=g.index(this),m=(i+1)%2==0,l;var k=g.eq(i+1),h=g.eq(i-1);if(m){l=parseInt(this.value);if(k.length&&!k.attr("readOnly")){k.val(l+1);c=true;k.trigger("change",[l+1])}}else{l=parseInt(this.value);if(h.length&&!h.attr("readOnly")){h.val(l-1);c=true;h.trigger("change",[l-1])}}});g.first().attr("readonly",true);g.last().attr("readonly",true);return e}};visualHUD.Libs.formBuilderMixin={getByType:function(c){return this[c]},getByName:function(c){return this[c]},base:{getSelectBasic:function(c){return _.extend({type:"select",name:"select",label:"Select",width:"120px",value:null,options:[]},c||{})},getRangeInputBasic:function(c){return _.extend({type:"rangeInput",name:"input",label:"Range Input",min:0,max:100,value:null},c||{})},getColorInputBasic:function(c){return _.extend({type:"colorPicker",name:"input",label:"Color",value:null},c||{})},getIconStyleSelectOptions:function(){var c=this.getCollection("HUDItemIconEnums").get(this.model.get("name"));var d=c.get("options");var e={};_.each(d,function(g,f){e[String(f)]=g.name});return e},getIconPositionOptions:function(){return{left:"Left",top:"Top",right:"Right",bottom:"Bottom"}},getTextStyleOptions:function(){return{"0":"Normal","3":"Drop shadow"}},getBorderRadiusOptions:function(){return{"0":"None","3":"3px","5":"5px","8":"8px"}},getOwnerDrawOptions:function(){return{"0":"Any Game Type",CG_SHOW_ANYNONTEAMGAME:"Any Non Team Game",CG_SHOW_ANYTEAMGAME:"Any Team Game",CG_SHOW_CLAN_ARENA:"Clan Arenay Only",CG_SHOW_TOURNAMENT:"Duel Only",CG_SHOW_IF_WARMUP:"Warm-up Only",CG_SHOW_IF_NOT_WARMUP:"Game Only (Not Warm-up)",CG_SHOW_CTF:"CTF Only"}},getGradientOptions:function(){return{"0":"Solid",Gradient:{"1":"Top to bottom","2":"Bottom to top","3":"Left to right","4":"Right to left"}}},getTextColorInput:function(){return this.getColorInputBasic({name:"textColor",label:"Color",value:this.model.get("textColor")})},getIconStyleSelect:function(){return this.getSelectBasic({name:"iconStyle",label:"Icon",value:this.model.get("iconStyle"),options:this.getIconStyleSelectOptions()})},getIconPositionSelect:function(){return this.getSelectBasic({name:"iconPosition",label:"Position",value:this.model.get("iconPosition"),options:this.getIconPositionOptions()})},getIconSpacingInput:function(){return this.getRangeInputBasic({name:"iconSpacing",label:"Margin",max:32,value:this.model.get("iconSpacing")})},getIconSizeInput:function(){return this.getRangeInputBasic({name:"iconSize",label:"Size",max:32,value:this.model.get("iconSize")})},getIconOpacityInput:function(){return this.getRangeInputBasic({name:"iconOpacity",label:"Opacity",value:this.model.get("iconOpacity")})},getTextStyleSelect:function(){return this.getSelectBasic({name:"textStyle",label:"Style",value:this.model.get("textStyle"),options:this.getTextStyleOptions()})},getTextSizeInput:function(){return this.getRangeInputBasic({name:"textSize",label:"Size",value:this.model.get("textSize")})},getTextOpacityInput:function(){return this.getRangeInputBasic({name:"textOpacity",label:"Opacity",value:this.model.get("textOpacity")})},getWidthInput:function(){return this.getRangeInputBasic({name:"width",label:"Width",min:this.model.get("minWidth"),max:this.model.get("maxWidth"),value:this.model.get("width")})},getHeightInput:function(){return this.getRangeInputBasic({name:"height",label:"Height",min:this.model.get("minHeight"),max:this.model.get("maxHeight"),value:this.model.get("height")})},getPaddingInput:function(){return this.getRangeInputBasic({name:"padding",label:"Padding",min:0,max:10,value:this.model.get("padding")})},getOpacityInput:function(){return this.getRangeInputBasic({name:"opacity",label:"Opacity",min:0,max:100,value:this.model.get("opacity")})},getPowerupLayoutOptions:function(){return{left:"Left to right",right:"Right to left",top:"Top to bottom",bottom:"Bottom to top"}},getBarDirectionOptions:function(){return{"0":"Left to right","1":"Right to left"}},getAvailabilityControls:function(){return{type:"fieldset",label:"Availability",items:[this.getSelectBasic({label:"During",name:"ownerDrawFlag",value:this.model.get("ownerDrawFlag"),options:this.getOwnerDrawOptions()})]}}},general:{createControls:function(e){var c=[this.getAvailabilityControls(),{type:"fieldset",label:"Icon Properties",items:[this.getIconStyleSelect(),this.getIconPositionSelect(),this.getIconSpacingInput(),this.getIconSizeInput(),this.getIconOpacityInput(),{type:"checkbox",name:"teamColors",boxLabel:"Use team colors",checked:this.model.get("teamColors")}]},{type:"fieldset",label:"Text Properties",items:[this.getTextStyleSelect(),this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Color Range",items:[{type:"colorRange",name:"colorRanges",ranges:this.model.get("colorRanges")}]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Align"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},ammoIndicator:{createControls:function(e){var c=[this.getAvailabilityControls(),{type:"fieldset",label:"Icon Properties",items:[this.getIconPositionSelect(),this.getIconSpacingInput(),this.getIconSizeInput(),this.getIconOpacityInput()]},{type:"fieldset",label:"Text Properties",items:[this.getTextStyleSelect(),this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Color Range",items:[{type:"colorRange",name:"colorRanges",ranges:this.model.get("colorRanges")}]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Align"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},timer:{createControls:function(e){var c=[this.getAvailabilityControls(),{type:"fieldset",label:"Icon Properties",items:[this.getIconPositionSelect(),this.getIconSpacingInput(),this.getIconSizeInput(),this.getIconOpacityInput()]},{type:"fieldset",label:"Text Properties",items:[{type:"textbox",name:"text",label:"Time",size:10,maxlength:5,value:this.model.get("text")},this.getTextStyleSelect(),this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},powerupIndicator:{createControls:function(e){var c=[{type:"fieldset",label:"Icon Properties",items:[this.getSelectBasic({name:"iconPosition",label:"Stack",value:this.model.get("iconPosition"),options:this.getPowerupLayoutOptions()}),this.getIconSpacingInput(),this.getIconSizeInput(),{type:"checkbox",name:"singlePowerup",boxLabel:"Show single icon",checked:this.model.get("singlePowerup")}]},{type:"fieldset",label:"Text Properties",items:[this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},accuracyIndicator:{createControls:function(e){var c=[this.getAvailabilityControls(),{type:"fieldset",label:"Icon Properties",items:[this.getIconStyleSelect(),this.getIconPositionSelect(),this.getIconSpacingInput(),this.getIconSizeInput(),this.getIconOpacityInput()]},{type:"fieldset",label:"Text Properties",items:[this.getTextStyleSelect(),this.getTextColorInput(),this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},skillIndicator:{createControls:function(e){var c=[this.getAvailabilityControls(),{type:"fieldset",label:"Text Properties",items:[this.getTextColorInput(),{type:"textbox",name:"template",label:"Tpl",size:32,maxlength:"64",value:this.model.get("template")}]},{type:"fieldset",label:"Text Style",items:[this.getTextStyleSelect(),this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Color Range",items:[{type:"colorRange",name:"colorRanges",ranges:this.model.get("colorRanges")}]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},iconItem:{getIconSizeInput:function(){return this.getRangeInputBasic({name:"iconSize",label:"Size",min:8,max:48,value:this.model.get("iconSize")})},createControls:function(e){var c=[{type:"fieldset",label:"Icon Properties",items:[this.getIconSizeInput()]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},flagIndicator:{createControls:function(e){var c=[{type:"fieldset",label:"Icon Properties",items:[this.getIconStyleSelect(),this.getIconSizeInput()]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},obits:{createControls:function(e){var c=[{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},scoreBox:{getIconSpacingInput:function(){return this.getRangeInputBasic({name:"iconSpacing",label:"Spacing",max:8,value:this.model.get("iconSpacing")})},getLayoutOptions:function(){return{vertical:"Vertical",horizontal:"Horizontal"}},getModeOptions:function(){return{ffa:"FFA / Duel",tdm:"Teamplay"}},createControls:function(e){var c=[{type:"fieldset",label:"Scorebox Properties",items:[this.getIconStyleSelect(),this.getSelectBasic({name:"scoreboxLayout",label:"Layout",value:this.model.get("scoreboxLayout"),options:this.getLayoutOptions()}),this.getIconSpacingInput(),this.getSelectBasic({name:"scoreboxMode",label:"Mode",value:this.model.get("scoreboxMode"),options:this.getModeOptions()})]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},bar:{createControls:function(e){var c=[this.getAvailabilityControls(),{type:"fieldset",label:this.model.get("label")+" Properties",items:[this.getSelectBasic({name:"barDirection",label:"Direction",value:this.model.get("barDirection"),options:this.getBarDirectionOptions()}),this.getWidthInput(),this.getHeightInput(),this.getPaddingInput(),{type:"colorPicker",name:"color",label:"Color",value:this.model.get("color")},this.getOpacityInput()]},{type:"fieldset",label:"Color Range",items:[{type:"colorRange",name:"colorRanges",ranges:this.model.get("colorRanges")},this.getRangeInputBasic({name:"barsOpacity",label:"Opacity",min:0,max:100,value:this.model.get("barsOpacity")})]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},rect:{createControls:function(e){var c=[this.getAvailabilityControls(),{type:"fieldset",label:this.model.get("label")+" Properties",items:[this.getWidthInput(),this.getHeightInput(),this.getSelectBasic({name:"borderRadius",label:"Rounded",value:this.model.get("borderRadius"),options:this.getBorderRadiusOptions()}),this.getSelectBasic({name:"boxStyle",label:"Style",width:"182px",value:this.model.get("boxStyle"),options:this.getGradientOptions()}),{type:"colorPicker",name:"color",label:"Color",value:this.model.get("color")},this.getOpacityInput(),{type:"checkbox",name:"teamColors",boxLabel:"Use team colors",checked:this.model.get("teamColors")}]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},chatArea:{createControls:function(e){var c=[{type:"fieldset",label:this.model.get("label")+" Properties",items:[this.getWidthInput(),this.getHeightInput(),this.getPaddingInput(),this.getSelectBasic({name:"borderRadius",label:"Rounded",value:this.model.get("borderRadius"),options:this.getBorderRadiusOptions()}),this.getSelectBasic({name:"boxStyle",label:"Style",width:"182px",value:this.model.get("boxStyle"),options:this.getGradientOptions()}),{type:"colorPicker",name:"color",label:"Color",value:this.model.get("color")},this.getOpacityInput(),{type:"checkbox",name:"showChat",boxLabel:"Show chat",checked:this.model.get("showChat")}]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Allign"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}},medal:{createControls:function(e){var c=[this.getAvailabilityControls(),{type:"fieldset",label:"Icon Properties",items:[this.getIconStyleSelect(),this.getIconPositionSelect(),this.getIconSpacingInput(),this.getIconSizeInput(),this.getIconOpacityInput()]},{type:"fieldset",label:"Text Properties",items:[{type:"textbox",label:"Text",name:"text",size:16,maxlength:4,value:this.model.get("text")},this.getTextColorInput(),this.getTextSizeInput(),this.getTextOpacityInput()]},{type:"fieldset",label:"Actions",items:[{type:"arrangeControl",label:"Arrange"},{type:"alignControl",label:"Align"}]}];var d=this.buildForm(c);e.get(0).appendChild(d)}}};(function(f){f.event.props.push("dataTransfer");f.fn.coordinates=function(j,g){if(!this[0]){return{top:0,left:0,right:0,bottom:0,width:0,height:0}}var i=j?"position":"offset";var h=this[i]();i=g?"outerWidth":"width";h.width=this[i]();i=g?"outerHeight":"height";h.height=this[i]();h.right=h.left+h.width;h.bottom=h.top+h.height;return h};f.fn.disableSelection=function(){if(window.getSelection){window.getSelection().removeAllRanges()}else{if(document.selection&&document.selection.clear){document.selection.clear()}}return this.each(function(){f(this).attr("unselectable","on").css({"-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).each(function(){f(this).bind("selectstart",function(){return false})})})};f.fn.enableSelection=function(){return this.each(function(){f(this).attr("unselectable","").css({"-moz-user-select":"","-o-user-select":"","-khtml-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":""}).each(function(){f(this).unbind("selectstart")})})};var d=/select|textarea/i;var c=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i;f.fn.serializeForm=function(){var g={};this.map(function(){return jQuery.makeArray(f(this).getFormElements())}).filter(function(){return this.name&&!this.disabled&&(this.checked||d.test(this.nodeName)||c.test(this.type))}).map(function(h,j){var k=jQuery(this).val();g[j.name]=k}).get();return g};f.fn.deserialize=function(k,g){var j=k;me=this;if(k===undefined){return me}g=f.extend({isPHPnaming:false,overwrite:true},g);if(k.constructor==Array){j={};for(var h=0;h<k.length;h++){if(typeof j[k[h].name]!="undefined"){if(j[k[h].name].constructor!=Array){j[k[h].name]=[j[k[h].name],k[h].value]}else{j[k[h].name].push(k[h].value)}}else{j[k[h].name]=k[h].value}}}me.find("input,select,textarea").each(function(){var o=this.name;var l=[];if(g.isPHPnaming){o=o.replace(/\[\]$/,"")}if(o&&j[o]!=undefined){l=j[o].constructor==Array?j[o]:[j[o]]}if(g.overwrite===true||j[o]){switch(this.type||this.tagName.toLowerCase()){case"radio":case"checkbox":this.checked=false;for(var n=0;n<l.length;n++){this.checked|=(this.value!=""&&l[n]==this.value)}break;case"select-multiple"||"select":for(n=0;n<this.options.length;n++){this.options[n].selected=false;for(var m=0;m<l.length;m++){this.options[n].selected|=(this.options[n].value!=""&&this.options[n].value==l[m])}}break;case"button":case"submit":this.value=l.length>0?l.join(","):this.value;break;default:this.value=l.join(",")}}});return me};f.fn.getFormElements=function(){var g=f("input,select,textarea",this);return g};var e=function(){f.WMSOverlay.css({height:f(document).height()})};f.showModalOverlay=function(i,g,k){if(typeof i=="function"){k=i;i=null}if(typeof g=="function"){k=g;g=null}if(i<1){var j=g;g=i;i=j}if(g>=1){var j=i;i=g;g=j}i=(i>0)?i:500;g=(g>0)?g:0.5;var h=[{display:"block",height:f(document).height()+"px",left:"0px",opacity:0,position:"absolute",top:"0px",width:"100%"},{display:"block",opacity:0,height:f(document).height()}];if(!this.WMSOverlay){this.WMSOverlay=this("<div></div>").attr({id:"dimScreen"}).css(h[0]).appendTo(document.body);f.data(f.WMSOverlay[0],"options",{fade_opacity:g,speed:i})}else{this.WMSOverlay.css(h[1]);if(this.WMSOverlayFix){this.WMSOverlayFix.css(h[1])}}f(window).bind("resize",e);this.WMSOverlay.fadeTo(i,g,k);this.WMSOverlay.visible=1;return this.WMSOverlay};f.hideModalOverlay=function(k){var g=this.WMSOverlay;var i=f.data(f.WMSOverlay[0],"options");var h=i.fade_opacity;var j=window.ie6?0:i.speed;g.fadeOut(j,function(){if(f.WMSOverlayFix){f.WMSOverlayFix.css({display:"none"})}if(typeof k=="function"){k()}});f(window).unbind("resize",e);this.WMSOverlay.visible=0}})(jQuery);visualHUD.Libs.colorHelper=(function(){var g=false;var j;var i;var c;var e;var f;var d=null;var h=["FFFFFF","FF8AD8","FF928A","FFBA8A","fccc30","FDFF8A","DAFF58","a1fb6e","7ff7e0","54cdf5","5ba8f5","5537ff","a053ed","CCCCCC","FF00BA","FF0000","F06300","FFA000","ECF000","BBF000","56F000","00F0C1","00B4F0","0077F0","2e15f1","732fbe","999999","CC0087","CC0E00","CC5400","CC7F00","C9CC00","9FCC00","4ACC00","00CCA4","0099CC","0065CC","1a05c4","501a8c","666666","990066","990A00","993F00","996000","979900","789900","389900","00997B","007399","004C99","1100a0","391166","333333","660043","660700","662A00","664000","646600","506600","256600","006652","004C66","003266","0c0073","250b41","000000","330021","330400","331500","332000","323300","273300","123300","003329","002633","001933","060033","190033"];return{setupColorPicker:function(l){if(d==null){var m=$(document.body);var n=(["<% _.each(colors, function(color) { %>",'<div class="color-cell" style="background-color:#<%= color %>"><input type="hidden" value="<%= color %>" name="color"/></div>',"<% }); %>"]).join("");var k=this.menuEventsHandler;$(l).on("click","div.color-picker-box",visualHUD.Function.bind(this.showColorPicker,this));$(l).on("click","input.color-input",visualHUD.Function.bind(this.showColorPicker,this));$(l).on("change","input.color-input",visualHUD.Function.bind(this.updateColor,this));d=new visualHUD.Widgets.PopOver({scope:this,position:"left-center",html:_.template(n,{colors:h}),render:function(o){e=o.$content.find("div.color-cell");o.$el.addClass("color-picker-popover");o.$content.on("mouseover mouseout click","div.color-cell",visualHUD.Function.bind(k,this));o.$title.hide()},hide:function(){j&&j.removeClass("active-color")}})}},menuEventsHandler:function(m){if(f){var l=$(m.currentTarget);var k=l.find("input[name=color]").val().toUpperCase();var n=m.type=="mouseout"||m.type=="click"?"removeClass":"addClass";if(m.type=="mouseover"&&d.visible==true){d.setTitle("#"+k);i.val(k);f.css("backgroundColor","#"+k)}if(m.type=="mouseout"&&d.visible==true){d.setTitle("#"+c);i.val(c);f.css("backgroundColor","#"+c)}l[n]("color-cell-hover");if(m.type=="click"){d.hide();g=true;i.trigger("change");return false}g=false}},showColorPicker:function(k){e.filter(".active-color").removeClass("active-color");if(d.visible==true&&f&&f.get(0)==k.currentTarget){d.hide()}else{f=$(k.currentTarget);if(f.is("input.color-input")){i=f;f=f.next("div.color-picker-box")}else{i=f.prev("input.color-input")}c=i.val();e.each(function(){var m=$(this);var l=String(m.data("color"));if(l.toUpperCase()==c.toUpperCase()){m.addClass("active-color");j=m;return false}});d.setTitle("#"+c);d.show(i,k)}},updateColor:function(m){var l=$(m.currentTarget);var k="";try{k=$.color("#"+l.val());d.hide();f.css("backgroundColor",k.hex)}catch(n){}}}})();visualHUD.Libs.importHelper={checkImageSize:function(c){if(c.size>=visualHUD.MAX_BACKGROUND_SIZE){visualHUD.growl.alert({status:"warning",title:"Maximum file size exceeded",message:_.template(visualHUD.messages.LARGE_IMAGE_WARNING,{imageSize:Math.floor(c.size/1024)+"kb",maxSize:Math.floor(visualHUD.MAX_BACKGROUND_SIZE/1024)+"kb"})});return false}return true},checkImageType:function(c){if(!c.type.match("image.*")){visualHUD.growl.alert({status:"warning",title:"Unsupported file detected",message:_.template(visualHUD.messages.UNSUPPORTED_IMAGE_FORMAT,{imageType:c.type||"unknown"})});return false}return true},checkTextType:function(c){},batchImport:function(c,i){var f=[],g=new FileReader(),j=false,i=_.extend({scope:this,image:false,files:false},i||{}),k=i.scope;var h=function(l){if(l.type.match("image.*")&&visualHUD.Libs.importHelper.checkImageSize(l)==true&&j==false){g.onload=visualHUD.Function.bind(e,this,[l],true);g.readAsDataURL(l)}if(l.type.match("text.*")||l.name.match("vhud$")){g.onload=visualHUD.Function.bind(d,this,[l],true);g.readAsText(l)}};var e=function(l){j=true;i.image&&i.image.call(k,l.target.result)};var d=function(m,l){var n=l.name.split(".");n.pop();f.push({name:n.join("."),json:m.target.result});if(c.length>0){h.call(this,c.shift())}else{i.files&&i.files.call(k,f)}};if(c.length){h.call(this,c.shift())}}};visualHUD.Utils.DragZoneBase=function(c){c=_.extend({},this.defaults,c||{});this.setOptions(c);this.initialize.apply(this,arguments)};_.extend(visualHUD.Utils.DragZoneBase.prototype,{currentElement:null,handler:null,defaults:{ticks:2,tolerance:3,ghost:0,opacity:0.5,bodyDragClass:"drag",position:"position"},initialize:function(c){var d=this;this.scope=c.scope||this;this.dropPanel=this.options.dropPanelID?$$(this.options.dropPanelID):$(document);this.bound={dragover:$.proxy(this.options.ondragover,this.dropPanel),dragout:$.proxy(this.options.ondragout,this.dropPanel),start:$.proxy(this.start,this),check:$.proxy(this.check,this),drag:$.proxy(this.drag,this),end:$.proxy(this.end,this)};this.ghost=$('<div class="drag-helper"></div>').css({display:"none",position:"absolute",top:0,left:0}).appendTo(document.body);if(this.options.ondragover){this.dropPanel.bind("mouseover",function(e){d.options.ondragover.apply(d.dropPanel,[e])})}if(this.options.ondragout){this.dropPanel.bind("mouseout",function(e){d.options.ondragout.apply(d.dropPanel,[e])})}if(this.options.init){this.options.init.apply(this.scope,[this])}return this},start:function(f,d){this.currentElement=d;this.handler=$(f.target);this.ticker=this.options.ticks;this.mouse=this.getMouse(f);this.moveOffset={x:0,y:0};if(d){var c=this.options.position;var e=this.currentElement[c]()||{left:this.mouse.x,top:this.mouse.y};this.moveOffset={x:e.left-this.mouse.x,y:e.top-this.mouse.y}}$(document).bind("mousemove",this.bound.check);$(document).bind("mouseup",this.bound.end);$(document.body).disableSelection();if(this.options.onbeforestart){this.options.onbeforestart.apply(this.scope,[this,f,this.mouse])}},check:function(c){var d=this.getMouse(c);if(Math.abs(d.x-this.mouse.x)>this.options.tolerance||Math.abs(d.y-this.mouse.y)>this.options.tolerance){$(document).unbind("mousemove",this.bound.check);$(document).bind("mousemove",this.bound.drag);$(document.body).addClass(this.options.bodyDragClass);if(this.options.onstart){this.options.onstart.apply(this.scope,[this,c,d])}}if(c.stopPropagation){c.stopPropagation()}if(c.preventDefault){c.preventDefault()}return false},drag:function(c){if(this.ticker==this.options.ticks){var d=this.getMouse(c);var e={left:d.x+this.moveOffset.x,top:d.y+this.moveOffset.y};if(this.options.grid){e.left-=e.left%this.options.grid;e.top-=e.top%this.options.grid}if(this.options.ondrag){this.options.ondrag.apply(this.scope,[this,c,e,d])}this.ticker=0}else{this.ticker++}if(c.stopPropagation){c.stopPropagation()}if(c.preventDefault){c.preventDefault()}return false},end:function(d){$(document).unbind("mousemove",this.bound.check);$(document).unbind("mousemove",this.bound.drag);$(document).unbind("mouseup",this.bound.end);this.ghost.empty().css({display:"none"});$(document.body).removeClass(this.options.bodyDragClass).css("cursor","");$(document.body).enableSelection();var c=$(d.target);if(this.options.ondrop){this.options.ondrop.apply(this.scope,[this,d,c])}if(d.stopPropagation){d.stopPropagation()}if(d.preventDefault){d.preventDefault()}return false},setOptions:function(c){this.options=this.options||{};_.extend(this.options,c||{});if(c.dropables){this.options.dropables=$(c.dropables)}},getMouse:function(c){return{x:c.pageX,y:c.pageY}}});visualHUD.Models.ClientSettings=Backbone.Model.extend({defaults:{HUDName:null,scaleFactor:1,fullScreenView:false,pinSidebar:true,lagometr:false,speedometr:false,pickup:false,snapGrid:"0",drawGrid:"0",drawGun:"1",drawWeaponbar:"1",drawTeamoverlay:"0",canvasShot:"1",statusSkill:"90",statusAccuracy:"47",statusHealth:"200",statusArmor:"100",statusAmmo:"25",customBackground:null},initialize:function(){var c=window.localStorage.getItem("vhudClient");if(c!==null){c=JSON.parse(c);this.set(c)}this.on("change",this.save,this)},save:function(){var d=this.toJSON();var c={fullScreenView:false};_.extend(d,c);window.localStorage.setItem("vhudClient",JSON.stringify(d))},reset:function(){this.set(this.defaults);this.save()},getStatusByName:function(c){switch(c){case"armorIndicator":case"armorbar":return this.get("statusArmor");break;case"ammoIndicator":return this.get("statusAmmo");break;case"healthIndicator":case"healthBar":return this.get("statusHealth");break;case"accuracyIndicator":return this.get("statusAccuracy");break;case"skillIndicator":return this.get("statusSkill");break}return null}});visualHUD.Models.HUDItem=Backbone.Model.extend({defaults:{index:0,itemType:null,iconPosition:null,iconSpacing:null,iconOpacity:null,iconSize:null,iconStyle:null,textSize:null,textOpacity:null,textStyle:null,textColor:"FFFFFF",teamColors:null,colorRanges:null,coordinates:{top:0,left:0,width:null,height:null},iconCoordinates:{},textCoordinates:{},cssClass:null,label:null,name:null,text:null,borderRadius:0,boxStyle:0,template:null,singlePowerup:true,padding:null,toggleChat:null,scoreboxLayout:null,scoreboxMode:null,barDirection:null,resizable:false,group:null,ownerDrawFlag:"0"},defaultsByName:{chatArea:{coordinates:{top:245,left:0,width:640,height:160},showChat:false,color:"000000",opacity:75,padding:3,width:640,height:160,minWidth:1,minHeight:1,maxWidth:640,maxHeight:480,boxStyle:2,borderRadius:0},timer:{colorRanges:[],text:"2:47"},ammoIndicator:{colorRanges:[{name:"Low",color:"FF0000",range:[-999,5]},{name:"Normal",color:"FFFFFF",range:[6,100]},{name:"Hight",color:"FFFFFF",range:[101,999]}]},skillIndicator:{colorRanges:[{name:"Low",color:"56F000",range:[0,33]},{name:"Normal",color:"ECF000",range:[34,66]},{name:"Hight",color:"CC0E00",range:[67,999]}],template:"Skill rating",textSize:20,textStyle:0,textColor:"FFFFFF",text:100,ownerDraw:"0",textOpacity:100},medal:{text:"27",colorRanges:[],ownerDrawFlag:0,textStyle:0,textSize:50},powerupIndicator:{colorRanges:[],layout:"vertical",iconStyle:null,iconSize:24,textSize:55,iconSpacing:4,text:"32"},scoreBox:{scoreboxLayout:"vertical",iconSpacing:2,iconStyle:0,scoreboxMode:"ffa"}},defaultsByType:{general:{colorRanges:[{name:"Low",color:"FF0000",range:[-999,25]},{name:"Normal",color:"FCCC30",range:[26,100]},{name:"Hight",color:"FFFFFF",range:[101,999]}],iconPosition:"left",iconSpacing:10,iconOpacity:100,iconSize:32,iconStyle:0,textSize:100,textOpacity:100,textStyle:"3",teamColors:true},iconItem:{iconStyle:0,iconSize:24,iconOpacity:100},scoreBox:{mode:"ffa",spacing:1,iconSpacing:10},flagIndicator:{iconStyle:0,iconSize:32,iconOpacity:100},obits:{iconStyle:0,iconSize:null,text:["Klesk","Xaero"]},rect:{color:"FFFFFF",opacity:100,width:100,height:100,minWidth:1,minHeight:1,maxWidth:640,maxHeight:480,teamColors:false,boxStyle:0,hairLine:0,borderRadius:0,coordinates:{width:100,height:100},resizable:true},bar:{colorRanges:[{name:"Low",color:"FF0000",range:[-999,25]},{name:"Normal",color:"FFFFFF",range:[26,100]},{name:"Hight",color:"FFA000",range:[101,999]}],color:"000000",opacity:30,width:100,height:24,minWidth:1,minHeight:1,maxWidth:640,maxHeight:100,padding:0,barsOpacity:70,text:125,barDirection:0,coordinates:{width:100,height:24},resizable:true}},initialize:function(c){this.legacyCleanUp()},setDefaultValues:function(e){var d=this.getDefaultsByType(e.itemType)||{},c=this.getDefaultsByName(e.name)||{};_.extend(this.attributes,e,d,c);return this},getDefaultsByType:function(c){return this.defaultsByType[c]||null},getDefaultsByName:function(c){return this.defaultsByName[c]||null},legacyCleanUp:function(){var c=this.attributes;if(c.itemType=="obits"){this.set(this.getDefaultsByType(c.itemType),{silent:true})}if(c.name=="scoreBox"){if("scoreboxStyle" in c){this.set({iconStyle:c.scoreboxStyle},{silent:true});delete datascoreboxStyle}if("spacing" in c){this.set({iconSpacing:c.spacing},{silent:true});delete c.spacing}if("layout" in c){this.set({scoreboxLayout:c.layout},{silent:true});delete c.layout}if("mode" in c){this.set({scoreboxMode:c.mode},{silent:true});delete c.mode}}if(c.name=="powerupIndicator"&&c.iconStyle!=null){this.set({iconStyle:null},{silent:true})}if(this.get("ownerDraw")==""){this.set({ownerDraw:"0"},{silent:true})}if(c.name=="skillIndicator"&&"opacity" in c){this.set({textOpacity:c.opacity},{silent:true});delete c.opacity}if("rbox" in c){delete c.rbox}if("iconCoordinates" in c){delete c.iconCoordinates}if("textCoordinates" in c){delete c.textCoordinates}}});visualHUD.Collections.DictionaryAbstract=Backbone.Collection.extend({autoLoad:true,getData:function(){return[]},load:function(){this.reset(this.getData(),{silent:true});return this}});visualHUD.Collections.HUDItemIconEnums=visualHUD.Collections.DictionaryAbstract.extend({getData:function(){return[{id:"armorIndicator",options:[{name:"QL Armor",url:"resources/images/icons/armor.png"},{name:"Q3A Armor",url:"resources/images/icons/iconr_red.png"}]},{id:"healthIndicator",options:[{name:"QL Health",url:"resources/images/icons/health.png"},{name:"Head icon",url:"resources/images/icons/icon_head.png"}]},{id:"ammoIndicator",options:[{name:"Rocketlauncher",url:"resources/images/icons/iconw_rocket.png"}]},{id:"powerupIndicator",options:[{name:"Quad",url:"resources/images/icons/quad.png"},{name:"Regeneration",url:"resources/images/icons/regen.png"}]},{id:"accuracyIndicator",options:[{name:"Accuracy medal",url:"resources/images/icons/medal_accuracy.png"}]},{id:"CTFPowerupIndicator",options:[{name:"Scout",url:"resources/images/icons/scout.png"}]},{id:"scoreBox",options:[{name:"Classic Full",url:null},{name:"Classic Small",url:null},{name:"Compact",url:null}]},{id:"timer",options:[{name:"Clock",url:"resources/images/icons/icon_time.png"}]},{id:"playerItem",options:[{name:"Medkit",url:"resources/images/icons/medkit.png"}]},{id:"obits",options:[{name:"Rocketlauncher",url:"resources/images/icons/iconw_rocket.png"}]},{id:"flagIndicator",options:[{name:"Flag 1",url:"resources/images/icons/flag.png"},{name:"Flag 2",url:"resources/images/icons/iconf_blu1.png"},{name:"Flag 3",url:"resources/images/icons/flag_3_1.png"},{name:"Flag 4",url:"resources/images/icons/flag_3_2.png"}]},{id:"skillIndicator",options:[]},{id:"medal",options:[{name:"Accuracy medal",url:"resources/images/icons/medal_accuracy.png"},{name:"Gauntlet medal",url:"resources/images/icons/medal_gauntlet.png"},{name:"Excellent medal",url:"resources/images/icons/medal_excellent.png"},{name:"Impressive medal",url:"resources/images/icons/medal_impressive.png"},{name:"Captures medal",url:"resources/images/icons/medal_capture.png"},{name:"Assist medal",url:"resources/images/icons/medal_assist.png"},{name:"Defend medal",url:"resources/images/icons/medal_defend.png"}]}]}});visualHUD.Collections.HUDItems=Backbone.Collection.extend({name:"HUDItems",LOCAL_STORAGE_KEY:"HUDItems",model:visualHUD.Models.HUDItem,initialize:function(){this.on("add",this.setIndex,this);this.on("load",this.updateIndexes,this);this.on("change:ownerDrawFlag",function(c,d){this.filter&&this.filterItemsByOwnerDraw(this.filter)},this);$(window).unload(visualHUD.Function.bind(this.save,this,[]))},save:function(){var c=this.toJSON();window.localStorage.setItem(this.LOCAL_STORAGE_KEY,JSON.stringify(c))},load:function(c){var c=c||window.localStorage.getItem(this.LOCAL_STORAGE_KEY),f=false;if(_.isString(c)){try{c=JSON.parse(c)}catch(d){console.warn("Invalid HUD JSON data")}}if(c&&c.length){try{this.reset(c,{silent:true});this.cleanDefaultChat();f=true}catch(d){console.warn("Invalid HUD data")}}this.trigger("load",f)},setIndex:function(c){c.set("index",this.length,{silent:true})},updateIndexes:function(){this.each(function(c,d){c.set("index",d,{silent:true})})},comparator:function(c){return c.get("index")},cleanDefaultChat:function(){var c=this.where({name:"chatArea",isDefaultChat:true});if(c.length){this.remove(c,{silent:true})}},serialize:function(){this.sort();var c=[],d=new this.model();d.setDefaultValues({isDefaultChat:true,itemType:"chatArea",name:"chatArea"});this.each(function(e){var h=e._HUDItem,i=e.toJSON(),g=h.getDOMRefs();if(i.itemType=="general"){i.iconCoordinates={top:g.iconBlock[0].offsetTop/visualHUD.scaleFactor,left:g.iconBlock[0].offsetLeft/visualHUD.scaleFactor,width:g.iconBlock.eq(0).width()/visualHUD.scaleFactor,height:g.iconBlock.eq(0).height()/visualHUD.scaleFactor};i.textCoordinates={top:g.textBlock[0].offsetTop/visualHUD.scaleFactor,left:g.textBlock[0].offsetLeft/visualHUD.scaleFactor,width:g.textBlock.eq(0).width()/visualHUD.scaleFactor,height:g.textBlock.eq(0).height()/visualHUD.scaleFactor}}if(i.itemType=="textItem"){i.textCoordinates={top:g.templateText[0].offsetTop/visualHUD.scaleFactor,left:g.templateText[0].offsetLeft/visualHUD.scaleFactor,width:g.templateText.eq(0).width()/visualHUD.scaleFactor,height:g.templateText.eq(0).height()/visualHUD.scaleFactor};i.counterCoordinates={top:g.counter[0].offsetTop/visualHUD.scaleFactor,left:g.counter[0].offsetLeft/visualHUD.scaleFactor,width:g.counter.eq(0).width()/visualHUD.scaleFactor,height:g.counter.eq(0).height()/visualHUD.scaleFactor}}if(i.itemType=="rect"){var f=parseInt(i.borderRadius,10);if(f>0){i.boxStyle=0;i.rbox=visualHUD.Libs.utility.getRCornersMarkup(i)}}if(i.name=="chatArea"){d=null}c.push(i)});d&&c.push(d.toJSON());d=null;return c},filterItemsByOwnerDraw:function(c){this.each(function(d){var f=d._HUDItem,g=d.get("ownerDrawFlag"),e=f.getDOMRefs();if(c=="0"||g==c||g=="0"){f.show()}else{f.hide()}});this.filter=c}});visualHUD.Collections.HUDItemTemplates=visualHUD.Collections.DictionaryAbstract.extend({getData:function(){var d=function(){return['<div class="item-icon"><img src="<%= icon.url %>"/></div>','<div class="item-counter"><span class="counter"><%= text %></span></div>']};var e=function(){return['<div class="item-icon"><img src="<%= icon.url %>"/></div>']};var c=function(){return['<div class="hud-item-box">','<div class="h-bar h100"><div class="h-bar h200"></div></div>',"</div>"]};return[{id:"healthIndicator",itemType:"general",cssClass:"",template:d()},{id:"healthBar",itemType:"bar",cssClass:"health-bar",template:c()},{id:"armorIndicator",itemType:"general",cssClass:"",template:d()},{id:"armorBar",itemType:"bar",cssClass:"armor-bar",template:c()},{id:"ammoIndicator",itemType:"general",cssClass:"",template:d()},{id:"timer",itemType:"general",cssClass:"",template:d()},{id:"powerupIndicator",itemType:"general",cssClass:"",template:['<div class="powerups-wrapper">','<div class="powerup-item">','<div class="item-icon"><img src="<%= icon[0].url %>"/></div> ','<div class="item-counter"><span class="counter"><%= text %></a></span></div>',"</div>",'<div class="powerup-item">','<div class="item-icon"><img src="<%= icon[1].url %>"/></div> ','<div class="item-counter"><span class="counter"><%= text %></a></span></div>',"</div>","</div>"]},{id:"scoreBox",itemType:"scoreBox",cssClass:"scorebox-item",template:['<div class="item-icon team-red"></div><div class="item-icon team-blue"></div>']},{id:"playerItem",itemType:"iconItem",cssClass:"icon-item ",template:e()},{id:"CTFPowerupIndicator",itemType:"iconItem",cssClass:"icon-item ",template:e()},{id:"obits",itemType:"obits",cssClass:"obit-item",template:['<div class="item-counter"><span class="counter"><%= text[0] %></span></div>','<div class="item-icon"><img src="<%= icon.url %>"/></div>','<div class="item-counter"><span class="counter"><%= text[1] %></span></div>']},{id:"flagIndicator",itemType:"iconItem",cssClass:"icon-item ",template:e()},{id:"rectangleBox",itemType:"rect",template:['<div class="hud-item-box"></div>']},{id:"medal",itemType:"general",cssClass:"accuracy",template:d()},{id:"skillIndicator",itemType:"textItem",cssClass:"skill-item",template:['<div class="item-counter">','<span class="text"><%= template %></a></span>','<span class="counter"><%= text %></a></span>',"</div>"]},{id:"chatArea",itemType:"chatArea",cssClass:"chat-area",template:['<div class="hud-item-box">','<ul class="chat-messages">','<li class="message-0">','<span class="name"><span style="color: Red" class="mr-5">bwt</span><span style="color: white">namad</span>:</span><span class="message">quad in 30 seconds, team</span>',"</li>",'<li class="message-1">','<span class="name"><span style="color: Red" class="mr-5">bwt</span><span style="color: #3266fe">kN</span><span style="color: Red">a</span><span style="color: #3a63e9">kHstR</span>:</span><span class="message">WTF???</span>',"</li>",'<li class="message-2">','&lt;QUAKE LIVE&gt; <span style="color: Cyan">Ancest0R</span> has gone offline</li>','<li class="message-4">','fatal<span style="color: Red">1</span>ty connected</li>','<li class="message-5">','fatal<span style="color: Red">1</span>ty entered the game</li>','<li class="message-3">','<span class="name">fatal<span style="color: Red">1</span>ty:</span><span class="message">ready to get pwned? ;)</span></li>','<li class="message-6">','<span class="name"><span style="color: Red" class="mr-5">bwt</span><span style="color: white">namad</span>:</span><span class="message">byte my shiny metal ass!</span>',"</li>","</ul>","</div>"]}]}});visualHUD.Collections.StageControlsDictionary=visualHUD.Collections.DictionaryAbstract.extend({getData:function(){return[{id:"healthIndicator",itemType:"general",cssClass:"lib-element-health",label:"Health indicator"},{id:"healthBar",name:"healthBar",itemType:"bar",label:"Health bar",cssClass:"lib-element-hbar"},{id:"armorIndicator",itemType:"general",cssClass:"lib-element-armor",label:"Armor indicator"},{id:"armorBar",name:"armorBar",itemType:"bar",label:"Armor bar",cssClass:"lib-element-abar"},{id:"ammoIndicator",itemType:"general",cssClass:"lib-element-ammo",label:"Ammo indicator"},{id:"timer",itemType:"general",cssClass:"lib-element-timer",label:"Timer"},{id:"powerupIndicator",itemType:"general",cssClass:"lib-element-powerup",label:"Powerup timer"},{id:"scoreBox",itemType:"scoreBox",cssClass:"lib-element-scorebox",label:"Scorebox"},{id:"playerItem",itemType:"iconItem",cssClass:"lib-element-player-item",label:"Usable item indicator"},{id:"CTFPowerupIndicator",itemType:"iconItem",cssClass:"lib-element-ctf-powerup",label:"CTF powerup indicator"},{id:"obits",itemType:"obits",cssClass:"lib-element-obit",label:"Graphical obits"},{id:"flagIndicator",itemType:"iconItem",cssClass:"lib-element-flag",label:"Flag indicator"},{id:"medal",name:"medal",itemType:"general",label:"Medal",cssClass:"lib-element-medal"},{id:"skillIndicator",name:"skillIndicator",itemType:"textItem",label:"Skill Rating Indicator",cssClass:"lib-element-skill"},{id:"chatArea",name:"chatArea",itemType:"rect",label:"Chat area",isSingle:true,cssClass:"lib-element-chat"},{id:"rectangleBox",name:"rectangleBox",itemType:"rect",label:"Rectangle box",cssClass:"lib-element-rect"},{id:"customDefinition",name:"customDefinition",itemType:"customDefinition",label:"Custom Definition",cssClass:"lib-element-definition"}]}});visualHUD.Collections.HUDPresets=visualHUD.Collections.DictionaryAbstract.extend({getData:function(){return[{id:"largeHUD",isBuiltIn:true,name:"Large_HUD",items:[{itemType:"general",cssClass:"lib-element-armor",label:"Armor indicator",name:"armorIndicator",colorRanges:[{name:"Low",range:[-999,25],color:"FF0000"},{name:"Normal",range:[26,99],color:"fccc30"},{name:"High",range:[100,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:"5",iconOpacity:100,iconSize:"18",iconStyle:0,textSize:100,textOpacity:100,textStyle:3,teamColors:true,text:"100",textColor:"FFFFFF",coordinates:{top:435,left:400,width:127,height:35,right:527,bottom:471},iconCoordinates:{top:8.5,left:0,width:18,height:18,right:18,bottom:26.5},textCoordinates:{top:0,left:23,width:104,height:35,right:127,bottom:35}},{itemType:"general",cssClass:"lib-element-ammo",label:"Ammo indicator",name:"ammoIndicator",colorRanges:[{name:"Low",range:[-999,5],color:"FF0000"},{name:"Normal",range:[5,99],color:"FFFFFF"},{name:"High",range:[100,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:"0",iconOpacity:100,iconSize:"16",iconStyle:0,textSize:"65",textOpacity:100,textStyle:3,teamColors:true,text:"25",textColor:"FFFFFF",coordinates:{top:442,left:113,width:83,height:22,right:196,bottom:464},iconCoordinates:{top:3,left:0,width:16,height:16,right:16,bottom:19},textCoordinates:{top:0,left:16,width:67,height:22,right:83,bottom:22}},{itemType:"general",cssClass:"lib-element-timer",label:"Timer",name:"timer",iconPosition:"left",iconSpacing:10,iconOpacity:100,iconSize:"0",iconStyle:0,textSize:"60",textOpacity:100,textStyle:3,teamColors:true,text:"0:00",textColor:"FFFFFF",coordinates:{top:3,left:250,width:72,height:21,right:322,bottom:24},iconCoordinates:{top:0,left:0,width:0,height:0,right:0,bottom:0},textCoordinates:{top:0,left:0,width:72,height:21,right:72,bottom:21}},{itemType:"scoreBox",cssClass:"lib-element-scorebox",label:"Scorebox",name:"scoreBox",scoreboxStyle:2,layout:"vertical",mode:"ffa",spacing:1,iconSpacing:10,coordinates:{top:436,left:585,width:50,height:33,right:635,bottom:469}},{itemType:"general",cssClass:"lib-element-powerup",label:"Powerup timer",name:"powerupIndicator",iconPosition:"top",iconSpacing:4,iconOpacity:100,iconSize:24,iconStyle:0,textSize:55,textOpacity:100,textStyle:3,teamColors:true,text:"32",layout:"vertical",textColor:"FFFFFF",singlePowerup:false,coordinates:{top:240,left:571,width:62,height:28,right:633,bottom:268},iconCoordinates:{top:0,left:0,width:24,height:24,right:24,bottom:24},textCoordinates:{top:5,left:28,width:34,height:19,right:62,bottom:24}},{itemType:"iconItem",cssClass:"lib-element-flag",label:"Flag indicator",name:"flagIndicator",iconStyle:"1",iconSize:"38",iconOpacity:100,coordinates:{top:434,left:51,width:38,height:38,right:89,bottom:472}},{itemType:"general",cssClass:"lib-element-health",label:"Health indicator",name:"healthIndicator",colorRanges:[{name:"Low",range:[-999,25],color:"FF0000"},{name:"Normal",range:[26,100],color:"fccc30"},{name:"High",range:[101,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:"5",iconOpacity:100,iconSize:"18",iconStyle:0,textSize:100,textOpacity:100,textStyle:3,teamColors:true,text:"100",textColor:"fccc30",coordinates:{top:435,left:243,width:127,height:35,right:370,bottom:470},iconCoordinates:{top:8.5,left:0,width:18,height:18,right:18,bottom:26.5},textCoordinates:{top:0,left:23,width:104,height:35,right:127,bottom:35}},{itemType:"iconItem",cssClass:"lib-element-ctf-powerup",label:"CTF powerup indicator",name:"CTFPowerupIndicator",iconStyle:0,iconSize:16,iconOpacity:100,coordinates:{top:455,left:5,width:16,height:16,right:21,bottom:471}},{itemType:"iconItem",cssClass:"lib-element-player-item",label:"Usable item indicator",name:"playerItem",iconStyle:0,iconSize:16,iconOpacity:100,coordinates:{top:435,left:5,width:16,height:16,right:21,bottom:451}}]},{id:"smallHUD",isBuiltIn:true,name:"Small_HUD",items:[{itemType:"rect",name:"rectangleBox",label:"Rectangle box",cssClass:"lib-element-rect",color:"000000",opacity:"30",width:"343",height:"28",coordinates:{top:448,left:151,width:343,height:28,right:494,bottom:476},teamColors:true,borderRadius:"3",boxStyle:0},{itemType:"general",cssClass:"lib-element-health",label:"Health indicator",name:"healthIndicator",colorRanges:[{name:"Low",range:[-999,25],color:"FF0000"},{name:"Normal",range:[26,100],color:"FFFFFF"},{name:"High",range:[101,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:"2",iconOpacity:100,iconSize:"18",iconStyle:0,textSize:"50",textOpacity:100,textStyle:3,teamColors:true,text:"100",textColor:"FFFFFF",coordinates:{top:453,left:199,width:72,height:18,right:271,bottom:471},iconCoordinates:{top:0,left:0,width:18,height:18},textCoordinates:{top:0,left:20,width:52,height:18}},{itemType:"general",cssClass:"lib-element-armor",label:"Armor indicator",name:"armorIndicator",colorRanges:[{name:"Low",range:[-999,25],color:"FF0000"},{name:"Normal",range:[26,100],color:"FFFFFF"},{name:"High",range:[101,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:"2",iconOpacity:100,iconSize:"18",iconStyle:0,textSize:"50",textOpacity:100,textStyle:3,teamColors:true,text:"179",textColor:"FFFFFF",coordinates:{top:453,left:370,width:72,height:18,right:442,bottom:471},iconCoordinates:{top:0,left:0,width:18,height:18},textCoordinates:{top:0,left:20,width:52,height:18}},{itemType:"general",cssClass:"lib-element-ammo",label:"Ammo indicator",name:"ammoIndicator",colorRanges:[{name:"Low",range:[-999,5],color:"FF0000"},{name:"Normal",range:[6,100],color:"FFFFFF"},{name:"High",range:[101,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:"2",iconOpacity:100,iconSize:"18",iconStyle:0,textSize:"45",textOpacity:100,textStyle:3,teamColors:true,text:"25",textColor:"FFFFFF",coordinates:{top:453,left:286,width:67,height:18,right:353,bottom:471},iconCoordinates:{top:0,left:0,width:18,height:18},textCoordinates:{top:1,left:20,width:47,height:16}},{itemType:"general",cssClass:"lib-element-powerup",label:"Powerup timer",name:"powerupIndicator",iconPosition:"top",iconSpacing:"0",iconOpacity:100,iconSize:"32",iconStyle:0,textSize:55,textOpacity:100,textStyle:3,teamColors:true,text:"32",layout:"vertical",textColor:"FFFFFF",singlePowerup:false,coordinates:{top:222,left:566,width:62,height:36,right:628,bottom:258},iconCoordinates:{top:0,left:0,width:32,height:32},textCoordinates:{top:12,left:36,width:34,height:20}},{itemType:"iconItem",cssClass:"lib-element-flag",label:"Flag indicator",name:"flagIndicator",iconStyle:"0",iconSize:"42",iconOpacity:100,coordinates:{top:3,left:297,width:42,height:42,right:339,bottom:45}},{itemType:"iconItem",cssClass:"lib-element-ctf-powerup",label:"CTF powerup indicator",name:"CTFPowerupIndicator",iconStyle:0,iconSize:16,iconOpacity:100,coordinates:{top:454,left:472,width:16,height:16,right:488,bottom:470}},{itemType:"iconItem",cssClass:"lib-element-player-item",label:"Usable item indicator",name:"playerItem",iconStyle:0,iconSize:16,iconOpacity:100,coordinates:{top:454,left:157,width:16,height:16,right:173,bottom:470}},{itemType:"scoreBox",cssClass:"lib-element-scorebox",label:"Scorebox",name:"scoreBox",scoreboxStyle:0,layout:"horizontal",mode:"ffa",spacing:1,iconSpacing:10,coordinates:{top:5,left:5,width:180,height:35,right:185,bottom:40}},{itemType:"general",cssClass:"lib-element-timer",label:"Timer",name:"timer",iconPosition:"left",iconSpacing:"2",iconOpacity:100,iconSize:"14",iconStyle:0,textSize:"30",textOpacity:100,textStyle:3,teamColors:true,text:"0:00",textColor:"FFFFFF",coordinates:{top:48,left:5,width:52,height:14,right:57,bottom:62},iconCoordinates:{top:0,left:0,width:14,height:14},textCoordinates:{top:2,left:16,width:36,height:11}}]},{id:"defaultHUD",isBuiltIn:true,name:"Normal_HUD",items:[{itemType:"general",cssClass:"lib-element-health",label:"Health indicator",name:"healthIndicator",colorRanges:[{name:"Low",range:[-999,25],color:"FF0000"},{name:"Normal",range:[26,100],color:"FFFFFF"},{name:"High",range:[101,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:10,iconOpacity:100,iconSize:"0",iconStyle:0,textSize:"70",textOpacity:100,textStyle:3,teamColors:true,text:"47",textColor:"FFFFFF",coordinates:{top:447,left:204,width:73,height:25,right:277,bottom:472},iconCoordinates:{top:0,left:0,width:0,height:0},textCoordinates:{top:0,left:0,width:73,height:25}},{itemType:"general",cssClass:"lib-element-armor",label:"Armor indicator",name:"armorIndicator",colorRanges:[{name:"Low",range:[-999,25],color:"FF0000"},{name:"Normal",range:[26,100],color:"FFFFFF"},{name:"High",range:[101,999],color:"FFFFFF"}],iconPosition:"left",iconSpacing:10,iconOpacity:100,iconSize:"0",iconStyle:0,textSize:"70",textOpacity:100,textStyle:3,teamColors:true,text:"55",textColor:"FFFFFF",coordinates:{top:447,left:365,width:73,height:25,right:438,bottom:472},iconCoordinates:{top:0,left:0,width:0,height:0},textCoordinates:{top:0,left:0,width:73,height:25}},{itemType:"general",cssClass:"lib-element-ammo",label:"Ammo indicator",name:"ammoIndicator",colorRanges:[{name:"Low",range:[-999,5],color:"FF0000"},{name:"Normal",range:[6,100],color:"FFFFFF"},{name:"High",range:[101,999],color:"FFFFFF"}],iconPosition:"bottom",iconSpacing:"2",iconOpacity:100,iconSize:"14",iconStyle:0,textSize:"42",textOpacity:"60",textStyle:3,teamColors:true,text:"23",textColor:"FFFFFF",coordinates:{top:433,left:300,width:44,height:31,right:344,bottom:464},iconCoordinates:{top:17,left:15,width:14,height:14},textCoordinates:{top:0,left:0,width:44,height:15}},{itemType:"iconItem",cssClass:"lib-element-flag",label:"Flag indicator",name:"flagIndicator",iconStyle:0,iconSize:"32",iconOpacity:100,coordinates:{top:350,left:304,width:32,height:32,right:336,bottom:382}},{itemType:"general",cssClass:"lib-element-powerup",label:"Powerup timer",name:"powerupIndicator",iconPosition:"top",iconSpacing:4,iconOpacity:100,iconSize:"32",iconStyle:0,textSize:55,textOpacity:100,textStyle:3,teamColors:true,text:"32",layout:"vertical",textColor:"FFFFFF",singlePowerup:false,coordinates:{top:222,left:566,width:70,height:36,right:636,bottom:258},iconCoordinates:{top:0,left:0,width:32,height:32},textCoordinates:{top:12,left:36,width:34,height:20}},{itemType:"iconItem",cssClass:"lib-element-player-item",label:"Usable item indicator",name:"playerItem",iconStyle:0,iconSize:"25",iconOpacity:100,coordinates:{top:452,left:520,width:25,height:25,right:545,bottom:477}},{itemType:"iconItem",cssClass:"lib-element-ctf-powerup",label:"CTF powerup indicator",name:"CTFPowerupIndicator",iconStyle:0,iconSize:"25",iconOpacity:100,coordinates:{top:452,left:610,width:25,height:25,right:635,bottom:477}},{itemType:"scoreBox",cssClass:"lib-element-scorebox",label:"Scorebox",name:"scoreBox",scoreboxStyle:0,layout:"horizontal",mode:"ffa",spacing:1,iconSpacing:10,coordinates:{top:5,left:5,width:180,height:35,right:185,bottom:40}},{itemType:"general",cssClass:"lib-element-timer",label:"Timer",name:"timer",iconPosition:"left",iconSpacing:"3",iconOpacity:100,iconSize:"14",iconStyle:0,textSize:"35",textOpacity:100,textStyle:3,teamColors:true,text:"2:18",textColor:"FFFFFF",coordinates:{top:52,left:5,width:47,height:14,right:52,bottom:66},iconCoordinates:{top:0,left:0,width:14,height:14},textCoordinates:{top:1,left:17,width:30,height:13}}]}]}});visualHUD.Collections.CustomHUDPresets=visualHUD.Collections.DictionaryAbstract.extend({LOCAL_STORAGE_KEY:"CustomHUDPresets",getData:function(){var c=window.localStorage.getItem(this.LOCAL_STORAGE_KEY);c=JSON.parse(c);return c||[]},initialize:function(){this.on("all",this.save,this);this.on("add",this.sort,this)},comparator:function(c){return c.get("name")},save:function(){var c=this.toJSON();try{window.localStorage.setItem(this.LOCAL_STORAGE_KEY,JSON.stringify(c))}catch(d){throw ("visualHUD was unable to save last preset. window.localStorage space quota exceeded")}}});visualHUD.Views.Viewport=Backbone.View.extend({tagName:"div",className:"vh-viewport",pinned:true,canvasDragMoveAllowed:false,htmlTpl:['<div class="vh-region vh-viewport-topbar"></div>','<div class="vh-region vh-viewport-sidebar">','<div class="vh-region vh-viewport-sidebar-content">','<div class="pin-sidebar-action sidebar-pinned" title="Pin sidebar"><div class="pin-sidebar-icon"></div></div>',"</div>","</div>",'<div class="vh-region vh-viewport-bottombar"></div>','<div class="vh-region vh-viewport-center"></div>'],events:{mousedown:"checkDragDrop","click .pin-sidebar-action":"toggleSidebarPin"},initialize:function(){var c=this;this.bound={trackResize:$.proxy(this,"trackResize"),trackSpaceDown:$.proxy(this,"trackSpaceDown"),trackSpaceUp:$.proxy(this,"trackSpaceUp")};this.$el.append(this.htmlTpl.join(""));this.$el.disableSelection();this.getDOMRefs();this.initializeClientSettings();this.setupCanvasDrag();this.bindDropImport()},render:function(c){this.setNestedViews(c);this.$el.appendTo(document.body);this.trackResize();this.fireEvent("render",[this])},setNestedViews:function(c){_.each(c,function(d){var e="get"+d.getAlias().split(".").pop()+"View";this[e]=function(){return d}},this)},getDOMRefs:function(){this.$topArea=this.$el.find(".vh-viewport-topbar");this.$sidebarArea=this.$el.find(".vh-viewport-sidebar-content");this.$sidebarWrapper=this.$el.find(".vh-viewport-sidebar");this.$bottomtArea=this.$el.find(".vh-viewport-bottombar");this.$centerArea=this.$el.find(".vh-viewport-center");this.$pinSidebarIcon=this.$el.find(".pin-sidebar-action")},initializeClientSettings:function(){var c=this.options.clientSettingsModel;c.on("change:pinSidebar",this.setSidebarState,this);c.on("change:fullScreenView",this.toggleToolbars,this);this.setSidebarState(c,c.get("pinSidebar"));this.toggleToolbars(c,c.get("fullScreenView"))},trackResize:function(c){this.$el.css({height:$("body").height()+"px"});if(this.pinned==false){this.$centerArea.css({marginLeft:"",left:"",top:""});this.pinned=true}},trackSpaceDown:function(c){if(c.keyCode==32){$(document).unbind("keydown",this.bound.trackSpaceDown);$(document).bind("keyup",this.bound.trackSpaceUp);$(document.body).addClass("drag");this.canvasDragMoveAllowed=true}},trackSpaceUp:function(c){if(c.keyCode==32){$(document).bind("keydown",this.bound.trackSpaceDown);$(document).unbind("keyup",this.bound.trackSpaceUp);$(document.body).removeClass("drag");this.canvasDragMoveAllowed=false}},setupCanvasDrag:function(){var c=this,d;$(window).bind("resize.canvas",this.bound.trackResize);$(document).bind("keydown",this.bound.trackSpaceDown);this.drag=new visualHUD.Utils.DragZoneBase({scope:this,ticks:2,tolerance:2,grid:1,onbeforestart:function(g,h,f){var e=this.$centerArea.position();this.pinned=false;g.moveOffset={x:e.left-f.x,y:e.top-f.y}},ondrag:function(f,g,e){this.$centerArea.css(e)}})},checkDragDrop:function(c){if(this.canvasDragMoveAllowed==true){this.drag.start(c,this.$centerArea)}},hideAllSidebarItems:function(){this.$sidebarArea.children().not(".pin-sidebar-action").hide()},toggleToolbars:function(d,f){var e=this.options.clientSettingsModel,c=e.get("pinSidebar");if(f==false){this.$sidebarWrapper.css("right","");this.bindSidebarSlideEvents(false)}else{if(c==false){this.slideSidebar(false);this.bindSidebarSlideEvents(true)}}this.$el.toggleClass("tools-off",f);this.$el.toggleClass("tools-on",!f);$(window).trigger("resize.form")},slideSidebar:function(e){var c=e==true?0:-1*(this.$sidebarWrapper.width()-30);var d=parseInt(this.$sidebarWrapper.css("right"),10)||0;if(c==d){return}this.$sidebarWrapper.stop().animate({right:c},{duration:200})},toggleSidebarPin:function(){var d=this.options.clientSettingsModel,c=d.get("pinSidebar");d.set("pinSidebar",!c);this.bindSidebarSlideEvents(c)},bindSidebarSlideEvents:function(d){if(d==true){var c=visualHUD.Function.createBuffered(this.slideSidebar,300,this);this.$sidebarArea.bind("mouseenter.slide",function(e){c(true);e.stopPropagation()});this.$sidebarWrapper.bind("mouseleave.slide",function(e){c(false);e.stopPropagation()})}else{this.$sidebarArea.unbind("mouseenter.slide");this.$sidebarWrapper.unbind("mouseleave.slide")}},setSidebarState:function(c,d){this.$pinSidebarIcon.toggleClass("sidebar-pinned",d)},bindDropImport:function(){$(document).on("dragenter dragleave dragover drop",visualHUD.Function.bind(function(d){d.preventDefault();if(d.type=="drop"){var c=Array.prototype.slice.call(d.dataTransfer.files);visualHUD.Libs.importHelper.batchImport(c,{scope:this,files:function(e){this.fireEvent("load.text",[e])},image:function(e){this.fireEvent("import.image",[e])}});return false}return false},this))}});visualHUD.Views.viewport.TopBar=Backbone.View.extend({tagName:"div",className:"app-topbar",htmlTpl:['<div class="app-logo popover-action" data-popover="logo"><span>VisualHUD</span></div>','<div class="toolbar-main global-actions">','<button value="downloadHUD" class="button" id="downloadButton"><span class="w-icon download">Download</span></button>','<span class="file-input" data-tooltip="Open *.vhud file"><span class="btn button-aux"><span class="w-icon open">Open</span><input type="file" name="customHUD"></span><span class="file-name hidden">No file selected</span></span>','<button value="loadPreset" class="button-aux" id="loadPresetButton"><span class="w-icon load" data-tooltip="Import Preset <small>(I)</small>">Import</span></button>',"</div>",'<div class="toolbar-main hud-actions">','<button value="undoUpdate" class="button-aux" data-tooltip="Undo <small>(CTRL+Z)</small>"><span class="w-icon icon-undo">Undo</span></button>','<button value="deleteSelected" class="button-aux single-select-button" data-tooltip="Delete <small>(DEL)</small>"><span class="w-icon icon-trash">Delete</span></button>','<button value="cloneSelected" class="button-aux single-select-button" data-tooltip="Clone <small>(CTRL+V)</small>"><span class="w-icon icon-clone">Clone</span></button>','<button value="groupSelected" class="button-aux multi-select-button" data-tooltip="Group <small>(CTRL+G)</small>"><span class="w-icon icon-group">Group</span></button>','<button value="alignSelected" class="button-aux single-select-button popover-action"  data-tooltip="Align" data-popover="align"><span class="w-carret w-icon icon-align">Align</span></button>',"</div>",'<div class="app-stats">','<span class="counter" id="downloadCounterText">0</span>','<span class="hint">custom HUDs <br />have been created so far</span>',"</div>",'<div class="toolbar-aux global-actions">','<button value="sendFeedback" class="button-aux" id="reportBugButton"><span class="w-icon icon-feedback">Feedback</span></button>',"</div>"],events:{"click .popover-action":"showPopover","click .global-actions button":"onGlobalActionButtonClick","click .hud-actions button":"onHUDActionButtonClick","change input[name=customHUD]":"processSelectedFiles"},initialize:function(){this.$el.append(this.htmlTpl.join(""));this.$("#downloadCounterText").text(parseInt(visualHUD.dlCount,10)||0);this.buttons={download:this.$el.find("#downloadButton"),load:this.$el.find("#loadPresetButton"),restart:this.$el.find("#restartAppButton"),report:this.$el.find("#reportBugButton"),singleSelectActions:this.$el.find(".single-select-button"),multiSelectActions:this.$el.find(".multi-select-button")};this.updateToolbarButtonsState(0);this.setupAlignPopOver();this.setupLogoPopOver()},setupAlignPopOver:function(){var c=this.$el.find("button[value=alignSelected]");this.alignPopover=new visualHUD.Widgets.PopOver({cls:"align-popover",events:{},html:visualHUD.Libs.formControlsBuilder.getTemplateByType("alignControl"),position:"bottom-center",title:"Align selected items",scope:this,show:function(){c.addClass("active");visualHUD.toolTips.disable()},hide:function(){c.removeClass("active");visualHUD.toolTips.enable()}});this.alignPopover.$el.on("click",".align-controls li",visualHUD.Function.bind(this.fireAlignAction,this));this.alignPopover.$el.on("mouseenter",".align-popover li",false)},setupLogoPopOver:function(){var c=this.$el.find(".app-logo");this.logoPopover=new visualHUD.Widgets.PopOver({cls:"logo-popover",cancelEventBubbling:false,html:(['<p>Simple yet powerful <a href="http://www.quakelive.com" target="_blank">Quake Live</a> online HUD builder. Simply drag and drop HUD elements to create completely custom Quake Live HUD</p>',"<p>New to visualHUD? Check these useful links!</p>","<ul>",'<li><a href="help/#videos" target="help">Video Tutorials</a></li>','<li><a href="help/#hotkeys" target="help">Hot Keys Cheat Sheet</a></li>','<li><a href="help/#credits" target="help">Credits</a></li>',"</ul>"]).join(""),position:"bottom-center",title:"visualHUD",scope:this,show:function(){c.addClass("active")},hide:function(){c.removeClass("active")}})},setupFeedbackPopOver:function(){var c=this.$el.find("button[value=feedback]");this.feedbackPopover=new visualHUD.Widgets.PopOver({cls:"feedback-popover",cancelEventBubbling:false,html:(['<ul class="popover-menu">','<li><span class="icon icon-feedback"></span><a href="#" class="item-name" data-action="send-feedback">Give a feedback</a></li>','<li><span class="icon icon-bug"></span><a href="#" class="item-name" data-action="report-bug">Report a bug</a></li>',"</ul>"]).join(""),position:"bottom-right",title:"Feedback",scope:this,show:function(){c.addClass("active")},hide:function(){c.removeClass("active")}});this.feedbackPopover.$el.on("click",".popover-menu a",visualHUD.Function.bind(this.fireFeedbackAction,this))},render:function(c){this.$el.appendTo(c.$topArea)},onGlobalActionButtonClick:function(c){var d=c.currentTarget.value;this.fireEvent("toolbar.global:action",[d])},onHUDActionButtonClick:function(c){var d=c.currentTarget.value;this.fireEvent("toolbar.hud:action",[d]);return false},showPopover:function(d){var e=$(d.currentTarget),c=e.data("popover"),f=this[c+"Popover"];f.visible?f.hide():f.show(e);return false},fireAlignAction:function(c){var e=$(c.currentTarget),d=e.data("action");this.fireEvent("align.action",[d]);return false},fireFeedbackAction:function(c){var e=$(c.currentTarget),d=e.data("action");this.fireEvent("feedback.action",[d])},updateToolbarButtonsState:function(c){this.buttons.singleSelectActions.attr("disabled",c==0);this.buttons.multiSelectActions.attr("disabled",c<=1)},processSelectedFiles:function(d){var c=Array.prototype.slice.call(d.target.files);if(c.length){visualHUD.Libs.importHelper.batchImport(c,{scope:this,files:function(e){this.fireEvent("load.text",[e,true])}})}d.target.value=""}});visualHUD.Views.viewport.CanvasToolbar=Backbone.View.extend({tagName:"ul",className:"app-toolbar",baseCls:"root-item",menuStructure:[{text:"Screenshot",title:"Change location background",cls:"rtl-item shot-toggle",counter:"hidden",options:[{name:"canvasShot",control:"radio",label:"None",value:0},{name:"canvasShot",control:"radio",label:"Longest Yard",value:1},{name:"canvasShot",control:"radio",label:"Almost Lost",value:2},{name:"canvasShot",control:"radio",label:"Custom Background",value:3}]},{text:"Grid",title:"Toggle grid",cls:"rtl-item grid-toggle",counter:"visible",options:[{name:"drawGrid",control:"radio",label:"Off",value:0},{name:"drawGrid",control:"radio",label:"5px",value:5},{name:"drawGrid",control:"radio",label:"10px",value:10}]},{text:"Snap",title:"Snap element to grid",cls:"rtl-item grid-snap",counter:"visible",options:[{name:"snapGrid",control:"radio",label:"Off",value:0},{name:"snapGrid",control:"radio",label:"5px",value:5},{name:"snapGrid",control:"radio",label:"10px",value:10}]},{text:"Status",title:"",cls:"player-status",counter:"hidden",options:null},{text:"HUD Extras",title:"",cls:"hud-extras",counter:"visible",options:[{control:"checkbox",value:1,name:"lagometr",label:"Lagometr"},{control:"checkbox",value:1,name:"speedometr",label:"Speedometr"},{control:"checkbox",value:1,name:"pickup",label:"Item Pickup"},{control:"checkbox",value:1,name:"recordingMessage",label:"Demo Recording Message"}]},{text:"Gun",title:"",cls:"draw-gun",counter:"visible",options:[{name:"drawGun",control:"radio",label:"Hidden",value:0},{name:"drawGun",control:"radio",label:"Right",value:1},{name:"drawGun",control:"radio",label:"Center",value:2}]},{text:"Weapon bar",title:"",cls:"weapong-bar",counter:"visible",options:[{name:"drawWeaponbar",control:"radio",label:"Hidden",value:0},{name:"drawWeaponbar",control:"radio",label:"Right",value:2},{name:"drawWeaponbar",control:"radio",label:"Left",value:1},{name:"drawWeaponbar",control:"radio",label:"Bottom",value:3},{name:"drawWeaponbar",control:"radio",label:"Q3A Style",value:4}]},{text:"Team overlay",title:"",cls:"tm-overlay",counter:"visible",options:[{name:"drawTeamoverlay",control:"radio",label:"Hidden",value:0},{name:"drawTeamoverlay",control:"radio",label:"Top",value:1},{name:"drawTeamoverlay",control:"radio",label:"Bottom",value:2}]}],events:{"click input":"changeCanvasOption","change .player-status input[type=text]":"changeCanvasOption","click .player-status form":"stopPropagation","click li.root-item ul":"onSubmenuClick","click li.root-item":"onRootitemClick","mouseover li.root-item ul":"stopPropagation"},initialize:function(){this.tpl=["<% _.each(items, function(item) { %>",'<li class="<%= baseCls %> <%= item.cls %>" data-tooltip="<%= item.title %>">','<span class="item-name"><%= item.text %></span>','<strong class="item-value <%= item.counter %>">0</strong>',"<% if(item.options && item.options.length){ %>","<ul>","<% _.each(item.options, function(option) { %>","<li>",'<label><input type="<%= option.control %>" name="<%= option.name %>" value="<%= option.value %>" /><span><%= option.label %></span></label>',"</li>","<% }); %>","</ul>","<% }; %>","</li>","<% }); %>"];this.menuStructure.splice(0,0,{text:"View",title:"Filter Elements by Game Type",cls:"rtl-item gt-filter",counter:"hidden",options:this.getGameTypeFilterOptions()})},getGameTypeFilterOptions:function(){var c=[];_.each(visualHUD.Libs.formBuilderMixin.getByName("base").getOwnerDrawOptions(),function(e,d){c.push({name:"ownerDrawFlag",control:"radio",label:e,value:d})});return c},render:function(c){var d=_.template(this.tpl.join(""),{baseCls:this.baseCls,items:this.menuStructure});this.$el.append(d);this.renderPlayerStatusControls();this.renderImageImportMenuItem();var e=this.options.clientSettingsModel;this.setClientSettings(e.toJSON());this.$el.appendTo(c.$bottomtArea)},renderPlayerStatusControls:function(){var f=this.$el.find(".player-status");var d=$("<form />");var c=this.options.clientSettingsModel;var e=[];e.push(visualHUD.Libs.formControlsBuilder.createRangeInput({type:"rangeInput",name:"statusHealth",label:"Health",min:0,max:200,value:c.get("statusHealth")}));e.push(visualHUD.Libs.formControlsBuilder.createRangeInput({type:"rangeInput",name:"statusArmor",label:"Armor",min:0,max:200,value:c.get("statusArmor")}));e.push(visualHUD.Libs.formControlsBuilder.createRangeInput({type:"rangeInput",name:"statusAmmo",label:"Ammo",min:0,max:150,value:c.get("statusAmmo")}));e.push(visualHUD.Libs.formControlsBuilder.createRangeInput({type:"rangeInput",name:"statusSkill",label:"Skill",min:0,max:100,value:c.get("statusSkill")}));_.each(e,function(g){d.append(g)});f.append(d)},renderImageImportMenuItem:function(){var e=this.$el.find("li.shot-toggle ul"),d=(['<a href="#" class="set-custom-bg">',"Import image","</a>"]).join(""),f=$("<li />").html(d).appendTo(e),c=f.find("a.set-custom-bg");c.click(visualHUD.Function.bind(function(g){this.fireEvent("import.image");g.preventDefault()},this))},onRootitemClick:function(d){d.preventDefault();var c=$(d.currentTarget);var f=this.$el.children();var h=f.filter(".active").not(c).removeClass("active");var g=null;c.toggleClass("active");g=c.hasClass("active");this.fireEvent("toolbar.menu:show",[this]);var e=visualHUD.Function.bind(this.hideMenu,this);if(g&&h.length==0){window.setTimeout(function(){$("body").bind("click.hideMenu",e)},20)}else{if(!g&&h.length==0){$("body").bind("click.hideMenu",e)}else{d.stopPropagation()}}},hideMenu:function(){var c=this.$el.children();c.filter(".active").removeClass("active");$("body").unbind("click.hideMenu");this.fireEvent("toolbar.menu:hide",[this])},onSubmenuClick:function(c){c.stopPropagation();var d=this.$el.children();d.filter(".active").removeClass("active");$("body").unbind("click.hideMenu")},changeCanvasOption:function(h){var i=h.currentTarget;var d=$(i);var g=d.is("[type=checkbox]");var e=d.is("[type=radio]");var c=d.closest("li.root-item").find("strong.item-value").text(i.value);if(i.name!=""){var f=this.options.clientSettingsModel;f.set(i.name,g?i.checked:i.value)}},setClientSettings:function(f){var j,g,h,c,e,i;for(var k in f){j=f[k];c=_.template("input[name=<%= name %>]",{name:k});i=this.$el.find(c);if(j===true){i.attr("checked",j)}else{e=_.template("input[value=<%= name %>]",{name:j});i=i.filter(e);i.attr("checked",true);var d=i.closest("li.root-item").find("strong.item-value").text(j)}}},stopPropagation:function(c){c.stopPropagation();return false}});visualHUD.Views.viewport.Canvas=Backbone.View.extend({className:"hud-canvas",tagName:"div",htmlTpl:['<div class="canvas-extras">','<div class="hud-weapon"></div>','<div class="hud-crosshair"></div>','<div class="weapon-bar"></div>','<div class="team-overlay"></div>','<div class="lag-o-metr"></div>','<div class="speed-o-metr"></div>','<div class="pickup-message"></div>','<div class="demo-rec-message"></div>',"</div>",'<div class="hud-elements">',"</div>"],clientSettingsMap:{lagometr:{"1":"draw-lag"},speedometr:{"1":"draw-speed"},pickup:{"1":"draw-pickup"},recordingMessage:{"1":"draw-demo-rec"},drawGrid:{"0":"no-grid","5":"grid-5","10":"grid-10"},drawGun:{"0":"no-gun","1":"gun-1","2":"gun-2"},drawWeaponbar:{"0":"no-gun","1":"wbar-1","2":"wbar-2","3":"wbar-3","4":"wbar-4"},drawTeamoverlay:{"0":"no-teamoverlay","1":"teamoverlay-1","2":"teamoverlay-2"}},events:{mousedown:"checkDragAction"},initialize:function(){_.extend(this,visualHUD.Libs.selectionManagerInterface);this.initializeDragManager()},render:function(c){this.viewport=c;this.$el.append(this.htmlTpl.join(""));this.getRefs();this.$el.appendTo(c.$centerArea);var d=this.options.clientSettingsModel;d.changed=d.toJSON();this.setClientSettings(d);d.on("change",this.setClientSettings,this)},getRefs:function(){this.$HUDextras=this.$el.find(".canvas-extras");this.$canvas=this.$el.find(".hud-elements")},setClientSettings:function(c){var d=this.clientSettingsMap;_.each(c.changed,function(i,g){if(g=="snapGrid"){this.dragManager.setOptions({grid:Math.max(parseInt(i,10)*visualHUD.scaleFactor,visualHUD.scaleFactor)})}if(g=="canvasShot"){var k=this.$el.parent().attr("class");k=k.replace(/canvas-[0-9]/,"");k=$.trim(k)+" canvas-"+i;this.$el.parent().attr("class",k);if(i<3){this.$customImage&&this.$customImage.hide()}else{if(i==3){this.setCustomBackground()}}return}if(g=="ownerDrawFlag"){var j=c._previousAttributes[g]||"";this.$el.parent().removeClass("gt-"+j.toLowerCase()).addClass("gt-"+i.toLowerCase())}var f=this.clientSettingsMap[g];if(f){var h="removeClass";for(var e in f){h=i==e?"addClass":"removeClass";this.$el[h](f[e])}}},this)},initializeDragManager:function(){var c=this;this.dragManager=new visualHUD.Utils.DragZoneBase({ticks:0,tolerance:2,grid:visualHUD.scaleFactor,view:this});_.extend(this.dragManager,visualHUD.Libs.canvasDragInterface)},checkDragAction:function(f){var c=$(f.target);var d=c.closest(".hud-item",this.$el);var e=c.closest("div.resize-handle",this.$el);if(this.viewport.canvasDragMoveAllowed==true){return}else{if(e.length){this.dragManager.setMode("resize").start(f,e);return false}if(d.length){this.dragManager.setMode("move").start(f,d);return false}else{this.dragManager.setMode("select").start(f);return false}}},deselectItem:function(c){this.deselect();return false},getCanvasOffset:function(){var e=this.$canvas.offset(),d={width:this.$canvas.width(),height:this.$canvas.height()},c={top:e.top,left:e.left,right:e.left+d.width,bottom:e.top+d.height};_.extend(c,d);return c},beginUpdate:function(){this.$el.addClass("hud-items-hidden")},completeUpdate:function(){this.$el.removeClass("hud-items-hidden");this.$el.find("div."+visualHUD.Views.HUDItem.prototype.className).each(function(c){var d=$(this).data("HUDItem");d.refreshCoordinates()})},setCustomBackground:function(){var c=this.options.clientSettingsModel;var e=c.previous("canvasShot");var f=c.get("customBackground");this.$customImage=this.$customImage||$("<img/>").css({position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"none"}).prependTo(this.$el);if(f){this.$customImage.attr("src",f).show()}else{if(visualHUD.growl){var d=visualHUD.growl.alert({status:"warning",title:"No custom image",message:'Custom background was not imported yet. Would you like to <a href="#" class="import">import</a>?'});d.find("a.import").click(visualHUD.Function.bind(function(){this.fireEvent("import.image");visualHUD.growl.hide(d);return false},this))}visualHUD.Function.createDelayed(function(g,i){var h={};h[g]=i;c.set(h);this.viewport.getCanvasToolbarView().setClientSettings(h)},10,this,["canvasShot",e])()}},updateIndexes:function(){var e=this.$canvas.children(),d=e.length,c;e.each(function(f){c=e.eq(f).data("HUDItem");c.model.set("index",f)})}});visualHUD.Views.viewport.StageControls=Backbone.View.extend({tagName:"div",className:"stage-controlls-area",collection:null,htmlTpl:['<div class="sidebar-block" id="getStartedTextarea">',"<h3>Get started</h3>",'<div class="mb-10">',"Use icons below to build your HUD. Drag and drop items or simple double click on icon to create new HUD element","</div>","<div>",'<a href="help/#videos" target="help" class="mr-20">View Video Tutorials</a>',"</div>","</div>",'<div class="sidebar-block stage-controls" id="stageControlsArea">',"<h4>HUD Elements</h4>",'<ul class="library-items clearfloat">',"</ul>","</div>",'<div class="sidebar-block stage-controls" id="editorSettingsArea">',"<h4>Editor Size and Layout</h4>",'<ul class="library-items icons-32px viewport-size-controls ctrl-group clearfloat">','<li data-viewportsize="1" data-tooltip="Normal<small>640x480</small>" class="ctrl normal-viewport"><span class="item-name">Normal</span></li>','<li data-viewportsize="2" data-tooltip="Doubled<small>1280x960</small>" class="ctrl doubled-viewport"><span class="item-name">Doubled</span></li>',"</ul>",'<ul class="library-items icons-32px viewport-layout-controls ctrl-group clearfloat">','<li data-layout="false" data-tooltip="Full Layout" class="ctrl normal-layout"><span class="item-name">Normal</span></li>','<li data-layout="true" data-tooltip="Compact Layout" class="ctrl compact-layout"><span class="item-name">Doubled</span></li>',"</ul>","</div>"],stageControlTpl:['<li class="<%= cssClass %>"  id="<%= id %>" data-id="<%= id %>" data-tooltip="<%= label %>">','<span class="item-name"><%= label %></span>',"</li>"],events:{"mousedown #stageControlsArea li":"startDrag","dblclick #stageControlsArea li":"dropHUDItem","click .viewport-size-controls li":"switchEditorSize","click .viewport-layout-controls li":"switchEditorLayout","mouseenter .viewport-size-controls li":"exposeEditor","mouseleave .viewport-size-controls li":"maskEditor"},initialize:function(){var c=[];this.collection.each(function(d){c.push(_.template(this.stageControlTpl.join(""),{id:d.get("id"),label:d.get("label"),cssClass:d.get("cssClass")}))},this);this.$el.append(this.htmlTpl.join(""));this.$("#stageControlsArea").find("ul.library-items").append(c.join(""));this.setupDragManager()},render:function(c){this.viewport=c;this.$el.appendTo(c.$sidebarArea)},setupDragManager:function(){var d,c;this.dragManager=new visualHUD.Utils.DragZoneBase({scope:this,ticks:2,tolerance:3,position:"offset",bodyDragClass:"new-item-drag",init:function(e){e.ghost.addClass("stage-controls-drag-helper")},onbeforestart:function(){d=this.viewport.getCanvasView().getCanvasOffset();c=this.viewport.$centerArea},onstart:function(f){var e={left:f.mouse.x+f.moveOffset.x,top:f.y+f.moveOffset.y,display:"block"};f.ghost.addClass(f.currentElement[0].className).css(e);f.currentElement.addClass("drag-start")},ondrag:function(g,h,e,f){g.ghost.css(e);if(d.top<f.y&&d.left<f.x&&d.right>f.x&&d.bottom>f.y){if(!c.hasClass("new-item-drop-over")){c.addClass("new-item-drop-over")}}else{if(c.hasClass("new-item-drop-over")){c.removeClass("new-item-drop-over")}}},ondrop:function(i,j,f){var g=i.currentElement.data().id;var e=this.collection.get(g);var h=i.getMouse(j);var k=d.top<h.y&&d.left<h.x&&d.right>h.x&&d.bottom>h.y;i.ghost.removeClass(i.currentElement[0].className);i.currentElement.removeClass("drag-start");c.removeClass("new-item-drop-over");if(k){this.fireEvent("item.drop",[e,{top:Math.round(h.y-d.top),left:Math.round(h.x-d.left)}])}}})},startDrag:function(d){var c=$(d.currentTarget);if(c.hasClass("disabled")){return false}this.dragManager.start(d,c);if(d.stopPropagation){d.stopPropagation()}if(d.preventDefault){d.preventDefault()}return false},dropHUDItem:function(f){var c=$(f.currentTarget),g=c.data().id,d=this.collection.get(g),e=this.viewport.getCanvasView().getCanvasOffset();if(c.hasClass("disabled")){return false}this.fireEvent("item.drop",[d,{top:Math.round(e.height/2),left:Math.round(e.width/2)}])},switchEditorSize:function(d){var c=$(d.currentTarget),e=parseInt(c.data("viewportsize"),10);this.fireEvent("scalefactor.change",[e])},exposeEditor:function(){var c=this.viewport.$centerArea;c.addClass("new-item-drop-over")},maskEditor:function(){var c=this.viewport.$centerArea;c.removeClass("new-item-drop-over")},switchEditorLayout:function(e){var c=$(e.currentTarget),d=c.data("layout");this.fireEvent("layout.change",[d])},updateControlsStatus:function(g,d){var f=this.$("#"+d),c=this.collection.get(d),h=c.get("isSingle"),e="addClass";switch(g){case"create":e="addClass";break;case"destroy":e="removeClass";break}h&&f[e]("disabled")}});visualHUD.Views.HUDItem=Backbone.View.extend({tagName:"div",className:"hud-item",events:{click:"itemClick"},initialize:function(){var e=visualHUD.Libs.itemBuilderMixin.getByType("general"),c=visualHUD.Libs.itemBuilderMixin.getByType(this.model.get("itemType")),d=visualHUD.Libs.itemBuilderMixin.getByName(this.model.get("name"));if(e==c){c={}}_.extend(this,e,c||{},d||{});this.$el.data("HUDItem",this);this.model.on("change",this.onModelUpdate,this);this.model.on("destroy",this.onModelDestroy,this);this.model._HUDItem=this;this.delayedStatusUpdate=visualHUD.Function.createBuffered(this.refreshCoordinates,10,this);this.render()},render:function(){var j=this.options.renderTo,d=this.prepareTemplate();var i=this.model.get("coordinates");var e=this.model.get("resizable");this.$el.addClass(this.options.htmlTplRecord.get("cssClass"));this.$el.append(d);this.$el.css({visibility:"hidden"});if(this.model.get("resizable")==true){this.appendResizehandles()}this.getDOMRefs();_.each(this.model.attributes,function(k,l){k!=null&&this.callUpdateMethodByField(l,false)},this);this.$el.appendTo(j);var f=i.width,c=i.height,h=this.model.wasDropped?i.top-this.$el.height()/2:i.top*visualHUD.scaleFactor,g=this.model.wasDropped?i.left-this.$el.width()/2:i.left*visualHUD.scaleFactor;this.$el.css({width:this.model.get("width")*visualHUD.scaleFactor||"auto",height:this.model.get("height")*visualHUD.scaleFactor||"auto",top:Math.round(h),left:Math.round(g)});this.refreshCoordinates();this.getForm().render();this.$el.css({visibility:""})},prepareTemplate:function(){var h=this.model.toJSON(),g=this.options.htmlTplRecord,d=g.get("template").join(""),f=this.getIconOptions(),c=f?f[this.model.get("iconStyle")]:null,e;h.icon=this.model.get("iconStyle")!=null?c:f;e=_.template(d,h);return e},appendResizehandles:function(){var c=[];_.each(["nw","n","ne","e","se","s","sw","w"],function(d){c.push('<div class="resize-handle '+d+'" data-resizeDirection="'+d+'"></div>')});this.$el.append(c.join(""))},getDOMRefs:function(){var c=this.refs;if(!c){this.refs={layoutBox:this.$el.find("div.hud-item-layout"),iconBlock:this.$el.find("div.item-icon"),icon:this.$el.find("div.item-icon img"),textBlock:this.$el.find("div.item-counter"),counter:this.$el.find("div.item-counter span.counter"),templateText:this.$el.find("div.item-counter span.text"),box:this.$el.find(".hud-item-box"),h100:this.$el.find(".hud-item-box div.h100"),h200:this.$el.find(".hud-item-box div.h200"),chatList:this.$el.find("ul.chat-messages")}}return c},getForm:function(){return this.options.formView},getIconOptions:function(){var e=this.options.HUDItemIconEnums,c=e.get(this.model.get("name")),d=c?c.get("options"):null;return d},onModelDestroy:function(){this.remove();this.getForm().remove();this.options.formView=null;this.fireEvent("destroy",[this.model])},onModelUpdate:function(c,e){var d=e.changes;_.each(d,function(h,g){var f=g.match(/coordinates|width|height|padding|textSize|iconSize|iconSpacing|iconPosition/gi)!=null;h&&this.callUpdateMethodByField(g,f)},this)},callUpdateMethodByField:function(g,d){var f=this.model.get(g),c="update"+g.charAt(0).toUpperCase()+g.substring(1),e=this[c];if(_.isFunction(e)){e.call(this,f);(d===true)&&this.delayedStatusUpdate(true)}},refreshCoordinates:function(d){if(this.$el.is(":visible")){var c=this.$el.position(),e={top:Math.round(c.top/visualHUD.scaleFactor),left:Math.round(c.left/visualHUD.scaleFactor),height:Math.round(this.$el.height()/visualHUD.scaleFactor),width:Math.round(this.$el.width()/visualHUD.scaleFactor)};this.model.set("coordinates",e,{silent:d});(d==true)&&this.getForm().updateStatusBar();return e}},move:function(e,f){var c=this.$el.position();c[e]+=f;var d=this.checkPosition(c);this.$el.css(d);this.refreshCoordinates()},checkPosition:function(c){var f=this.$el;var g=f.offsetParent();var e=this.limits||{top:0,left:0,right:g.width(),bottom:g.height()};this.limits=e;var d={width:f.width(),height:f.height()};if(c.left+d.width>e.right){c.left=e.right-d.width}if(c.top+d.height>e.bottom){c.top=e.bottom-d.height}c.left=Math.round(c.left<0?0:c.left);c.top=Math.round(c.top<0?0:c.top);return c},itemClick:function(c){this.fireEvent("click",[this,c])},getGroup:function(){return this.model.get("group")},setGroup:function(c){this.model.set("group",c||null)},update:function(d){var c=this.getForm();this.model.set(d);c.setValues(d,{silent:true})},updateCoordinates:function(c){this.$el.css({top:c.top*visualHUD.scaleFactor,left:c.left*visualHUD.scaleFactor})},updateTextSize:function(c){},updateTextStyle:function(c){},updateTextOpacity:function(c){},updateIconPosition:function(c,d){},updateIconOpacity:function(c){},updateIconSize:function(c){},updateIconStyle:function(c){},updateIconSpacing:function(c){},updateTextColor:function(c){},updateTeamColors:function(c){},updateColorRanges:function(c){},updateText:function(c){},updateBorderRadius:function(c){},updateBoxStyle:function(c){},updateTemplate:function(c){},updatePowerupView:function(c){},updatePadding:function(c){},updateToggleChat:function(c){},updateScoreboxLayout:function(c){}});visualHUD.Views.HUDItemForm=Backbone.View.extend({tagName:"form",className:"app-form",basicTpl:['<div class="control-header">','<div class="header-wrap <%= className %>">','<span class="item-type">Item:</span>','<div class="item-name"><%= label %></div>',"</div>","</div>",'<div class="app-form-container">','<div class="app-form-controls">',"</div>","</div>",'<div class="form-bbar">','<div class="item-status">',"</div>","</div>"],statusBarTpl:['<span class="mr-10">','<span class="item-name">X:</span>','<span class="item-value"><%= left %></span>',"</span>",'<span class="mr-10">','<span class="item-name">Y:</span>','<span class="item-value"><%= top %></span>',"</span>",'<span class="mr-10">','<span class="item-name">W:</span>','<span class="item-value"><%= width %></span>',"</span>",'<span class="mr-10">','<span class="item-name">H:</span>','<span class="item-value"><%= height %></span>',"</span>"],events:{submit:"preventSubmit","click legend":"toggleFieldsetCollapse",change:"onChange","click .align-controls li":"alignItems","click .arrange-controls li":"arrangeItems"},initialize:function(){var f=visualHUD.Libs.formBuilderMixin.getByType("base"),c=visualHUD.Libs.formBuilderMixin.getByType(this.model.get("itemType")),e=visualHUD.Libs.formBuilderMixin.getByName(this.model.get("name"));_.extend(this,f,c||{},e||{});_.extend(this,visualHUD.Libs.formControlsBuilder);var d=_.template(this.basicTpl.join(""),{className:this.model.get("cssClass"),label:this.model.get("label")});this.$el.append(d);this.hide();this.model.on("change:coordinates",this.updateStatusBar,this);$(window).bind("resize.form",$.proxy(this,"trackResize"))},render:function(){var c=this.options.renderTo;this.$el.appendTo(c);this.trackResize();this.updateStatusBar();visualHUD.Libs.colorHelper.setupColorPicker(c);this.createControls(this.$el.find(".app-form-controls"))},trackResize:function(){var d=this.$el.parent(),c=d.height();this.$el.height(c)},updateStatusBar:function(){var d=this.model.get("coordinates");var c=_.template(this.statusBarTpl.join(""),d);this.$el.find(".item-status").html(c)},getCollection:function(c){return this.options.collections[c]||null},onChange:function(e){var c=e.target.name;if(c&&e.silent!==true){var g=$(e.target);var f=g.is("[type=checkbox]")?g.get(0).checked:g.val();var d=c.match(/^colorRange/);if(d){f=this.getColorRangeChanges(c,f);c="colorRanges"}this.model.set(c,f)}return},getColorRangeChanges:function(f,j){var e=f.split("_");var h=parseInt(e[1],10);var g=parseInt(e[3],10);var d=Array.prototype.slice.call(this.model.get("colorRanges"));var c=_.clone(d[h]);var i=Array.prototype.slice.call(c.range);d[h]=c;c.range=i;if(e[2]=="range"&&g!==undefined){i[g]=parseInt(j,10)}else{if(e[2]=="color"){c.color=j}}return d},preventSubmit:function(c){c.preventDefault()},getValues:function(){var d=/select|textarea/i;var c=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i;var e=this.$el.find("input,select,textarea");return this.$el.map(function(){return jQuery.makeArray(e)}).filter(function(){return this.name&&!this.disabled&&(this.checked||d.test(this.nodeName)||c.test(this.type))}).map(function(g,h){var f={};f[h.name]=jQuery(this).val();return f}).get()},setValues:function(d,c){var c=c||{};_.each(d,function(g,e){var h=this.$el.find("[name="+e+"]");if(h.length){var f=jQuery.Event("change");f.silent=c.silent||false;h.val(g).trigger(f)}},this)},toggleFieldsetCollapse:function(d){var e=$(d.target);var c=e.closest("fieldset",this.$el);c.toggleClass("collapsed")},alignItems:function(c){var e=$(c.currentTarget),d=e.data("action");this.fireEvent("align.action",[d]);return false},arrangeItems:function(c){var e=$(c.currentTarget),d=e.data("action");this.fireEvent("arrange.action",[d]);return false},createControls:function(){}});visualHUD.Views.WindowBase=Backbone.View.extend({tagName:"div",className:"xpk-window",opened:false,rendered:false,defaults:{width:500,height:"auto"},mixin:[],htmlTpl:['<div class="xpk-mwindow-wrap">','<div class="xpk-mwindow-content">','<div class="xpk-win-head clearfloat">',"<h3><%= title %></h3>",'<a href="#" class="xpk-close-button">&times;</a>',"</div>",'<div class="xpk-win-content clearfloat">',"<%= html %>","</div>","</div>","</div>"],initialize:function(d){var c=[this];this.options=_.extend({},this.defaults,d);_.each(this.mixin,function(f){c.push(Backbone.resolveNamespace(f))});if(this.mixin.length){_.extend.apply(_,c)}var e=_.template(this.htmlTpl.join(""),{title:this.options.title||"Modal Window",html:this.html||this.options.html||""});this.$el.append(e);this.getRefs();this.bindEvents();this.init();this.render()},init:function(){},render:function(){this.$el.css({display:"none"}).appendTo(document.body);this.rendered=true;this.fireEvent("render",this)},getRefs:function(){this.$contentWrapper=this.$el.find("div.xpk-mwindow-wrap");this.$content=this.$el.find("div.xpk-win-content");this.$title=this.$el.find(".xpk-win-head h3");this.$closeButton=this.$el.find(".xpk-close-button");this.$closeButton.click($.proxy(this.hide,this));this.$el.click($.proxy(this.cancelEventBubbling,this))},bindEvents:function(){if(this.options.show){this.on("show",this.options.show,this)}if(this.options.hide){this.on("hide",this.options.hide,this)}if(this.options.cancel){this.on("hide",this.options.cancel,this)}},setTitle:function(c){this.$title.html(c)},update:function(c){this.$content.empty().append(c)},show:function(){var f=this.options.width;var c=this.options.height;this.$el.css({visibility:"hidden",top:0,left:0,display:"block"});this.$contentWrapper.css({width:f,height:c});var e=[10,this.$el.height()];var d=this.getTopPosition(e);var h=this.$contentWrapper.height();this.$contentWrapper.addClass("xpk-win-show").css({width:10,height:10});var g=visualHUD.Function.bind(this.animateWindow,this,[f,h,d]);if($.showModalOverlay){$.showModalOverlay(200,0.7,g)}else{g()}return this},hide:function(c){this.$el.css({display:"none"});$.hideModalOverlay();this.opened=false;$(window).unbind("resize.reposition");$(document).unbind("keyup.keyboardListiner");this.fireEvent("hide",[this]);if(c instanceof jQuery.Event){c.preventDefault()}return this},getTopPosition:function(d){var f=[];var c=$(document.body).height();var e=$(window).scrollTop();f[0]=Math.round(c/2-d[0]/2);f[0]+=e;f[1]=Math.round(c/2-d[1]/2);f[1]+=e;if(f[1]<0){f[1]=0}return f},animateWindow:function(e,c,f){var k=this;var g=250;var j=jQuery.easing.easeOutExpo?"easeOutExpo":"swing";var i=this.$contentWrapper;var m=this.options;var h=this.$el;var l=visualHUD.Function.createBuffered(this.reposition,200,this);var d=visualHUD.Function.bind(this.keyboardListiner,this);this.$el.css({overflow:"hidden",visibility:"visible",height:"auto",top:f[0]});i.animate({width:e,height:c},{easing:j,duration:g,complete:function(){i.removeClass("xpk-win-show").css({height:m.height});k.opened=true;k.fireEvent("show",[k]);$(window).bind("resize.windowReposition",l);$(document).bind("keyup.windowKeyboardListiner",d);l()}});this.$el.animate({top:f[1]},{easing:j,duration:g});return this},reposition:function(){if(this.$el.is(":visible")){var d=$(document.body).height();var c=this.$el.height();var e=this.getTopPosition([0,c]);c=c>d?d:"auto";this.$el.css({overflow:"auto",height:c,top:e[1]})}},keyboardListiner:function(c){if(c.keyCode==27){this.fireEvent("cancel",[this])}},cancel:function(){this.fireEvent("cancel",[this])},cancelEventBubbling:function(c){c.stopPropagation()},serializeForm:function(){return this.$content.serializeForm()}});(function(c){})(jQuery);visualHUD.Views.windows.Download=visualHUD.Views.WindowBase.extend({mixin:["visualHUD.Libs.formControlsBuilder","visualHUD.Libs.formBuilderMixin.base"],events:{"click button[name=downloadHUD]":"beginDownload","click button[name=cancel]":"hide","change input[name=hud_name]":"validateName","keyup input[name=hud_name]":"validateNameBuffered"},html:(['<div class="mb-20">',"<p>You are about to download your custom HUD. Please, name it and click [Download] button. </p>",'Don\'t know how to use a custom HUD? Check out holysh1t\'s custom <a href="http://www.holysh1t.net/quakelive-custom-hud-install-guide/" target="_blank">HUD install guide</a>.',"</div>"]).join(""),init:function(){var c=this.buildForm([{type:"form",cssClass:"mwin-form",id:"downloadHUDForm",action:visualHUD.ACTION_DOWNLOAD_HUD,method:"post",items:[{type:"textbox",name:"hud_data",inputType:"hidden",wrap:false},{type:"textbox",name:"hud_name",label:"HUD name",size:32,maxlength:128,value:"",hint:"HUD name should be at least 3 characters length and contain only letters and numbers"},{type:"checkbox",name:"save_preset",tooltip:"All custom presets are available from the Import dialog",boxLabel:"Save as custom preset",checked:true},{type:"toolbar",cssClass:"pt-10",items:[{type:"button",text:"Download",icon:"download",role:"main",action:"submit",name:"downloadHUD"},{type:"button",text:"Cancel",role:"aux",name:"cancel"}]}]}]);this.$content.get(0).appendChild(c);this.validateNameBuffered=visualHUD.Function.createBuffered(this.validateName,200,this);this.on("show",this.setFocus,this);this.on("cancel",this.hide,this)},setHUDName:function(c){if(c){this.$el.find("input[name=hud_name]").val(c)}return this},beginDownload:function(){try{var d=this.$el.find("input[name=hud_name]").val(),f=this.collection.serialize(),c={name:d,items:f};this.setHUDData(c);this.fireEvent("download",[this,c]);this.hide()}catch(g){throw (g.message);return false}},setFocus:function(){this.$el.find("input[name=hud_name]").focus();this.validateName()},validateName:function(){var c=this.$textbox||this.$content.find("input[name=hud_name]").get(0);var d=this.$submitButton||this.$content.find("button[name=downloadHUD]");this.$submitButton=d;this.$textbox=c;var e=c.value.length&&(/^[aA-zZ_\-0-9\.]{3,128}$/).test(c.value);d.attr("disabled",e==false)},getForm:function(){var c=this.$form;if(c==undefined){this.$form=c=this.$("#downloadHUDForm")}return c},setHUDData:function(c){if(_.isString(c)==false){c=JSON.stringify(c)}this.$el.find("input[name=hud_data]").val(c)}});visualHUD.Views.windows.ImportHUD=visualHUD.Views.WindowBase.extend({mixin:["visualHUD.Libs.formControlsBuilder","visualHUD.Libs.formBuilderMixin.base"],events:{"click button[name=loadHUD]":"loadHUD","click button[name=cancel]":"hide","click button[name=downloadPresets]":"downloadPresets","keyup textarea[name=hud_json]":"validateHUDJsonBuffered","keyup input[name=preset_filter]":"filterPresetsBuffered","change input[name=preset_filter]":"filterPresets","change form":"updateFormStatus","change input[name=myCustomPreset]":"processSelectedFiles"},html:(['<div class="mb-20">','To add more presets, click [Browse For Presets...] button and choose *.vhud files to import. Also you can simply drag and drop these files right into the browser window.<a href="help/#import" target="help" class="ml-10">Learn more</a>',"</div>"]).join(""),init:function(){this.createDlPresetForm();this.createImportForm();this.bindExtraEvents();this.setDlPresetButtonState();this.customHUDPresetsList=this.$("#customHUDList").data("component")},importPredefined:function(){this.$el.find("[value=predefined]").attr("checked",true);this.showPredefinedHUDPresets();this.show()},importCustom:function(){this.$el.find("[value=custom]").attr("checked",true);this.showCustomHUDPresets();this.show()},bindExtraEvents:function(){this.validateHUDJsonBuffered=visualHUD.Function.createBuffered(this.validateHUDJson,200,this);this.filterPresetsBuffered=visualHUD.Function.createBuffered(this.filterPresets,200,this);var d=visualHUD.Function.createBuffered(this.onListUpdate,250,this);this.options.customPresetsCollection.on("add",d);this.options.customPresetsCollection.on("remove",d);this.options.customPresetsCollection.on("all",this.setDlPresetButtonState,this);var c=this.$el.find("[name=preset_filter]").get(0);this.on("show",c.focus,c);this.on("show",this.validateHUDJson,this);this.on("hide",this.reset,this);this.on("load",this.hide,this);this.on("cancel",this.hide,this)},importPredefinedHUD:function(d,e,c,f){if(c==undefined){return true}var h=$(f.target).closest("li.action",e);if(h.length){var g=h.data("action");switch(g){case"delete":d.collection.remove(c);break;case"download":this.fireEvent("download.preset",[c.attributes]);break}}else{this.fireEvent("load",[c.attributes])}},toggleNameField:function(d){var c=this.$nameField||this.$("#HUDNameTextbox");if(d){this.$nameField=c.removeClass("hidden");c.find("input").val("").get(0).focus()}else{this.$nameField=c.addClass("hidden");c.find("input").val("")}this.reposition()},showCustomHUDControl:function(){var d=this.$customHUDControl||this.$("#customHUDControl");var c=this.$predefinedHUDPresets||this.$("#predefinedHUDPresets");var e=this.$customHUDPresets||this.$("#customHUDPresets");this.$customHUDControl=d.removeClass("hidden");this.$predefinedHUDPresets=c.addClass("hidden");this.$customHUDPresets=e.addClass("hidden");this.reposition();this.$el.find("[name=hud_json]").focus().select()},showPredefinedHUDPresets:function(){var d=this.$customHUDControl||this.$("#customHUDControl");var c=this.$predefinedHUDPresets||this.$("#predefinedHUDPresets");var e=this.$customHUDPresets||this.$("#customHUDPresets");this.$customHUDControl=d.addClass("hidden");this.$predefinedHUDPresets=c.removeClass("hidden");this.$customHUDPresets=e.addClass("hidden");this.reposition()},showCustomHUDPresets:function(){var d=this.$customHUDControl||this.$("#customHUDControl");var c=this.$predefinedHUDPresets||this.$("#predefinedHUDPresets");var e=this.$customHUDPresets||this.$("#customHUDPresets");this.$customHUDControl=d.addClass("hidden");this.$predefinedHUDPresets=c.addClass("hidden");this.$customHUDPresets=e.removeClass("hidden");this.$el.find("[name=preset_filter]").focus();this.reposition()},validateHUDJson:function(){var c=this.$textarea||this.$content.find("[name=hud_json]").get(0);var f=this.$content.find("[name=presetType]:checked");var j=f.val();var d=this.$submitButton||this.$content.find("button[name=loadHUD]");this.$submitButton=d;this.$textbox=c;var i=false;if(j=="custom"){try{var g=JSON.parse(c.value);if(_.isArray(g)){i=g.length}else{if(_.isObject(g)){i=g.items.length;if(g.name){this.toggleNameField(true);this.$el.find("[name=hud_name]").val(g.name);this.$el.find("[name=save_preset]").attr("checked",true)}}}}catch(h){}}d.attr("disabled",i==false)},filterPresets:function(d){var e=d.target.value,c=new RegExp(e,"gi");this.options.customPresetsCollection.each(function(f){var g=this.customHUDPresetsList.getElementByModel(f);if(f.get("name").match(c)==null){g.hide()}else{g.show()}},this)},updateFormStatus:function(f){var e=$(f.currentTarget);var c=this.serializeForm();var d=f.target.name;switch(c[d]){case"predefined":this.showPredefinedHUDPresets();break;case"custom":this.showCustomHUDPresets();break}switch(d){case"save_preset":this.toggleNameField(!!c[d]);break}this.validateHUDJson()},reset:function(){this.$content.find("form").get(0).reset();this.showCustomHUDPresets();this.$content.find("[name=presetType][value=custom]").attr("checked",true)},cancel:function(){this.hide()},loadHUD:function(){var c=this.serializeForm(),f,g,d=c.hud_name;switch(c.presetType){case"custom":try{g=JSON.parse(c.hud_json)}catch(h){visualHUD.growl.alert({status:"error",title:"Invalid HUD Preset",message:visualHUD.messages.HUD_PARSE_ERROR})}break}if(_.isArray(g)&&g.length){this.fireEvent("load",[{name:d,items:g}])}else{if(_.isObject(g)&&g.items.length){this.fireEvent("load",[g])}}},onListUpdate:function(){if(this.opened){this.reposition()}},createImportForm:function(){var c=this.buildForm([{type:"form",cssClass:"mwin-form",id:"importHUDForm",items:[{type:"radiobuttonGroup",layout:"inline",label:"Choose preset",options:[{name:"presetType",value:"custom",boxLabel:"Custom",checked:true},{name:"presetType",value:"predefined",boxLabel:"Predefined"}]},{type:"container",id:"customHUDControl",cssClass:"hidden",items:[{type:"textarea",name:"hud_json",label:"",rows:3,hint:'Custom HUD code can be found at *.vhud file. <a href="help/#import" target="help">Learn more</a>'},{type:"checkbox",name:"save_preset",tooltip:"Check this option if you want to be able edit this HUD later without importing code from external file",boxLabel:"Name preset to add it to My HUDs collection",checked:false},{type:"textbox",id:"HUDNameTextbox",cssClass:"hidden",name:"hud_name",label:"",size:32,maxlength:128,value:""}]},{type:"container",cssClass:"hidden mb-10",id:"predefinedHUDPresets",items:{type:"component",constructorName:"visualHUD.Views.SystemHUDPresetList",collection:this.options.presetCollection,scope:this,itemclick:this.importPredefinedHUD}},{type:"container",cssClass:"mb-10 clearfloat",id:"customHUDPresets",items:[{type:"textbox",label:null,placeholder:"Find preset",name:"preset_filter"},{type:"component",constructorName:"visualHUD.Views.CustomHUDPresetList",id:"customHUDList",collection:this.options.customPresetsCollection,scope:this,itemclick:this.importPredefinedHUD},{type:"button",cssClass:"download-presets-button",text:"Download All Presets",name:"downloadPresets"}]},{type:"toolbar",cssClass:"import-form-buttons",items:[{type:"fileInput",text:"Browse For Presets...",multiple:true,name:"myCustomPreset",wrap:false},{type:"button",text:"Cancel",action:"reset",role:"aux",name:"cancel"}]}]}]);this.$content.get(0).appendChild(c)},createDlPresetForm:function(){var c=this.buildForm([{type:"form",cssClass:"hidden",id:"downloadPresetsForm",action:visualHUD.ACTION_DOWNLOAD_PRESETS,method:"post",items:[{type:"textbox",name:"hud_data",inputType:"hidden",wrap:false}]}]);this.$content.get(0).appendChild(c)},setDlPresetButtonState:function(){this.$downloadPresetsButton=this.$downloadPresetsButton||this.$content.find("button.download-presets-button");var c=this.$downloadPresetsButton;var d=this.options.customPresetsCollection.length==0?"hide":"show";c[d]()},downloadPresets:function(){var c=this.options.customPresetsCollection.toJSON();this.$("#downloadPresetsForm").find("[name=hud_data]").val(JSON.stringify(c));this.$("#downloadPresetsForm").submit()},processSelectedFiles:function(d){var c=Array.prototype.slice.call(d.target.files);if(c.length){visualHUD.Libs.importHelper.batchImport(c,{scope:this,files:function(e){this.fireEvent("import.text",[e,true])}});this.showCustomHUDPresets()}d.target.value=""}});visualHUD.Views.windows.ImportImage=visualHUD.Views.WindowBase.extend({mixin:["visualHUD.Libs.formControlsBuilder","visualHUD.Libs.formBuilderMixin.base"],events:{"click button[name=setCustomImage]":"setImage","click button[name=cancel]":"hide"},html:(['<div class="mb-20">',"You can use images up to 300Kb in size, supported formats are JPEGs, GIFs and PNGs","</div>"]).join(""),init:function(){var c=this.buildForm([{type:"form",cssClass:"mwin-form",id:"importHUDForm",items:[{type:"fileInput",name:"customImage",label:null,text:"Choose image"},{type:"toolbar",items:[{type:"button",text:"Set Custom Background",role:"main",name:"setCustomImage"},{type:"button",text:"Cancel",role:"aux",name:"cancel"}]}]}]);this.$content.get(0).appendChild(c);this.$submitButton=this.$content.find("button[name=setCustomImage]").attr("disabled","disabled");this.$form=this.$content.find("form");this.$fileInput=this.$content.find("input[name=customImage]");this.$fileInput.bind("change",visualHUD.Function.bind(this.handleFileSelect,this));this.on("hide",this.reset,this)},handleFileSelect:function(e){var d=e.target.files[0];if(d){if(visualHUD.Libs.importHelper.checkImageType(d)==false){return this.reset()}if(visualHUD.Libs.importHelper.checkImageSize(d)==false){return this.reset()}var c=new FileReader();c.onload=visualHUD.Function.bind(this.onLoad,this,[d],true);c.readAsDataURL(d)}else{this.$submitButton.attr("disabled",true)}},onLoad:function(d,c){this.$submitButton.attr("disabled",false);this.src=d.target.result},setImage:function(){if(this.src){this.fireEvent("import",[this.src]);this.src=null;this.hide()}},reset:function(){this.$form.get(0).reset();this.$fileInput.trigger("change");this.$submitButton.attr("disabled",true);return true}});visualHUD.Views.windows.Feedback=visualHUD.Views.WindowBase.extend({mixin:["visualHUD.Libs.formControlsBuilder","visualHUD.Libs.formBuilderMixin.base"],events:{"submit form":"sendReport","focus form":"suppressValidation","blur form":"validate","click button[name=cancel]":"hide"},_html:(['<div class="mb-20">',"<p>Want to help? Send as much details as you can, especially describing your actions. This way I can easely reproduce the problem and fix it. Here is an example of good bug report:</p>",'<blockquote>"I was clicking [Apply] button and get an error message."</blockquote>',"</div>"]).join(""),init:function(){var c=this.buildForm([{type:"form",cssClass:"mwin-form",id:"feedbackForm",action:visualHUD.ACTION_CONTACT,method:"post",items:[{type:"container",cssClass:"row-fluid",items:[{type:"textbox",name:"name",cssClass:"span-6",required:true,label:"Your name",size:32,maxlength:128,value:""},{type:"textbox",name:"email",inputType:"email",cssClass:"span-6",label:"Email address",size:32,maxlength:128,value:""},{type:"textbox",name:"verify",cssClass:"hidden"}]},{type:"textarea",name:"comments",label:"Message",required:true,rows:5,value:""},{type:"toolbar",cssClass:"pt-10",items:[{type:"button",text:"Send",role:"main",action:"submit",name:"submit"},{type:"button",text:"Cancel",role:"aux",name:"cancel"}]}]}]);this.$content.get(0).appendChild(c);this.$form=this.$("#feedbackForm");var c=this.$form.get(0);this.on("show",this.setFocus,this);this.on("cancel",this.hide,this);this.on("hide",this.reset,this)},validate:function(c){var d=$(c.target);if(d.get(0).validity){var e="addClass";if(d.get(0).validity.valid==true){e="removeClass"}d[e]("invalid-field")}},suppressValidation:function(c){var d=$(c.target);d.removeClass("invalid-field")},reset:function(){this.$form.get(0).reset();this.$form.find(".invalid-field").removeClass("invalid-field")},sendReport:function(g){var d=this.$form.serializeArray();var c=[];var f=false;var e=this.$form.find("button[type=submit]").attr("disabled",true);$.each(d,function(){if(this.name=="verify"&&this.value.length>0){f=true}if(this.name=="comments"){this.value+="\n---------------\n\n"}});if(f==false){$.ajax({type:this.$form.get(0).method,url:this.$form.get(0).action,data:d,complete:visualHUD.Function.bind(function(m,h,k,l){var j=m.status,i=m.responseText;if(j==200){this.hide();visualHUD.growl.alert({status:"success",title:"Thanks, mate!",message:"Your message has been successfully sent."})}else{this.trigger("update.error",m)}e.attr("disabled",false)},this)})}else{this.hide()}return false},setFocus:function(){this.$el.find("input[name=name]").focus()}});visualHUD.Views.windows.Confirm=visualHUD.Views.WindowBase.extend({mixin:["visualHUD.Libs.formControlsBuilder","visualHUD.Libs.formBuilderMixin.base"],events:{"click button[name=confirm]":"yes","click button[name=cancel]":"no"},html:(['<div class="mb-20" id="messageContainer">',"</div>"]).join(""),defaults:{width:400,height:"auto",confirmButtonText:"OK",cancelButtonText:"Cancel"},init:function(){var d=this.buildForm([{type:"form",cssClass:"mwin-form",id:"importHUDForm",items:[{type:"container",name:"customImage",label:null,text:"Choose image"},{type:"toolbar",items:[{type:"button",text:this.options.confirmButtonText,role:"main",name:"confirm"},{type:"button",text:this.options.cancelButtonText,role:"aux",name:"cancel"}]}]}]);this.$content.get(0).appendChild(d);var c=this.$content.find("#messageContainer");c.html(this.options.confirm);this.on("hide",this.destroy,this);this.on("show",function(){this.$content.find("button[name=confirm]").focus()},this)},yes:function(){this.options.handler.apply(this.options.scope||this,[true]);this.hide()},no:function(){this.options.handler.apply(this.options.scope||this,[false]);this.hide()},destroy:function(){this.$el.remove()}});visualHUD.Views.BoundList=Backbone.View.extend({tagName:"ul",className:"bound-list",opened:false,rendered:false,events:{"click .bound-list-item":"itemClick"},defaults:{},renderTo:null,emptyListMessage:"No items here yet",emptyTpl:(['<div class="empty-list-message">',"<%= message %>","</div>"]).join(""),itemTpl:(['<div class="bound-list-item-body">',"<%= name %>","</div>"]).join(""),listItemTpl:'<li class="bound-list-item" data-cid="<%= cid %>"><%= itemHTML %></li>',initialize:function(c){_.extend(this,this.defaults,c||{});if(this.collection){this.bindCollection(this.collection)}if(this.cls){this.$el.addClass(this.cls)}this.bindEvents();this.getRefs();this.init();this.render(this.renderTo)},init:function(){},bindCollection:function(c){this.collection=c;this.collection.on("change",this.updateListItem,this);this.collection.on("add",this.addListItem,this);this.collection.on("remove",this.removeListItems,this);this.collection.on("all",this.refresh,this);this.refresh()},render:function(c){if(c){this.$el.appendTo(this.renderTo);this.rendered=true;this.fireEvent("render",this)}},getRefs:function(){this.$contentWrapper=this.$el.find("div.xpk-mwindow-wrap");this.$content=this.$el.find("div.xpk-win-content");this.$title=this.$el.find(".xpk-win-head h3");this.$closeButton=this.$el.find(".xpk-close-button");this.$closeButton.click($.proxy(this.hide,this));this.$el.click($.proxy(this.cancelEventBubbling,this))},updateListItem:function(d,c){},addListItem:function(d,c){},removeListItems:function(d,c){},refresh:function(h,d){var f=this,e=[],c=_.template(this.listItemTpl),g=_.template(this.itemTpl);this.$el.children().remove();if(this.collection.length){this.collection.each(function(i){var j=g(i.toJSON());e.push(c({cid:i.cid,itemHTML:j}))})}else{e.push(c({cid:null,itemHTML:_.template(this.emptyTpl,{message:this.emptyListMessage})}))}this.$el.append(e.join(""));this.fireEvent("refresh",this)},itemClick:function(d){var c=this.getModelByElement(d.currentTarget);this.fireEvent("itemclick",this,$(d.currentTarget),c,d)},getModelByElement:function(e){var e=$(e),c=e.data("cid"),d=this.collection.getByCid(c);return d},getElementByModel:function(c){var e=c.cid;var d=this.$el.find("[data-cid="+e+"]");return d.length?d:null},bindEvents:function(){if(this.options.itemclick){this.on("itemclick",this.options.itemclick,this.scope||this)}if(this.options.refresh){this.on("refresh",this.options.refresh,this.scope||this)}if(this.options.render){this.on("render",this.options.render,this.scope||this)}},cancelEventBubbling:function(c){c.stopPropagation()}});visualHUD.Views.CustomHUDPresetList=visualHUD.Views.BoundList.extend({cls:"custom-hud-list",collection:null,emptyListMessage:"No presets here yet. Click here to add one",itemTpl:(['<div class="bound-list-item-body">','<span class="item-name"><%= name %></span>','<ul class="custom-hud-actions">','<li class="action icon-download" data-tooltip="Download this HUD" data-action="download"><span>Download this hud</span></li>','<li class="action icon-trash" data-tooltip="Delete" data-action="delete"><span>Delete this hud</span></li>',"</ul>","</div>"]).join(""),emptyTpl:(['<div class="empty-list-message">',"<%= message %>",'<input type="file" name="myCustomPreset" multiple="true" />',"</div>"]).join("")});visualHUD.Views.SystemHUDPresetList=visualHUD.Views.BoundList.extend({cls:"custom-hud-list",collection:null,emptyListMessage:"No presets here yet. Click here to add one",itemTpl:(['<div class="bound-list-item-body">','<span class="item-name"><%= name %></span>',"</div>"]).join("")});visualHUD.Widgets.ToolTip=Backbone.View.extend({tagName:"div",className:"hint-wrap",htmlTpl:['<div class="hint-body">','<div class="hint-content"></div>',"</div>",'<div class="hint-corner"></div>'],defaults:{opacity:1,delay:100,width:200},VERTICAL_OFFSET:5,rendered:false,initialize:function(c){this.$el.append(this.htmlTpl.join(""));$(document.body).on("click.hideTooltip",visualHUD.Function.bind(this.hide,this));$(document.body).on("mouseenter","[data-tooltip]",visualHUD.Function.bind(this.mover,this));$(document.body).on("mouseleave","[data-tooltip]",visualHUD.Function.bind(this.mout,this));this.options=_.extend({},this.defaults,c||{});this.bound={show:visualHUD.Function.createBuffered(this.show,this.options.delay,this)};this.getDOMRefs()},render:function(){this.$el.appendTo(document.body);this.rendered=true},getDOMRefs:function(){this.$content=this.$el.find("div.hint-content");this.$body=this.$el.find("div.hint-body")},mover:function(c){if(this.disabled){return}this.$activeElement=$(c.currentTarget);window.clearTimeout(this.showTimer);this.showTimer=this.bound.show();this.mouseOver=1},mout:function(c,d){if(this.disabled){return}window.clearTimeout(this.showTimer);this.mouseOver=0;this.hide()},show:function(e){if(this.rendered==false){this.render()}if(this.$activeElement==null){return}var f=this.$activeElement.data("tooltip");if(f==null||f==""||this.mouseOver==0){return}this.$content.css("visibility","hidden").html(f);this.$el.css({width:"",top:0,left:0});this.$body.css({width:"",height:""});var d=this.$body.width();var c=this.$body.height();if(d>this.options.width){this.$body.css({width:this.options.width});d=this.options.width;c=this.$body.height()}this.setTipPosition();this.$body.css({width:0,height:0,opacity:0});this.$el.css({width:this.options.width,visibility:"visible"});visualHUD.Function.createBuffered(this.animate,10,this,[d,c])()},animate:function(d,c){this.$body.animate({width:d+2,height:c+2,opacity:this.options.opacity},{duration:100,complete:visualHUD.Function.createDelayed(function(){this.$content.css("visibility","")},20,this)})},hide:function(){if(!this.$activeElement){return}this.$content.css("visibility","hidden");this.$el.css({visibility:"hidden",bottom:"auto",top:-1000,left:-1000});this.$activeElement=null},getElementPosition:function(d){var e=this.$activeElement.get(0);var c=this.$activeElement.offset();var f={width:e.offsetWidth,height:e.offsetHeight,left:c.left,top:c.top};f.right=f.left+f.width;f.bottom=f.top+f.height;return f},setTipPosition:function(){var c=this.getElementPosition();var d=$(document.body).innerHeight();var f=c.top-this.$el.height()-this.VERTICAL_OFFSET;var e=d-c.top+this.VERTICAL_OFFSET;if(f<0){e="auto";f=c.bottom+this.VERTICAL_OFFSET;this.$el.addClass("hint-carret-top").removeClass("hint-carret-bottom")}else{f="auto";this.$el.addClass("hint-carret-bottom").removeClass("hint-carret-top")}this.$el.css({top:f,left:"auto",bottom:e,left:c.left-this.options.width/2+c.width/2})},disable:function(){window.clearTimeout(this.showTimer);this.hide();this.disabled=1},enable:function(){this.disabled=0}});visualHUD.Widgets.PopOver=Backbone.View.extend({tagName:"div",className:"popover-wrap",htmlTpl:['<div class="popover-body">','<div class="popover-title"><%= title %></div>','<div class="popover-content"><%= html %></div>',"</div>"],defaults:{cls:"",opacity:1,maxWidth:500,offset:10,cancelEventBubbling:true,html:"This is popover content",title:"Pop Over",position:"top-left",trigger:"hover"},currentPosition:null,events:{click:"cancelEventBubbling"},disabled:false,visible:false,initialize:function(c){var d=_.template(this.htmlTpl.join(""));this.options=_.extend({},this.defaults,c||{});this.$corner=$('<div class="popover-corner"></div>');this.$el.append(d(this.options));this.$corner.css("display","none");this.$el.css("display","none");if(this.options.cls){this.$el.addClass(this.options.cls)}this.bindEvents();this.getDOMRefs();this.render()},render:function(){this.$corner.appendTo(document.body);this.$el.appendTo(document.body);this.trigger("render",this)},bindEvents:function(){if(this.options.render){this.on("render",this.options.render,this.options.scope||this)}if(this.options.show){this.on("show",this.options.show,this.options.scope||this)}if(this.options.hide){this.on("hide",this.options.hide,this.options.scope||this)}},getDOMRefs:function(){this.$content=this.$el.find("div.popover-content");this.$title=this.$el.find("div.popover-title");this.$body=this.$el.find("div.popover-body")},setContend:function(c){this.$content.html(c);return this},setTitle:function(c){this.$title.html(c);return this},show:function(d,e){if(this.disabled){return}this.$activeElement=$(d);if(this.currentPosition!=null){this.$el.removeClass(this.currentPosition);this.$corner.removeClass(this.currentPosition)}this.$el.addClass("fade").css("display","block");this.$corner.addClass("fade").css("display","block");var f=this.getCoordinates();var c=this.getCornerCoordinates();this.$el.css(f).addClass("in");this.$corner.addClass(this.currentPosition).css(c).addClass("in");e&&e.stopPropagation();$("body").bind("click.hidePopOver",visualHUD.Function.bind(this.hide,this));this.visible=true;this.trigger("show",this);$(document).bind("mousewheel.hidePopover",visualHUD.Function.bind(this.hide,this));$(window).bind("resize.hidePopover",visualHUD.Function.bind(this.hide,this))},hide:function(){if(!this.$activeElement){return false}this.$corner.removeClass("in").css("display","none");this.$el.removeClass("in").css("display","none");this.$activeElement=null;$("body").unbind("click.hidePopOver");this.visible=false;this.trigger("hide",this);$(document).unbind("mousewheel.hidePopover");$(window).unbind("resize.hidePopover",visualHUD.Function.bind(this.hide,this))},positionsMaps:{vertical:["bottom-right","bottom-center","bottom-left","top-left","top-center","top-right"],horizontal:["right-top","right-center","right-bottom","left-bottom","left-center","left-top"]},getCoordinates:function(){var c=this.$activeElement.coordinates(false,true);var d=this.$el.coordinates();var e=this.options.position.split("-").shift();var g=(/top|bottom/).test(e);var f=(/left|right/).test(e);return this.calcCoordinates(this.options.position,{direction:g?"vertical":"horizontal",maxLeft:$(document.body).innerWidth(),maxTop:$(document.body).innerHeight(),popOverCoordinates:d,targetElementCoordinates:c})},calcCoordinates:function(h,l){var g=this.positionsMaps[l.direction],c=_.indexOf(g,h),m=h.split("-").shift(),d=h.split("-").pop();var i=l.targetElementCoordinates.top;var e=l.targetElementCoordinates.left;var k=l.popOverCoordinates.height,j=l.popOverCoordinates.width;this.$el.addClass(this.currentPosition);switch(m){case"top":i-=k+this.options.offset;break;case"bottom":i=l.targetElementCoordinates.bottom+this.options.offset;break;case"left":e-=j+this.options.offset;break;case"right":e=l.targetElementCoordinates.right+this.options.offset;break}switch(d){case"bottom":i-=(k-l.targetElementCoordinates.height);break;case"right":e-=(j-l.targetElementCoordinates.width);break;case"center":if(l.direction=="vertical"){e-=j/2-l.targetElementCoordinates.width/2}else{i-=k/2-l.targetElementCoordinates.height/2}break}if((i<0||i+k>l.maxTop||e<0||e+j>l.maxLeft)==true){this.$el.removeClass(this.currentPosition);var f=g[c+1]||g[0];return this.calcCoordinates(f,l)}else{this.currentPosition=h;return{top:i,left:e}}},getCornerCoordinates:function(){var d=this.$activeElement.coordinates(false,true);var f=this.currentPosition.split("-").shift();var h=d.top;var g=d.left;var e=this.$corner.outerWidth();var c=this.$corner.outerHeight();switch(f){case"top":h-=c;g+=d.width/2-e/2;break;case"bottom":h=d.bottom;g+=d.width/2-e/2;break;case"left":h+=d.height/2-c/2;g-=e;break;case"right":h+=d.height/2-c/2;g=d.right;break}return{top:h,left:g}},disable:function(){this.hide();this.disabled=1},enable:function(){this.disabled=0},cancelEventBubbling:function(c){if(this.options.cancelEventBubbling==true){c.stopPropagation()}}});visualHUD.Widgets.Growl=Backbone.View.extend({tagName:"div",className:"growl-message-container",msgTpl:['<div class="growl-message-wrapper clearfloat">','<div class="growl-message">','<a class="close-message">&times;</a>','<div class="message">',"<% if(title) { %>","<h4><%= title %></h4>","<% } %>","<div><%= message %></div>","</div>","</div>","</div>"],active:0,stack:[],messageLog:[],messagesCounter:0,defaults:{speed:300,delay:50000,offset:10,status:"working",fixed:false,single:false,maxMessages:8,className:"growl-message-container",position:"bottom-right"},defaultMessageOptions:{title:null,message:"This is growl message",status:null},currentPosition:null,events:{"click a.close-message":"hideMessage","contextmenu div.growl-message-wrapper":"hideMessage"},disabled:false,visible:false,rendered:false,initialize:function(c){this.options=_.extend({},this.defaults,c||{});this.$el.css({margin:this.options.offset}).addClass(this.options.position);this.bindEvents()},render:function(){this.$el.appendTo(document.body);this.rendered=true;this.trigger("render",this)},bindEvents:function(){if(this.options.render){this.on("render",this.options.render,this.options.scope||this)}if(this.options.show){this.on("show",this.options.show,this.options.scope||this)}if(this.options.hide){this.on("hide",this.options.hide,this.options.scope||this)}},getDOMRefs:function(){},alert:function(c){if(this.rendered==false){this.render()}if(this.options.single){this.$el.children().remove()}this.$el.show();var c=_.extend({},this.defaultMessageOptions,c);var d=_.template(this.msgTpl.join(""),c);var e=$(d).addClass(c.status||this.options.status).css("display","none");var h=this.options.position.split("-").shift();var g=h=="bottom"?"prependTo":"appendTo";var f=visualHUD.Function.createDelayed(this.hide,c.delay||this.options.delay,this,[e]);this.$messages=this.$el.children();if(this.$messages.length>this.options.maxMessages){this.hide(this.$messages.eq(0))}e[g](this.$el).fadeTo(this.options.speed,1);f();this.trigger("show",[this]);return e},hide:function(c){var d=this;if(c){c.find(".growl-message").hide(this.options.speed/2,function(){c.remove();if(d.$el.children().length==0){d.$el.hide()}})}else{$messages.remove();this.$el.hide()}this.trigger("hide",[this]);return this},hideMessage:function(d){var e=$(d.currentTarget);var c=e.closest(".growl-message-wrapper",this.$el);if(c.length){this.hide(c)}return false}});visualHUD.Controllers.HUDManager=Backbone.Controller.extend({views:["HUDItem","HUDItemForm"],models:["HUDItem","ClientSettings"],collections:["HUDItemTemplates","HUDItemIconEnums","HUDItems","CustomHUDPresets"],AUTOSAVE_TIMEOUT:300000,initialize:function(c){this.addListeners({Viewport:{"import.image":this.importImage,"load.text":this.loadHUDFile},"viewport.TopBar":{"align.action":this.alignItems,"toolbar.hud:action":this.groupActions,"load.text":this.loadHUDFile},"viewport.StageControls":{"item.drop":this.dropNewHUDItem},"viewport.Canvas":{"drop.move":this.onItemMove},"windows.ImportHUD":{load:this.loadHUD,"download.preset":this.downloadPreset,"import.text":this.importHUDPresets},"windows.Download":{download:this.onDownload},"windows.ImportImage":{"import":this.importImage},Form:{"align.action":this.alignItems,"arrange.action":this.arrangeItems},HUDItem:{click:this.onHUDItemClick,destroy:this.onHUDItemDestroy},keyboard:{"select.all":this.selectAllHUDItems,"delete":this.deleteSelectedItems,move:this.moveSelectedItems,group:this.groupSelectedItems,clone:this.cloneSelectedItems,arrange:this.arrangeItems}})},onLaunch:function(){var c=this.getCollection("HUDItems");var d=this.getModel("ClientSettings");d.on("change",this.updateHUDItemStatus,this);c.on("add",this.addNewHUDItem,this);c.on("load",this.loadDraft,this);$(window).load(visualHUD.Function.bind(c.load,c,[]))},loadDraft:function(){console.log("load draft triggered");if(this.getCollection("HUDItems").length==0){return this.showGetStartedMessage()}var d=this.getApplicationView("viewport.Canvas"),c=[];d.beginUpdate();this.selectAllHUDItems();this.deleteSelectedItems();this.getCollection("HUDItems").each(function(f){var h=this.getModel("ClientSettings").getStatusByName(f.get("name"));(h)&&f.set("text",h,{silent:true});try{this.createNewHUDItem(f)}catch(g){c.push(f);console.warn("Invalid HUD Data!",f.toJSON())}},this);if(c.length){this.application.growl.alert({status:"warning",title:"Some Items Were Not Imported",message:_.template(visualHUD.messages.HUD_ELEMENTS_PARSE_ERROR,{count:c.length})});this.getCollection("HUDItems").remove(c)}d.completeUpdate()},showGetStartedMessage:function(){var c=this.application.growl.alert({status:"info",title:"Get Started",delay:20000,message:(["<p>Visual HUD is ready to rock, but there are no HUD items yet. Would you like to import something?</p>",'<a href="#" class="import">Import HUD</a>']).join("")});c.find("a.import").click(visualHUD.Function.bind(function(){var d=this.getApplicationView("windows.ImportHUD");if(this.getCollection("CustomHUDPresets").length>0){d.importCustom()}else{d.importPredefined()}this.application.growl.hide(c);return false},this))},dropNewHUDItem:function(d,c){var f=this.getModelConstructor("HUDItem");var e=new f();var g=this.getModel("ClientSettings").getStatusByName(d.get("id"));e.setDefaultValues({name:d.get("id"),itemType:d.get("itemType")}).set({cssClass:d.get("cssClass"),label:d.get("label"),coordinates:c});e.wasDropped=true;if(g){e.set("text",g)}this.getCollection("HUDItems").add(e)},createNewHUDItem:function(h){var k=this.getCollection("HUDItemTemplates");var l=this.getApplicationView("viewport.Canvas");var d=this.getApplicationView("Viewport");var e=d.getStageControlsView();var i=this.getViewConstructor("HUDItem");var c=this.getViewConstructor("HUDItemForm");var f=this.getCollection("HUDItemIconEnums");var j=new c({alias:"Form",model:h,renderTo:d.$sidebarArea,collections:{HUDItemIconEnums:f}});var g=new i({alias:"HUDItem",HUDItemIconEnums:f,renderTo:l.$canvas,model:h,wasDropped:h.wasDropped,formView:j,htmlTplRecord:k.get(h.get("name"))});e.updateControlsStatus("create",h.get("name"));delete h.wasDropped;return g},addNewHUDItem:function(c){var e=this.getApplicationView("viewport.Canvas");var d=this.createNewHUDItem(c);e.select(d,false)},onItemMove:function(c){var d=this.getApplicationView("viewport.Canvas");_.each(d.getSelection(),function(e){e.refreshCoordinates()});d.disableSelection()},onHUDItemClick:function(c,d){var e=this.getApplicationView("viewport.Canvas");this.application.getController("FocusManager").blur();e.select(c,d.shiftKey||d.ctrlKey);e.enableSelection()},onHUDItemDestroy:function(d){var e=this.getApplicationView("Viewport"),c=e.getStageControlsView();c.updateControlsStatus("destroy",d.get("name"))},updateHUDItemStatus:function(c,f){var e=f.changes;var d=this.getCollection("HUDItems");_.each(e,function(k,j){var i=c.get(j),h,g="text";switch(j){case"statusHealth":h=/healthIndicator|healthBar/;break;case"statusArmor":h=/armorIndicator|armorBar/;break;case"statusAmmo":h=/ammoIndicator/;break;case"statusAccuracy":h=/accuracyIndicator/;break;case"statusSkill":h=/skillIndicator/;break;case"ownerDrawFlag":return d.filterItemsByOwnerDraw(i)}d.each(function(l){var m=l.get("name");if(h&&h.test(m)){l.set(g,i)}})},this)},alignItems:function(c){var d=this.getApplicationView("viewport.Canvas");visualHUD.Libs.layersManager.alignEdges(d,c);_.each(d.getSelection(),function(e){e.refreshCoordinates()})},arrangeItems:function(c){var d=this.getApplicationView("viewport.Canvas");visualHUD.Libs.layersManager.arrangeLayers(d,c);d.updateIndexes();this.getCollection("HUDItems").sort()},groupActions:function(c){switch(c){case"deleteSelected":this.deleteSelectedItems();break;case"groupSelected":this.groupSelectedItems();break;case"cloneSelected":this.cloneSelectedItems();break;case"undoUpdate":this.application.getController("HistoryManager").undo();break}},selectAllHUDItems:function(d){var c=this.getApplicationView("viewport.Canvas");c.selectAll()},deleteSelectedItems:function(){var c=this.getApplicationView("viewport.Canvas"),d=c.getSelection();if(this.getCollection("HUDItems").length==d.length){this.getModel("ClientSettings").set("HUDName",null)}_.each(d,function(e){e.model.destroy()});c.deselect()},moveSelectedItems:function(e,f){var c=this.getApplicationView("viewport.Canvas"),d=c.getSelection();_.each(d,function(g){g.move(e,f)})},groupSelectedItems:function(){var d=this.getApplicationView("viewport.Canvas"),e=d.getSelection(),c=e[0];isUngroup=false,groupGuid=null;_.each(e,function(f){if(f.getGroup()){isUngroup=true}else{groupGuid=groupGuid||visualHUD.Libs.utility.getGuid()}f.setGroup(groupGuid)});if(isUngroup==true){d.deselect();d.select(c)}},cloneSelectedItems:function(e){var f=this.getApplicationView("viewport.Canvas"),d=Array.prototype.slice.call(f.getSelection()),c=this.getModelConstructor("HUDItem");f.deselect();_.each(d,function(g){var i=g.model.toJSON();_.extend(i,{group:null,coordinates:{top:i.coordinates.top+10,left:i.coordinates.left+10}});var h=new c(i),j=this.createNewHUDItem(h);this.getCollection("HUDItems").add(h,{silent:true});f.select(j,true)},this)},loadHUD:function(d,c,e){var c=d.name||c;if(_.isArray(d)){d={name:c,items:d}}if(c){this.addCustomHUDPreset(d)}else{this.getModel("ClientSettings").set("HUDName",null)}if(this.getCollection("HUDItems").length&&e!==true){visualHUD.confirm({title:"Overwrite Current HUD?",confirm:visualHUD.messages.CONFIRM_HUD_OVERWRITE,confirmButtonText:"Yes, overwrite",scope:this,handler:function(f){this.getCollection("HUDItems").load(d.items)}})}else{this.getCollection("HUDItems").load(d.items)}},onDownload:function(c,e){var d=c.serializeForm();if(d.save_preset){this.addCustomHUDPreset({name:e.name,items:c.collection.toJSON()})}else{this.getModel("ClientSettings").set("HUDName",null)}},downloadPreset:function(d){var c=this.getApplicationView("windows.Download");c.setHUDData(d);c.getForm().submit()},syncPresets:function(){var c=this.getModel("ClientSettings").get("HUDName");if(c){this.addCustomHUDPreset({name:c,items:this.getCollection("HUDItems").toJSON()})}},addCustomHUDPreset:function(g){var d=g.items,e=g.name,f=g.isBuiltIn;if(f===true){return}var c=this.getCollection("CustomHUDPresets").find(function(h){return h.get("name")==e});if(c){c.set("items",d)}else{this.getCollection("CustomHUDPresets").add(g)}this.getModel("ClientSettings").set("HUDName",e)},importImage:function(d){var c=this.getModel("ClientSettings");c.set({customBackground:d,canvasShot:3});this.getApplicationView("viewport.CanvasToolbar").setClientSettings({canvasShot:3})},importHUDPresets:function(g,h){var j=true,k=this.getApplicationView("windows.ImportHUD"),c=k?k.opened==false:true,e=this.getCollection("HUDItems").length;_.each(g,function(n,m){try{var p=true;if(h===true){p=false}else{if(m==0){p=e>0}}this.loadHUD(JSON.parse(n.json),n.name||null,p)}catch(o){j=false;console.error("Failed to import HUD",n.json)}},this);if(j&&!h){var l="<%= count %> HUD<%= count==1 ? ' has' : 's have' %> been successfuly imported! ";if(c==true){l=["<p>",l,"Would you like to review the new items?","</p>",'<a href="#" class="import">Open import manager</a>']}else{l=[l]}var f=this.application.growl,d=this.application.getController("Viewport");var i=f.alert({title:"Hooray! ",status:"success",message:_.template(l.join(""),{count:g.length})});i.find("a.import").click(visualHUD.Function.bind(function(){d.loadPreset();f.hide(i);return false},this))}},loadHUDFile:function(d,c){_.each(d,function(g,f){try{this.loadHUD(JSON.parse(g.json),g.name||null,f>0)}catch(h){success=false;console.error("Failed to import HUD",g.json)}},this)}});visualHUD.Controllers.KeyboardManager=Backbone.Controller.extend({keyCodeMap:{A:65,V:86,Z:90,TAB:9,F:70,LEFT:37,TOP:38,RIGHT:39,DOWN:40,C:67,D:68,I:73,DEL:46,R:82,G:71},moveCodeMap:{"37":"left","38":"top","39":"left","40":"top"},initialize:function(c){$(document).bind("keydown",$.proxy(this,"keyboardListiner"))},keyboardListiner:function(c){var h=c.target.nodeName;if(h.match(/input|select|textarea|button|checkbox|radiobutton/gi)){return}if(c.keyCode==this.keyCodeMap.D){this.fireEvent("keyboard","download");return false}if(c.keyCode==this.keyCodeMap.I){this.fireEvent("keyboard","import");return false}if(c.keyCode==this.keyCodeMap.R&&c.ctrlKey&&c.shiftKey){var e=window.confirm(visualHUD.messages.CONFIRM_APPLICATION_RESET);if(e==true){this.fireEvent("keyboard","reset")}return e}if(c.keyCode==this.keyCodeMap.DEL){this.fireEvent("keyboard","delete");return false}if(c.keyCode==this.keyCodeMap.TAB){this.fireEvent("keyboard","fullscreen.toggle",[c]);return false}if(c.keyCode==this.keyCodeMap.V&&c.ctrlKey){this.fireEvent("keyboard","clone",[c]);return false}if(c.keyCode==this.keyCodeMap.Z&&c.ctrlKey){this.fireEvent("keyboard","undo",[c]);return false}if(this.isArrangeKeyPressed(c)&&c.ctrlKey){var d=this.getArrangeAction(c);this.fireEvent("keyboard","arrange",[d]);return false}if(this.isMoveKeyPressed(c.keyCode)){var g=this.getMoveDelta(c);var f=this.getMoveDirection(c.keyCode);this.fireEvent("keyboard","move",[f,g]);return false}if(c.keyCode==this.keyCodeMap.A&&c.ctrlKey){this.fireEvent("keyboard","select.all",[c]);return false}if(c.keyCode==this.keyCodeMap.G&&c.ctrlKey){c.stopPropagation();c.preventDefault();this.fireEvent("keyboard","group",[c]);return false}},isMoveKeyPressed:function(c){return _.include([this.keyCodeMap.TOP,this.keyCodeMap.LEFT,this.keyCodeMap.DOWN,this.keyCodeMap.RIGHT],c)},getMoveDirection:function(c){return this.moveCodeMap[c]},getMoveDelta:function(c){var d=1*visualHUD.scaleFactor;if(c.keyCode==this.keyCodeMap.LEFT||c.keyCode==this.keyCodeMap.TOP){d*=-1}if(c.shiftKey){d*=10}return d},isArrangeKeyPressed:function(c){return _.include([this.keyCodeMap.TOP,this.keyCodeMap.DOWN],c.keyCode)},getArrangeAction:function(f){var e={"38":["bring-front","bring-forward"],"40":["send-back","send-backward"]};var c=e[f.keyCode];var d=f.shiftKey?0:1;return c[d]}});visualHUD.Controllers.FocusManager=Backbone.Controller.extend({initialize:function(c){this.focusedItem=null},onLaunch:function(){var c=this.getApplicationView("Viewport");$(document).on("focus","form",$.proxy(this,"focusListener"))},focusListener:function(c){var d=c.target.nodeName;if(d.match(/input|select|textarea|button|checkbox|radiobutton/gi)){this.focusedItem=c.target}},getFocused:function(){return this.focusedItem},blur:function(){this.focusedItem&&this.focusedItem.blur()}});visualHUD.Controllers.Viewport=Backbone.Controller.extend({views:["Viewport","viewport.CanvasToolbar","viewport.Canvas","viewport.TopBar","viewport.StageControls","GroupActionsPanel","windows.Download","windows.ImportHUD","windows.ImportImage","windows.Feedback","windows.Confirm"],models:["ClientSettings","HUDItem"],collections:["StageControlsDictionary","HUDItemTemplates","HUDItemIconEnums","HUDItems","HUDPresets"],initialize:function(c){this.addListeners({Viewport:{render:this.onViewportRender},"viewport.CanvasToolbar":{"toolbar.menu:show":this.onCanvasMenuShow,"toolbar.menu:hide":this.onCanvasMenuHide,"import.image":this.importImage},"viewport.TopBar":{"toolbar.global:action":this.toolbarAction,"feedback.action":this.feedbackAction},"viewport.Canvas":{selectionchange:visualHUD.Function.createBuffered(this.onSelectionChange,50,this),"import.image":this.importImage},"viewport.StageControls":{"scalefactor.change":this.switchScaleFactor,"layout.change":this.toggleFullscreen},keyboard:{"fullscreen.toggle":this.toggleFullscreen,reset:this.resetApplication,"import":this.loadPreset,download:this.downloadHUD}})},onLaunch:function(){var e=this.getModel("ClientSettings");var c=this.createApplicationView("Viewport",{clientSettingsModel:e});var f=this.createApplicationView("viewport.CanvasToolbar",{clientSettingsModel:e});var d=this.createApplicationView("viewport.Canvas",{clientSettingsModel:e});var h=this.createApplicationView("viewport.TopBar");var g=this.createApplicationView("viewport.StageControls",{collection:this.getCollection("StageControlsDictionary")});this.createApplicationView("windows.Download",{width:600,title:"Download HUD",collection:this.getCollection("HUDItems")});this.createApplicationView("windows.ImportHUD",{width:600,title:"Import HUD",customPresetsCollection:this.getCollection("CustomHUDPresets"),presetCollection:this.getCollection("HUDPresets")});f.render(c);d.render(c);h.render(c);g.render(c);c.render([f,d,h,g])},onViewportRender:function(c){},importImage:function(){if(!this.getApplicationView("windows.ImportImage")){this.createApplicationView("windows.ImportImage",{width:600,title:"Import Custom Background"})}this.getApplicationView("windows.ImportImage").show()},toolbarAction:function(d){var c=this[d];if(_.isFunction(c)){c.apply(this,arguments)}},feedbackAction:function(c){if(!this.getApplicationView("windows.Feedback")){this.createApplicationView("windows.Feedback",{width:600})}switch(c){case"send-feedback":this.sendFeedback();break;case"report-bug":this.reportBug();break}},downloadHUD:function(){var d=this.getCollection("HUDItems");var c=this.getApplicationView("windows.Download");if(!this.getApplicationView("windows.Download")){}if(d.length>0){this.getApplicationView("windows.Download").setHUDName(this.getModel("ClientSettings").get("HUDName")).show()}else{var e=this.application.growl.alert({title:"Oops ;(",status:"warning",message:(["<p>",visualHUD.messages.EMPTY_HUD_WARNING,"</p>",'<a href="#" class="import">Import now</a>']).join("")});e.find("a.import").click(visualHUD.Function.bind(function(){this.loadPreset();this.application.growl.hide(e);return false},this))}},loadPreset:function(){this.getApplicationView("windows.ImportHUD").show()},restartApplication:function(){window.location.reload()},reportBug:function(){this.getApplicationView("windows.Feedback").setTitle("Report an Application Error");this.getApplicationView("windows.Feedback").show()},sendFeedback:function(){if(!this.getApplicationView("windows.Feedback")){this.createApplicationView("windows.Feedback",{width:600})}this.getApplicationView("windows.Feedback").setTitle("Give a Feedback");this.getApplicationView("windows.Feedback").show()},onSelectionChange:function(c,d){this.getApplicationView("Viewport").hideAllSidebarItems();if(d.length==1){d[0].getForm().show()}else{this.getApplicationView("viewport.StageControls").show();this.application.getController("FocusManager").blur()}this.getApplicationView("viewport.TopBar").updateToolbarButtonsState(d.length)},onCanvasMenuShow:function(){this.getApplication().toolTips.disable()},onCanvasMenuHide:function(){this.getApplication().toolTips.enable()},toggleFullscreen:function(c){var e=this.getModel("ClientSettings"),d=!e.get("fullScreenView");if(typeof c=="boolean"){d=c}e.set("fullScreenView",d);if(d==false){this.getApplicationView("viewport.CanvasToolbar").hideMenu()}},switchScaleFactor:function(d){var c=window.location.pathname;window.location.href=c+(d==2?"?large":"")},resetApplication:function(){this.getModel("ClientSettings").reset();this.getCollection("CustomHUDPresets").reset();this.getCollection("HUDItems").reset();this.restartApplication()}});visualHUD.Controllers.HistoryManager=Backbone.Controller.extend({HISTORY_LENGTH:50,EXCLUDE_FIELDS:/index|group/gi,initialize:function(c){this.undoHistrory=[];this.redoHistrory=[];this.addListeners({keyboard:{undo:this.undo}})},onLaunch:function(){this.getCollection("HUDItems").on("change",this.pushUpdateState,this);this.getCollection("HUDItems").on("remove",this.pushDestroyState,this);this.getCollection("HUDItems").on("add",this.pushCreateState,this);this.getCollection("HUDItems").on("load",this.clearHistory,this)},clearHistory:function(){this.undoHistrory.length=0},pushUpdateState:function(d,e){var c=_.keys(e.changes);c=_.filter(c,function(f){return f.match(this.EXCLUDE_FIELDS)==null},this);if(d.wasDropped!==true&&c.length>0){this.pushHistoryState({event:"update",cid:d.cid,model:d,fields:c,state:d.previousAttributes()})}},pushCreateState:function(c,e,d){this.pushHistoryState({event:"create",cid:c.cid,model:c,fields:null,state:null})},pushDestroyState:function(c,e,d){this.pushHistoryState({event:"destroy",cid:c.cid,model:c.toJSON(),fields:null,state:null})},pushHistoryState:function(c){this.undoHistrory.push(c);if(this.undoHistrory>this.HISTORY_LENGTH){this.undoHistrory.shift()}},undo:function(){var c=this.undoHistrory.pop();if(c){switch(c.event){case"update":this.undoUpdate(c);break;case"create":this.undoCreate(c);break;case"destroy":this.undoDestroy(c);break}}},undoUpdate:function(f){this.getCollection("HUDItems").off("change",this.pushUpdateState,this);var c=f.model,e=c._HUDItem,d={};_.each(f.fields,function(g){d[g]=f.state[g]});e.update(d);this.getCollection("HUDItems").on("change",this.pushUpdateState,this)},undoCreate:function(d){var c=this.getApplicationView("viewport.Canvas");this.getCollection("HUDItems").off("remove",this.pushDestroyState,this);d.model.destroy();this.getCollection("HUDItems").on("remove",this.pushDestroyState,this);c.deselect()},undoDestroy:function(e){var f=this.getApplicationView("viewport.Canvas"),d=this.getModelConstructor("HUDItem"),c=new d(e.model);this.getCollection("HUDItems").add(c);this.undoHistrory.pop();_.each(this.undoHistrory,function(g){if(g.cid==e.cid){g.model=c}})},redo:function(){}});